var CS_CONF={"projectId":1255,"status":1,"hostnames":["hp.com","hpshopping.in","omen.com","myarize.com","instantink.hpconnected.com","h20212-3.www2.hp.com","ink.hp.com","hpstore.cn","arizeclinical.com"],"crossDomainTracking":1,"crossDomainSingleIframeTracking":1,"consentRequired":0,"allowSubdomains":1,"visitorCookieTimeout":34164000000,"sampleRate":100,"replayRecordingRate":40,"validationRate":10,"lastTrackingDraw":1589380098,"trackerDomain":"c.contentsquare.net","recordingDomain":"r.contentsquare.net","useMalkaPipeline":1,"ed":"l.contentsquare.net/log/web","eMerchandisingEnabled":0,"mouseMoveHeatmapEnabled":1,"autoInsightsEnabled":0,"jsErrorsEnabled":1,"customErrorsEnabled":0,"apiErrorsEnabled":0,"customHashIdEnabled":0,"recordingEncryptionEnabled":0,"recordingEncryptionPublicKey":null,"recordingEncryptionPublicKeyId":0,"secureCookiesEnabled":0,"triggerSessionReplayEnabled":0,"triggerSessionReplayRegex":null,"dynamicIdRegex":"^[\\d|a-z]{11}-[\\d]{1}$","whitelistedAttributes":[],"replayRecordingUnmaskedUrlRegex":null,"replayRecordingMaskedUrlRegex":"^(?!.*uat).*support\\.hp\\.com.*|^(?!.*uat).*ppssupport.*|(https:\\/\\/h304\\d\\d.www3.hp.com(\\/)*)","tagDeploymentMode":"DUAL_COLLECTION","experimental":null,"iframesTracking":0,"textVisibilityEnabled":0,"cookielessTrackingEnabled":0,"malkaUrlEnabled":0,"malkaEtrEnabled":0,"pathComputationRules":{"reliableSelectors":[],"uniqueAttributes":[],"uniqueCssSelectors":[]},"asyncSerializerEnabled":1,"malkaQuotaServiceDomain":"q-aus1.contentsquare.net","malkaRecordingDomain":"k-aus1.contentsquare.net","dualCollectionTagDomain":"contentsquare.net","ptcDomain":"ct.contentsquare.net","ptcPartition":null,"ptcGuid":"9d25aca9-e352-4895-bbbd-ccebc9786c07"};
var CS_INTEGRATIONS_CONF = {"adobe-target":{},"demandbase":{},"medallia":{},"optimizely":{},"usabilla":{},"youtube":{},"namogoo":{"settings":["cpuStrengthScore","darkMode","adBlocker","isDiscountSearched","isEngagedUser","isIncognitoSession","areMultipleTabsOpen","networkStrengthScore","numOfOpenTabs","isSharedProduct","isShopperExtensions","isSocialMediaClicked","isSortedByPrice","isTechSavvy","tempCValue","tempFValue","vpnProbability","weatherCondition"]}};
/* integration-adobe-target 3.6.1 */
!function(e){var n={};function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(r,a,function(n){return e[n]}.bind(null,a));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-adobe-target-cap","version":"3.6.1","scripts":{"build:snippet":"webpack"}}')},function(e,n,t){"use strict";function r(e,n){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",n,e.message])}}function a(e){return"object"==typeof e&&null!==e}t.r(n);var i,o=t(0),u=o.name,c=o.version,p=function(e){var n,t,a,i;if(r((function(){var r=e.name;a=e.version;var o=r.replace("@contentsquare/integration-","");n=o+"-"+a;var u="-contentsquare";i=new RegExp(u+"$").test(o),t=o.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),i||(u="-cap",i=new RegExp(u+"$").test(o),t=o.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),i)return{snippetBuildName:n,parameterName:t,snippetVersion:a}}(o);p&&(i=p.parameterName,u=p.snippetBuildName,c=p.snippetVersion),r((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("Adobe Target - v"+c);var e=function(e,n){if(a(window.CS_INTEGRATIONS_CONF)&&a(window.CS_INTEGRATIONS_CONF[e]))return window.CS_INTEGRATIONS_CONF[e][n]}(i,"customObjectName");e&&(e=e.trim());var n=[];function t(t){e||(e="ttMETA"),function(e,n,t){if((t=t||window)&&n&&e){var r=!1,a=t[e];a?n():Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a=e,r||(r=!0,n())}})}}(e,(function(){setTimeout((function(){r((function(){var t="",r="";function a(e){for(var a,i,o=e,u=0;u<o.length;u++){var c=o[u];c.CampaignName&&c.RecipeName?(t=c.CampaignName,r=c.RecipeName):c.campaign&&c.experience?(t=c.campaign,r=c.experience):c["activity.name"]&&c["experience.name"]&&(t=c["activity.name"],r=c["experience.name"]),n.length&&n.indexOf(t+"~~~~"+r)>-1&&(t="",r=""),t&&r&&(n.push(t+"~~~~"+r),i=r,a="AB_AT_"+(a=t),_uxa.push(["trackDynamicVariable",{key:a,value:i}]))}}a(window[e]),window.adobe&&adobe.target&&adobe.target.event&&document.addEventListener(adobe.target.event.REQUEST_SUCCEEDED,(function(e){e&&e.detail&&e.detail.responseTokens&&a(e.detail.responseTokens)}))}),u)}),500)}))}_uxa.push(["afterPageView",function(e){r((function(){t()}),u)}])}),u)}]);/* integration-demandbase 2.5.0 */
!function(e){var n={};function t(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(a,r,function(n){return e[n]}.bind(null,r));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-demandbase-cap","version":"2.5.0","scripts":{"build:snippet":"webpack"}}')},function(e,n,t){"use strict";function a(e,n){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",n,e.message])}}t.r(n);var r=t(0),i=r.name,o=r.version,u=function(e){var n,t,r,i;if(a((function(){var a=e.name;r=e.version;var o=a.replace("@contentsquare/integration-","");n=o+"-"+r;var u="-contentsquare";i=new RegExp(u+"$").test(o),t=o.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),i||(u="-cap",i=new RegExp(u+"$").test(o),t=o.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),i)return{snippetBuildName:n,parameterName:t,snippetVersion:r}}(r);u&&(u.parameterName,i=u.snippetBuildName,o=u.snippetVersion),a((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("Demandbase - v"+o);function e(e){!function(e,n,t){if((t=t||window)&&n&&e){var a=!1,r=t[e];r?n():Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return r},set:function(e){r=e,a||(a=!0,n())}})}}("Demandbase",(function(){setTimeout((function(){a((function(){if(Demandbase.IpApi&&Demandbase.IpApi.CompanyProfile&&Demandbase.IpApi.CompanyProfile.information_level){var e=Demandbase.IpApi.CompanyProfile;[["annual_sales","Annual Sales"],["audience","Audience"],["audience_segment","Audience Segment"],["b2b","B2B"],["b2c","B2C"],["city","City"],["company_name","Company Name"],["country_name","Country Name"],["demandbase_sid","SID"],["employee_count","Employee Count"],["employee_range","Employee Range"],["forbes_2000","Forbes 2000"],["fortune_1000","Fortune 1000"],["industry","Industry"],["information_level","Information Level"],["latitude","Latitude"],["longitude","Longitude"],["marketing_alias","Marketing Alias"],["primary_naics","Primary NAICS"],["primary_sic","Primary SIC"],["revenue_range","Revenue Range"],["sub_industry","Sub Industry"],["state","State"],["stock_ticker","Stock Ticker"],["traffic","Traffic"],["watch_list_account_status","Watch List Account Status"],["watch_list_account_type","Watch List Account Type"],["web_site","Website"]].forEach((function(n){var t,a,r=n[0],i=n[1],o=e[r];o&&(a=o,t="ABM_DB_"+(t=i),_uxa.push(["trackDynamicVariable",{key:t,value:a}]))}))}}),i)}),500)}))}var n=!1;_uxa.push(["afterPageView",function(t){a((function(){n||(n=!0,e())}),i)}])}),i)}]);/* integration-medallia 2.14.0 */
!function(e){var n={};function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)i.d(t,a,function(n){return e[n]}.bind(null,a));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-medallia-cap","version":"2.14.0","scripts":{"build:snippet":"webpack"}}')},function(e,n,i){"use strict";function t(e,n){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",n,e.message])}}function a(e){return"object"==typeof e&&null!==e}i.r(n);var r,o=i(0),c=o.name,u=o.version,d=function(e){var n,i,a,r;if(t((function(){var t=e.name;a=e.version;var o=t.replace("@contentsquare/integration-","");n=o+"-"+a;var c="-contentsquare";r=new RegExp(c+"$").test(o),i=o.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),r||(c="-cap",r=new RegExp(c+"$").test(o),i=o.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),r)return{snippetBuildName:n,parameterName:i,snippetVersion:a}}(o);d&&(r=d.parameterName,c=d.snippetBuildName,u=d.snippetVersion),t((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("Medallia - v"+u);var e=function(e,n){if(a(window.CS_INTEGRATIONS_CONF)&&a(window.CS_INTEGRATIONS_CONF[e]))return window.CS_INTEGRATIONS_CONF[e][n]}(r,"settings"),n=!1,i=!1,o="";e&&(e.indexOf("sendArtificialPageviews")>-1&&(n=!0),e.indexOf("sendPageEvents")>-1&&(i=!0),e.indexOf("setReplayLinkToFirstPV")>-1&&(o=0));var d=!1;function l(e,t,a,r){var o=!0;if("LOAD_CLICKTALE_PTC"===CS_CONF.tagDeploymentMode&&(o=!1),e="FB_MD_"+e,_uxa.push(["trackDynamicVariable",{key:e,value:t}]),i){var c=e+" | "+t;o?window.ClickTaleEvent&&ClickTaleEvent(c):_uxa.push(["trackPageEvent",c])}d&&"etr"===a&&(o?window.ClickTaleEventTrigger&&ClickTaleEventTrigger("@ET@ "+e):_uxa.push(["trackEventTriggerRecording","@ETS@"+e])),r&&n&&(_uxa.push(["setQuery",r]),o&&d?window.ClickTaleLogicalWithUploadPage&&ClickTaleLogicalWithUploadPage(window.location.href):_uxa.push(["trackPageview",window.location.pathname]))}function s(e){!function(e,n,i){if((i=i||window)&&n&&e){var t=!1,a=i[e];a?n():Object.defineProperty(i,e,{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a=e,t||(t=!0,n())}})}}("MDIGITAL",(function(){t((function(){function e(){d=!0;var e=function(e,n){e||(e="missingFromDynamicSnippet");var i=n;isNaN(i)&&(n=0);var t="";("CONTENTSQUARE"===CS_CONF.tagDeploymentMode||CS_CONF.useMalkaPipeline)&&(t="&recordingType=cs");var a=_uxa.push(["getSessionData"]);if(a){var r=a.projectId,o=a.userId,c=a.sessionNumber,u=a.pageNumber,d=u-n;return n>=u&&(d=u),0===i&&(d=1),"https://app.contentsquare.com/quick-playback/index.html?pid="+r+"&uu="+o+"&sn="+c+"&pvid="+d+t+"&vd="+e}}("md",o);e&&(window.ClickTale.KampyleLink=e,CS_CONF.integrations_handler=CS_CONF.integrations_handler||{},CS_CONF.integrations_handler.medallia=e)}function n(){window.ClickTaleIsRecording&&ClickTaleIsRecording()?e():window.ClickTaleSubscribe&&ClickTaleSubscribe("recording",(function(){t((function(){e()}),c)}))}window.addEventListener("MDigital_Feedback_Button_Clicked",(function(e){t((function(){e&&e.detail&&e.detail.Form_ID&&l("Feedback Button Clicked","Survey ID : "+e.detail.Form_ID.toString())}),c)})),window.addEventListener("MDigital_Invite_Displayed",(function(e){t((function(){if(e&&e.detail&&e.detail.Form_ID){var n=e.detail.Form_ID.toString();l("Feedback Invite Displayed","Survey ID : "+n,0,"cs_medallia=feedback_invite_displayed_"+n)}}),c)})),window.addEventListener("MDigital_Invite_Accepted",(function(e){t((function(){e&&e.detail&&e.detail.Form_ID&&l("Feedback Invite Accepted","Survey ID : "+e.detail.Form_ID.toString())}),c)})),window.addEventListener("MDigital_Form_Displayed",(function(e){t((function(){if(e&&e.detail&&e.detail.Form_ID){var n=e.detail.Form_ID.toString();l("Feedback Displayed","Survey ID : "+n,0,"cs_medallia=feedback_displayed_"+n)}}),c)})),window.addEventListener("MDigital_Submit_Feedback",(function(e){t((function(){if(e&&e.detail){var n=e.detail;if(n.Feedback_UUID&&n.Form_ID&&n.Form_Type){var i=n.Form_ID.toString(),t=n.Feedback_UUID,a=n.Form_Type;l("Feedback Submitted","Survey ID : "+i,"etr","cs_medallia=feedback_submitted_"+i),l("Feedback UUID",t),l("Form Type",a)}if(n.Content)for(var r=0;r<n.Content.length;r++){var o=n.Content[r].value,c=n.Content[r].type,u=n.Content[r].unique_name;if(c)if(c.toLowerCase().indexOf("grading")>-1||c.toLowerCase().indexOf("nps")>-1){if(!isNaN(o)){var d=parseInt(o);isNaN(d)||(n.Content[r].type.toLowerCase().indexOf("nps")>-1?l("NPS Rating "+u,d):l("Rating "+u,d))}}else if("select"===c||"radio"===c){if("object"==typeof o){var s=o.label;s&&l(u,s)}}else"textInput"!==c&&"textArea"!==c||o&&l(u,o)}}}),c)})),_uxa.push(["isRecording"])?e():0===CS_CONF.useMalkaPipeline&&(window.ClickTaleSubscribe?n():(window.ClickTaleOnReadyList=window.ClickTaleOnReadyList||[],ClickTaleOnReadyList.push((function(){t((function(){n()}),c)}))))}),c)}))}var p=!1;_uxa.push(["afterPageView",function(e){t((function(){p||(p=!0,s())}),c)}])}),c)}]);/* integration-optimizely 2.6.1 */
!function(e){var n={};function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(i,a,function(n){return e[n]}.bind(null,a));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-optimizely-cap","version":"2.6.1","scripts":{"build:snippet":"webpack"}}')},function(e,n,t){"use strict";function i(e,n){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",n,e.message])}}t.r(n);var a=t(0),r=a.name,o=a.version,u=function(e){var n,t,a,r;if(i((function(){var i=e.name;a=e.version;var o=i.replace("@contentsquare/integration-","");n=o+"-"+a;var u="-contentsquare";r=new RegExp(u+"$").test(o),t=o.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),r||(u="-cap",r=new RegExp(u+"$").test(o),t=o.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),r)return{snippetBuildName:n,parameterName:t,snippetVersion:a}}(a);u&&(u.parameterName,r=u.snippetBuildName,o=u.snippetVersion),i((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("Optimizely - v"+o);function e(e){!function(e,n,t){if((t=t||window)&&n&&e){var i=!1,a=t[e];a?n():Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a=e,i||(i=!0,n())}})}}("optimizely",(function(){setTimeout((function(){i((function(){var e=[];function n(){i((function(){var n,t,i=optimizely.get&&optimizely.get("state");if(i&&i.getCampaignStates&&"function"==typeof i.getCampaignStates&&"object"==typeof i.getCampaignStates())for(var a=i.getCampaignStates({isActive:!0}),r=Object.keys(a),o=0;o<r.length;o++)if(-1===e.indexOf(r[o])){e.push(r[o]);var u=a[r[o]];if(u.experiment){var p="",c="";p=u.experiment.name?u.campaignName:u.experiment.id,c=u.experiment.campaignName&&u.experiment.name?u.experiment.name+" - "+u.variation.name:u.variation.name?u.variation.name:u.variation.id,u.isInCampaignHoldback&&(c+=" [Holdback]"),p&&c&&(t=c,n="AB_OP_"+(n=p),_uxa.push(["trackDynamicVariable",{key:n,value:t}]))}}}),r)}n(),window.optimizely=window.optimizely||[],"function"==typeof optimizely.push&&optimizely.push({type:"addListener",filter:{type:"lifecycle",name:"campaignDecided"},handler:n})}),r)}),500)}))}var n=!1;_uxa.push(["afterPageView",function(t){i((function(){n||(n=!0,e())}),r)}])}),r)}]);/* integration-usabilla 2.14.1 */
!function(e){var a={};function n(i){if(a[i])return a[i].exports;var t=a[i]={i:i,l:!1,exports:{}};return e[i].call(t.exports,t,t.exports,n),t.l=!0,t.exports}n.m=e,n.c=a,n.d=function(e,a,i){n.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,a){if(1&a&&(e=n(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var t in e)n.d(i,t,function(a){return e[a]}.bind(null,t));return i},n.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(a,"a",a),a},n.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},n.p="",n(n.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-usabilla-cap","version":"2.14.1","scripts":{"build:snippet":"webpack"}}')},function(e,a,n){"use strict";function i(e,a){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",a,e.message])}}function t(e){return"object"==typeof e&&null!==e}function r(e,a){e||(e="missingFromDynamicSnippet");var n=a;isNaN(n)&&(a=0);var i="";("CONTENTSQUARE"===CS_CONF.tagDeploymentMode||CS_CONF.useMalkaPipeline)&&(i="&recordingType=cs");var t=_uxa.push(["getSessionData"]);if(t){var r=t.projectId,o=t.userId,u=t.sessionNumber,c=t.pageNumber,l=c-a;return a>=c&&(l=c),0===n&&(l=1),"https://app.contentsquare.com/quick-playback/index.html?pid="+r+"&uu="+o+"&sn="+u+"&pvid="+l+i+"&vd="+e}}function o(e,a,n){if((n=n||window)&&a&&e){var i=!1,t=n[e];t?a():Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:function(){return t},set:function(e){t=e,i||(i=!0,a())}})}}n.r(a);var u,c=n(0),l=c.name,s=c.version,d=function(e){var a,n,t,r;if(i((function(){var i=e.name;t=e.version;var o=i.replace("@contentsquare/integration-","");a=o+"-"+t;var u="-contentsquare";r=new RegExp(u+"$").test(o),n=o.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),r||(u="-cap",r=new RegExp(u+"$").test(o),n=o.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),r)return{snippetBuildName:a,parameterName:n,snippetVersion:t}}(c);d&&(u=d.parameterName,l=d.snippetBuildName,s=d.snippetVersion),i((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("GetFeedback Digital (Usabilla) - v"+s);var e=function(e,a){if(t(window.CS_INTEGRATIONS_CONF)&&t(window.CS_INTEGRATIONS_CONF[e]))return window.CS_INTEGRATIONS_CONF[e][a]}(u,"settings"),a=!1,n=!1,c="",d=!1;e&&(e.indexOf("sendArtificialPageviews")>-1&&(a=!0),e.indexOf("enableInPageWidgets")>-1&&(n=!0),e.indexOf("setReplayLinkToFirstPV")>-1&&(c=0),e.indexOf("disableSendingDataToCS")>-1&&(d=!0));var p=!1;function f(e,n,i,t){var r=!0;"LOAD_CLICKTALE_PTC"===CS_CONF.tagDeploymentMode&&(r=!1),e="FB_UB_"+e,_uxa.push(["trackDynamicVariable",{key:e,value:n}]),p&&"etr"===i&&(r?window.ClickTaleEventTrigger&&ClickTaleEventTrigger("@ET@ "+e):_uxa.push(["trackEventTriggerRecording","@ETS@"+e])),t&&a&&(_uxa.push(["setQuery",t]),r&&p?window.ClickTaleLogicalWithUploadPage&&ClickTaleLogicalWithUploadPage(window.location.href):_uxa.push(["trackPageview",window.location.pathname]))}function g(e){if(o("usabilla_live",(function(){setTimeout((function(){i((function(){var e,a=document.getElementById("lightningjs-frame-usabilla_live");if(a&&a.contentWindow&&a.contentWindow.usabilla_live_settings){var n=(e=void i((function(){return a.contentWindow.usabilla_live_settings.eventCallback}),l),function(n,t,o,u,s){i((function(){e&&e.apply(this,arguments);var n=s;if("Feedback:Open"==t||"Campaign:Open"===t){function u(){p=!0;var e=r("ub",c);e&&a.contentWindow.usabilla_live_settings.local_data&&a.contentWindow.usabilla_live_settings.local_data.custom&&(a.contentWindow.usabilla_live_settings.local_data.custom.ContentsquareReplay=e)}function g(){window.ClickTaleIsRecording&&ClickTaleIsRecording()?u():window.ClickTaleSubscribe&&ClickTaleSubscribe("recording",(function(){i((function(){u()}),l)}))}var b=_uxa.push(["isRecording"]);b?u():0===CS_CONF.useMalkaPipeline&&(window.ClickTaleSubscribe?g():(window.ClickTaleOnReadyList=window.ClickTaleOnReadyList||[],ClickTaleOnReadyList.push((function(){i((function(){g()}),l)}))))}if("Feedback:Open"==t&&f("Feedback Displayed (All Surveys)","true",0,"cs_usabilla=feedback_displayed"),"Feedback:Success"===t&&(f("Feedback Submitted (All Surveys)","true","etr","cs_usabilla=feedback_submitted"),!1===d&&n))for(var v=Object.keys(n),w=0;w<v.length;w++){var _=v[w],m=n[v[w]],C="";"email"!=_&&"comment"!=_&&"custom"!=_&&("rating"===_?C="Feedback Mood Rating":"nps"===_?C="Feedback NPS Rating":"performance"===_&&(C="Feedback Performance Rating"),isNaN(m)||(m=parseInt(m)),C&&m&&f(C,m))}if("Campaign:Open"===t&&f("Campaign Displayed",o,0,"cs_usabilla=campaign_displayed_"+o),"Campaign:Page Switch"===t&&!1===d&&n.data)for(var N=Object.keys(n.data),S=0;S<N.length;S++){var k=N[S],y=n.data[N[S]],O="";if("email"!=k)if(O="mood"===k?"Campaign Mood Rating":"nps"===k?"Campaign NPS Rating":k,"object"==typeof y)for(var T=Object.keys(y),h=0;h<T.length;h++){var R=T[h],I=y[T[h]];isNaN(I)||(I=parseInt(I)),isNaN(R)&&O&&R&&I&&f(O+" "+R,I)}else isNaN(y)||(y=parseInt(y)),O&&y&&f(O,y)}"Campaign:Success"===t&&f("Campaign Submitted",o,"etr","cs_usabilla=campaign_submitted_"+o)}),l)});window.usabilla_live("setEventCallback",n)}}),l)}),500)})),n){o("usabilla",(function(){setTimeout((function(){i((function(){var e=[],a="",n="",t="";function o(a,n,i){e.length&&e.indexOf(a+"~~~~"+n)>-1?a="":(e.push(a+"~~~~"+n),a&&f("Widget "+a+" : "+n,i))}function u(e,a){for(var n=document.querySelectorAll("div[ub-in-page]"),i=0;i<n.length;i++){var t=n[i];if(!t.getAttribute("ub-in-page-contentsquare-replay")){var r=document.createAttribute("ub-in-page-"+e);if(r)r.value=a,t.setAttributeNode(r),f("Widget Displayed - ID: "+t.getAttribute("ub-in-page"),"true")}}!function(){for(var e=document.querySelectorAll("div[ub-in-page]"),a=0;a<e.length;a++){e[a].innerHTML=""}var n=document.querySelectorAll('*[id^="usabilla-"]');if(n){var i=n[0];if(i){var t=i.getAttribute("id");if(t){var r=t.slice(9);r&&usabilla.load&&window.usabilla.load("w.usabilla.com",r)}}}}()}function s(){p=!0;var e=r("ub",c);e&&u("contentsquare-replay",e)}function g(){window.ClickTaleIsRecording&&ClickTaleIsRecording()?s():window.ClickTaleSubscribe&&ClickTaleSubscribe("recording",(function(){i((function(){s()}),l)}))}window.usabilla("setEventCallback",(function(e,r,u,c,s){i((function(){var e=s.data,i=e.widget_id;"In-Page:Page Switch"===r&&!1===d&&e.data&&(a=parseInt(e.data.nps),n=parseInt(e.data.rating),t=parseInt(e.data.mood),isNaN(a)||o("NPS",i,a),isNaN(n)||o("Rating",i,n),isNaN(t)||o("Mood",i,t)),"In-Page:Success"===r&&(!1===d&&e.data&&(a=parseInt(e.data.nps),n=parseInt(e.data.rating),t=parseInt(e.data.mood),isNaN(a)||o("NPS Rating",i,a),isNaN(n)||o("Rating",i,n),isNaN(t)||o("Mood",i,t)),f("Widget Submitted - ID: "+i,"true","etr","cs_usabilla=widget_submitted_"+i))}),l)})),_uxa.push(["isRecording"])?s():0===CS_CONF.useMalkaPipeline&&(window.ClickTaleSubscribe?g():(window.ClickTaleOnReadyList=window.ClickTaleOnReadyList||[],ClickTaleOnReadyList.push((function(){i((function(){g()}),l)}))))}),l)}),1500)}))}}var b=!1;_uxa.push(["afterPageView",function(e){i((function(){b||(b=!0,g())}),l)}])}),l)}]);/* integration-youtube 2.4.1 */
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-youtube-cap","version":"2.4.1","scripts":{"build:snippet":"webpack"}}')},function(e,t,n){"use strict";function o(e,t){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",t,e.message])}}n.r(t);var r=n(0),i=r.name,a=r.version,u=function(e){var t,n,r,i;if(o((function(){var o=e.name;r=e.version;var a=o.replace("@contentsquare/integration-","");t=a+"-"+r;var u="-contentsquare";i=new RegExp(u+"$").test(a),n=a.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),i||(u="-cap",i=new RegExp(u+"$").test(a),n=a.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),i)return{snippetBuildName:t,parameterName:n,snippetVersion:r}}(r);u&&(u.parameterName,i=u.snippetBuildName,a=u.snippetVersion),o((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("Youtube - v"+a);function e(e,t){e="VA_YT_"+e,_uxa.push(["trackDynamicVariable",{key:e,value:t}])}function t(t){n||(n=!0,function(t){var n='iframe[src^="https://www.youtube.com/embed/"]',r='iframe[src^="https://www.youtube-nocookie.com/embed/"]',a=!1,u=document.querySelectorAll(n);function c(){var t={playerState:{},videoDuration:0,videoID:""};window.addEventListener("message",(function(n){var r=n.data;if(("https://www.youtube.com"===n.origin||"https://www.youtube-nocookie.com"===n.origin)&&r){var a;try{a=JSON.parse(r)}catch(n){}o((function(){var n,o;if(a){if(a.info&&(a.info.videoData&&a.info.videoData.video_id&&(t.videoID=a.info.videoData.video_id),a.info.duration&&(t.videoDuration=a.info.duration),!isNaN(n=a.info.playerState))){var r="";switch(n){case 2:r="paused";break;case 3:r="started"}r&&t.videoID&&!t.playerState[r]&&(t.playerState[r]=!0,e("Video "+r,"Video ID : "+t.videoID))}if("infoDelivery"==a.event&&a.info&&!isNaN(o=a.info.currentTime)&&t.videoDuration&&t.videoID){var i=Math.round(o/t.videoDuration*100),u="";!t.playerState.firstQtrComplete&&i>25&&(u="25",t.playerState.firstQtrComplete=!0),!t.playerState.secondQtrComplete&&i>50&&(u="50",t.playerState.secondQtrComplete=!0),!t.playerState.thirdQtrComplete&&i>75&&(u="75",t.playerState.thirdQtrComplete=!0),t.playerState.fourthQtrComplete||100!==i||(u="100",e("Video completed","Video ID : "+t.videoID),t.playerState.fourthQtrComplete=!0),u&&e("Video play view duration","Video ID : "+t.videoID+" : "+u+"%")}}}),i)}}));for(var n=0;n<u.length;n++){var r=u[n];r.contentWindow&&"function"==typeof r.contentWindow.postMessage&&(a?r.contentWindow.postMessage('{"event":"listening"}',"https://www.youtube-nocookie.com"):r.contentWindow.postMessage('{"event":"listening"}',"https://www.youtube.com"))}}if(0===u.length&&(u=document.querySelectorAll(r)).length>0&&(a=!0),0===u.length){var s=new MutationObserver((function(){o((function(){if(document.querySelector(n)||document.querySelector(r)){0===(u=document.querySelectorAll(n)).length&&(u=document.querySelectorAll(r)).length>0&&(a=!0),s.disconnect();for(var e=0;e<u.length;e++)u[e].addEventListener("load",(function(e){c()}))}}),i)}));s.observe(document.documentElement,{childList:!0,subtree:!0})}else setTimeout((function(){o((function(){c()}),i)}),500)}())}var n=!1;_uxa.push(["afterPageView",function(e){o((function(){t()}),i)}])}),i)}]);/* integration-namogoo 2.1.4 */
!function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(n){return e[n]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e){e.exports=JSON.parse('{"name":"@contentsquare/integration-namogoo-cap","version":"2.1.4","scripts":{"build:snippet":"webpack"}}')},function(e,n,t){"use strict";function r(e,n){try{e()}catch(e){window._uxa=window._uxa||[],_uxa.push(["logSnippetError",n,e.message])}}function i(e){return"object"==typeof e&&null!==e}t.r(n);var o,a=t(0),u=a.name,c=a.version,s=function(e){var n,t,i,o;if(r((function(){var r=e.name;i=e.version;var a=r.replace("@contentsquare/integration-","");n=a+"-"+i;var u="-contentsquare";o=new RegExp(u+"$").test(a),t=a.replace(/-contentsquare([^-contentsquare]*)$/,"$1"),o||(u="-cap",o=new RegExp(u+"$").test(a),t=a.replace(/-cap([^-cap]*)$/,"$1"))}),"Shared-Function-readPackageJSON"),o)return{snippetBuildName:n,parameterName:t,snippetVersion:i}}(a);s&&(o=s.parameterName,u=s.snippetBuildName,c=s.snippetVersion),r((function(){window._uxa=window._uxa||[],CS_CONF.integrations=CS_CONF.integrations||[],CS_CONF.integrations.push("Namogoo - Customer Journey OS - v"+c);var e=function(e,n){if(i(window.CS_INTEGRATIONS_CONF)&&i(window.CS_INTEGRATIONS_CONF[e]))return window.CS_INTEGRATIONS_CONF[e][n]}(o,"settings");function n(n){!function(e,n,t){if((t=t||window)&&n&&e){var r=!1,i=t[e];i?n():Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return i},set:function(e){i=e,r||(r=!0,n())}})}}("CJOS",(function(){setTimeout((function(){r((function(){function n(e,n){r((function(){var t,r,i;("boolean"==typeof n||"string"==typeof n&&""!=n&&void 0!==n||"number"==typeof n)&&("boolean"==typeof n&&(t="false",!0===n&&(t="true")),"string"==typeof n&&isNaN(n)&&(t=n),("number"==typeof n||"string"==typeof n&&!isNaN(n))&&(t=Math.round(n)),i=t,r="AN_NG_"+(r=e),_uxa.push(["trackDynamicVariable",{key:r,value:i}]))}),u)}function t(e,t){CJOS.push({action:"register",params:{dataPoint:e,callback:function(e){n(t,e)}}})}"function"==typeof CJOS.push&&e&&(e.indexOf("adBlocker")>-1&&t("adBlocker","Ad Blocker Installed"),e.indexOf("cpuStrengthScore")>-1&&t("cpuStrengthScore(1to5)","CPU Strength Score"),e.indexOf("darkMode")>-1&&t("darkMode","Dark Mode"),e.indexOf("isDiscountSearched")>-1&&t("isDiscountSearched","Discount Searcher"),e.indexOf("isEngagedUser")>-1&&t("isEngagedUser","Engaged User"),e.indexOf("isIncognitoSession")>-1&&t("isIncognitoSession","Incognito Session"),e.indexOf("areMultipleTabsOpen")>-1&&t("areMultipleTabsOpen","Multiple Tabs Open"),e.indexOf("networkStrengthScore")>-1&&t("networkStrengthScore(1to5)","Network Strength Score"),e.indexOf("numOfOpenTabs")>-1&&t("numOfOpenTabs","Number of Open Tabs"),e.indexOf("isSharedProduct")>-1&&t("isSharedProduct","Shared a Product"),e.indexOf("isShopperExtensions")>-1&&t("isShopperExtensions","Shopper Extension Installed"),e.indexOf("isSocialMediaClicked")>-1&&t("isSocialMediaClicked","Social Media Logos Interacted"),e.indexOf("isSortedByPrice")>-1&&t("isSortedByPrice","Sorted by Price"),e.indexOf("isTechSavvy")>-1&&t("isTechSavvy","Tech Savvy"),e.indexOf("tempCValue")>-1&&t("tempCValue","Temperature (Celcius)"),e.indexOf("tempFValue")>-1&&t("tempFValue","Temperature (Fahrenheit)"),e.indexOf("vpnProbability")>-1&&t("vpnProbability(1to3)","VPN Probability Score"),e.indexOf("weatherCondition")>-1&&t("condition","Weather Condition"))}),u)}),500)}))}var t=!1;_uxa.push(["afterPageView",function(e){r((function(){t||(t=!0,n())}),u)}])}),u)}]);!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.extractFrom=e.replaceIn=void 0;var i=r(3),n=/(@import\s*("([^"]+)"|'([^']+)'))|(url\s*\(\s*((("([^"\]]+)"|'([^'\]]+)')\s*)|([^)\]]+))\))/g;function o(t,e){return t.replace(n,(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[3]||t[4],o=t[9]||t[10]||t[11],a=(0,i.unescapeCssString)((n||o).trim()),c=n?"@import ":"",u=e(a)||a;return"".concat(c,"url(").concat(s(u),")")}))}function s(t){return-1===t.indexOf('"')?'"'.concat(t,'"'):-1===t.indexOf("'")?"'".concat(t,"'"):t}e.replaceIn=o,e.extractFrom=function(t){var e=[];return o(t,(function(t){return e.push(t),t})),e}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unescapeCssString=void 0,e.unescapeCssString=function(t){return t.replace(/(\\)*\\(?:([a-fA-F0-9]{1,6})|(.))[\n\t\x20]?/g,(function(t,e,r,i){if("\\"===e)return t.slice(1);if(i)return i;var n=parseInt(r,16);return 55296<=n&&n<=57343||0===n||n>1114111?"�":String.fromCodePoint(n)}))}},function(t,e,r){"use strict";r.r(e);var i={};r.r(i),r.d(i,"get",(function(){return x})),r.d(i,"getRequestParameters",(function(){return _}));var n={};r.r(n),r.d(n,"getRequestParameters",(function(){return un}));var o=["childNodes","parentNode","nextSibling","firstChild"],s=["shadowRoot"],a=["target"],c={Date:"csDate",JSON:"csJSON",Array:"csArray",String:"csString",URL:"csURL",MutationObserver:"csMutationObserver",screen:"csScreen"};function u(t,e){var r=function(t,e){for(var r,i=t;i&&!(r=Object.getOwnPropertyDescriptor(i,e));)i=Object.getPrototypeOf(i);return r}(t,e);return(null==r?void 0:r.get)?r.get:(null==r?void 0:r.value)?r.value:function(){return this[e]}}function p(t){Object.keys(c).forEach((function(e){window[c[e]]=t[e]})),"Prototype"in window&&(window.csMutationObserver=window.MutationObserver),l("csNode",o,t.Node.prototype),l("csElement",s,t.Element.prototype),l("csEvent",a,t.Event.prototype)}function l(t,e,r){e.forEach((function(e){window[""+(t+e)]=u(r,e)}))}function h(t,e){window.CSProtectnativeFunctionsLogs=window.CSProtectnativeFunctionsLogs||{},window.CSProtectnativeFunctionsLogs[t]=e}if(!function(){try{var t=function(){var t=document.createElement("iframe");t.id="cs-native-frame",t.setAttribute("hidden",""),t.setAttribute("title","Intentionally blank");var e=document.createElement("cs-native-frame-holder");if(e.setAttribute("hidden",""),document.body.appendChild(e),Element.prototype.attachShadow){var r=e.attachShadow({mode:"closed"});return r.innerHTML=t.outerHTML,r.firstElementChild.contentWindow}return e.innerHTML=t.outerHTML,e.firstElementChild.contentWindow}();return!!t&&(window.CSPureWindow=t,p(window.CSPureWindow),!0)}catch(t){return h("Warning","failed to copy references from pure iframe: "+t.message),!1}}())try{p(window)}catch(t){h("Critical","failed to copy references from window: "+t.message)}var d=function(t,e){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var y=function(){return(y=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function v(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function m(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))}function g(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create;function S(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i}Object.create;var E=Number.MAX_SAFE_INTEGER||9007199254740991;function C(){}function T(t,e){return 0===csString.prototype.lastIndexOf.call(t,e,0)}function R(t,e){return-1!==csString.prototype.indexOf.call(t,e,t.length-e.length)}var b,w,A={percentage:function(){return Math.floor(1e4*Math.random())/100},boolean:function(t){return this.percentage()<t},integer:function(t){return void 0===t&&(t=E),Math.floor(Math.random()*t)}},k=function(){function t(t){var e;this.trackerDomain=t.trackerDomain,this.loggerDomain=t.ed,this.minLogLevel=t.logLevel,this.projectId=t.projectId,this.status=t.status,this.hostnames=t.hostnames,this.iframesTracking=!!t.iframesTracking,this.crossDomainTracking=!!t.crossDomainTracking,this.crossDomainSingleIframeTracking=!!t.crossDomainSingleIframeTracking,this.consentRequired=!!t.consentRequired,this.allowSubdomains=!!t.allowSubdomains,this.visitorCookieTimeout=t.visitorCookieTimeout||34164e6,this.sampleRate=t.sampleRate,this.replayRecordingRate=t.replayRecordingRate,this.validationRate=t.validationRate,this.lastTrackingDraw=t.lastTrackingDraw||1,this.useHttps=!0,this.recordingDomain=t.recordingDomain,this.eMerchandisingEnabled=t.eMerchandisingEnabled,this.mouseMoveHeatmapEnabled=t.mouseMoveHeatmapEnabled,this.jsErrorsEnabled=t.jsErrorsEnabled,this.apiErrors=y({enabled:null!==(e=t.apiErrorsEnabled)&&void 0!==e?e:0},t.apiErrors),this.customErrorsEnabled=t.customErrorsEnabled,this.triggerSessionReplayEnabled=t.triggerSessionReplayEnabled,this.triggerSessionReplayRegex=this.buildRegexFromConfiguration(t.triggerSessionReplayRegex),this.metricRate=void 0===t.metricRate?0:t.metricRate,this.dynamicIdRegex=t.dynamicIdRegex?new RegExp(t.dynamicIdRegex):null,this.whitelistedAttributes=t.whitelistedAttributes||[],this.replayRecordingUnmaskedUrlRegex=this.buildRegexFromConfiguration(t.replayRecordingUnmaskedUrlRegex),this.replayRecordingMaskedUrlRegex=this.buildRegexFromConfiguration(t.replayRecordingMaskedUrlRegex),this.tagDeploymentMode=t.tagDeploymentMode,this.dualCollectionTagDomain=t.dualCollectionTagDomain||null,this.ptcDomain=t.ptcDomain||null,this.ptcGuid=t.ptcGuid||null,this.secureCookiesEnabled=!!t.secureCookiesEnabled,this.ptcSha512=t.ptcSha512||null,this.ptcSnapshotPath=t.ptcSnapshotPath||null,this.emitDebugEvents=!1,this.useMalkaPipeline=t.useMalkaPipeline,this.malkaQuotaServiceDomain=t.malkaQuotaServiceDomain||null,this.malkaRecordingDomain=t.malkaRecordingDomain||null,this.textVisibilityEnabled=t.textVisibilityEnabled,this.experimental=t.experimental||{},this.malkaEtrEnabled=!!t.malkaEtrEnabled,this.malkaUrlEnabled=!!t.malkaUrlEnabled,this.cookielessTrackingEnabled=t.cookielessTrackingEnabled,this.customHashIdEnabled=!!t.customHashIdEnabled,this.encryptionEnabled=!!t.recordingEncryptionEnabled,this.encryptionPublicKey=t.recordingEncryptionPublicKey||null,this.pathComputationRules=t.pathComputationRules||{},this.asyncSerializerEnabled=!!t.asyncSerializerEnabled,this.encryptionPublicKeyId=t.recordingEncryptionPublicKeyId}return t.prototype.getTrackerUri=function(){return this.protocol()+"://"+this.trackerDomain},t.prototype.getRecordingUri=function(){return this.protocol()+"://"+(this.useMalkaPipeline&&this.malkaRecordingDomain?this.malkaRecordingDomain:this.recordingDomain)},t.prototype.getQuotaServiceUri=function(){return this.protocol()+"://"+this.malkaQuotaServiceDomain},t.prototype.getLoggerUri=function(){return this.protocol()+"://"+this.loggerDomain},t.prototype.protocol=function(){return this.useHttps?"https":"http"},t.prototype.isProjectActive=function(){return 1===this.status},t.prototype.processOptionOverrides=function(t){var e=this;t&&t.forEach&&t.forEach((function(t){var r=t[0],i=t.slice(1);if("setOption"===r){var n=i[0],o=i[1];e.setOverridableField(n,o)}}))},t.prototype.setOverridableField=function(t,e){"trackerDomain"===t&&(this.trackerDomain=e),"recordingDomain"===t&&(this.recordingDomain=e),"loggerDomain"===t&&(this.loggerDomain=e),"malkaRecordingDomain"===t&&(this.malkaRecordingDomain=e),"malkaQuotaServiceDomain"===t&&(this.malkaQuotaServiceDomain=e),"minLogLevel"===t&&(this.minLogLevel=e),"useHttps"===t&&(this.useHttps=!!e)},t.prototype.buildRegexFromConfiguration=function(t){return t?this.createRegex(t):null},t.prototype.getRequestParameters=function(){return{pid:""+this.projectId}},t.prototype.updateDynamicFields=function(t,e){"emitDebugEvents"===t&&(this.emitDebugEvents=e),"minLogLevel"===t&&(this.minLogLevel=e)},t.prototype.createRegex=function(t){try{var e=/^\/(.*)\/([gim]*)$/.exec(t);if(e){var r=e[1],i=e[2];return new RegExp("^"+r+"$",i)}return new RegExp("^"+t+"$")}catch(t){return null}},t}(),I=function(){function t(t,e){this.window=t,this.conf=e}return t.prototype.init=function(){this.inIframeContext=this.window.self!==this.window.top,this.conf.iframesTracking&&this.inIframeContext?this.topWindowTracker=!1:this.topWindowTracker=!0},t.prototype.isInIframeContext=function(){return this.inIframeContext},t.prototype.isTopWindowTracker=function(){return this.topWindowTracker},t}();!function(t){t.debug="debug",t.warn="warn",t.error="error",t.critical="critical"}(b||(b={})),function(t){t.toQuery=function(t){return csArray.prototype.join.call(csArray.prototype.map.call(Object.keys(t),(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})),"&")}}(w||(w={}));var P=function(){function t(t,e){this.domainUri=t,this.path=e,this.beforeRequestCallbacks=[],this.afterRequestCallbacks=[]}return t.prototype.setRequestParametersProviders=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.requestParametersProviders=t},t.prototype.before=function(t){csArray.prototype.push.call(this.beforeRequestCallbacks,t)},t.prototype.after=function(t){csArray.prototype.push.call(this.afterRequestCallbacks,t)},t.prototype.retrieveParameters=function(){return this.requestParametersProviders?csArray.prototype.reduce.call(csArray.prototype.map.call(this.requestParametersProviders,(function(t){return t.getRequestParameters()})),(function(t,e){return y(y({},t),e)})):{}},t}(),N=function(t){function e(e,r){return t.call(this,e,r)||this}return f(e,t),e.prototype.send=function(){csArray.prototype.forEach.call(this.beforeRequestCallbacks,(function(t){return t()}));var t=this.retrieveParameters();this.addCacheBusting(t);var e=w.toQuery(t);this.generatePixel(e),csArray.prototype.forEach.call(this.afterRequestCallbacks,(function(t){return t()}))},e.prototype.generatePixel=function(t){var e=new window.Image(1,1);e.onload=C,e.onerror=C,e.src=this.domainUri+(this.path?"/"+this.path:"")+"?"+t},e.prototype.addCacheBusting=function(t){t.r=csString.prototype.slice.call(""+Math.random(),2,8)},e}(P),O=function(){function t(t,e){this.projectConfiguration=t,this.basicLogRequestParameter=e}return t.prototype.init=function(){this.request=new N(this.projectConfiguration.getLoggerUri()),this.request.setRequestParametersProviders(this,this.basicLogRequestParameter)},t.prototype.send=function(t){this.log=t,this.request.send()},t.prototype.getRequestParameters=function(){return{a:this.log.app,l:this.log.level,m:this.log.message,s:this.log.stacktrace}},t}(),L=/[a-zA-Z0-9._%+-]+(?:@|%40)[a-zA-Z0-9.%-_]+((?:\.|%2[eE])[a-zA-Z0-9-]+)+/g,M=/[a-zA-Z0-9+_-](?:@|%40)/,D=function(){function t(){}return t.prototype.anonymize=function(t){return"string"==typeof t&&M.test(t)?csString.prototype.replace.call(t,L,"CS_ANONYMIZED_EMAIL"):t},t.prototype.anonymizeFields=function(t,e){var r=this;return csArray.prototype.forEach.call(e,(function(e){t[e]=r.anonymize(t[e])})),t},t}();function x(){return"11.39.0"}function _(){return{v:"11.39.0"}}var V=function(){return"undefined"!=typeof performance&&performance.now?performance.timing.navigationStart+Math.round(performance.now()):csDate.now()};function q(){return Math.floor(V()/1e3)}var z,U,B=function(){function t(t,e){this.configuration=t,this.pii=e}return t.prototype.getRequestParameters=function(){return y(y({d:""+V(),p:this.pii.anonymize(window.location.href),u:navigator.userAgent},this.configuration.getRequestParameters()),{v:"11.39.0"})},t}();!function(t){t.IMPLEMENTATION="implementation",t.DYNAMIC="dynamic"}(z||(z={})),function(t){t[t.debug=0]="debug",t[t.warn=1]="warn",t[t.error=2]="error",t[t.critical=3]="critical"}(U||(U={}));var H=function(){function t(t,e,r){var i;this.parentLogContext=e,this.pii=new D,this.minLogLevel=U[b.warn],this.isLoggingActive=!1,this.minLogLevel=U[t.minLogLevel||b.warn];var n=t.validationRate>=0?t.validationRate:10;this.isLoggingActive=A.boolean(n),this.request=r||new O(t,new B(t,this.pii)),this.logTrack=((i={})[b.debug]=[],i[b.warn]=[],i[b.error]=[],i[b.critical]=[],i),this.snippetLogCounter={implementation:{},dynamic:{}},this.request.init()}return t.prototype.send=function(t,e,r){if(void 0===e&&(e=""),void 0===r&&(r=b.warn),this.isLoggingAllowed(r,e)){csArray.prototype.push.call(this.logTrack[r],e||"");var i={message:this.getMessage(t,e),stacktrace:this.getStacktrace(t),app:"uxa",level:r};this.request.send(i)}},t.prototype.getMessage=function(t,e){var r=t instanceof Error?this.pii.anonymize(t.message||t.toString()):t;return e&&(r+=" ErrorCode: "+e),r},t.prototype.getStacktrace=function(t){return t instanceof Error?(t.stack||"No stacktrace")+" "+this.getContext():this.getContext()},t.prototype.getContext=function(){var t=this.parentLogContext.getVisitorService(),e=null==t?void 0:t.getVisitor();if(!e)return"No context";var r=this.parentLogContext.getSessionService(),i=r&&r.getSession(),n={userId:e.id,sessionNumber:e.visitsCount,pageNumber:i&&i.pageNumber};return csJSON.stringify(n)},t.prototype.isLoggingAllowed=function(t,e){if(!this.isLoggingActive||U[t]<this.minLogLevel)return!1;if(0===(null==e?void 0:e.indexOf("implementation-snippet-",0)))return this.isLoggingAllowedForSnippets(e,z.IMPLEMENTATION);if(0===(null==e?void 0:e.indexOf("snippet-",0)))return this.isLoggingAllowedForSnippets(e,z.DYNAMIC);var r=this.logTrack[t];return!(r.length>=5)&&(!e||!csArray.prototype.some.call(r,(function(t){return t===e})))},t.prototype.isLoggingAllowedForSnippets=function(t,e){return t in this.snippetLogCounter[e]?!(this.snippetLogCounter[e][t]>=5)&&(this.snippetLogCounter[e][t]+=1,!0):(this.snippetLogCounter[e][t]=1,!0)},t}(),F=document.createElement("a");function G(t){return F.href=t,F.href}function j(t){if(!T(t,"http://")&&!T(t,"https://"))return"";var e=document.createElement("a");return e.href=t,decodeURIComponent(e.hostname)}function K(t,e){return csArray.prototype.some.call(e,(function(e){return R(t,"."+e)||t===e||""===e}))}var W,Y,X,J,Q;!function(t){t.AfterPageView="afterPageView",t.GetSessionKey="getSessionKey"}(W||(W={})),function(t){t.Parent="parent",t.Child="child"}(Y||(Y={})),function(t){t.Discovery="discovery",t.Stop="stop",t.ChildLogMessage="childLogMessage",t.AnalysisEvent="analysisEvent",t.JavascriptError="javascriptError",t.ApiError="apiError",t.EmerchandisingMessage="emerchandisingMessage",t.Commands="commands",t.IntegrationCallback="integrationCallback"}(X||(X={})),(Q=J||(J={})).buildBaseMessage=function(t,e,r,i){var n={type:t,from:e,pid:r,signature:"CS_IFRAME_MESSAGE"};return void 0!==i&&i>=0&&(n.id=i),n},Q.isMessageValid=function(t,e,r,i){var n=j(t.origin);return!!t.data&&!!t.data.type&&"CS_IFRAME_MESSAGE"===t.data.signature&&t.data.from===e&&t.data.pid===r&&K(n,i)},Q.sendMessage=function(t,e,r){t.postMessage(r,e)};var Z=function(){function t(t){this.configuration=t}return t.prototype.send=function(t,e,r){void 0===e&&(e=""),void 0===r&&(r=b.warn);var i={message:t,errorCode:e,level:r},n=J.buildBaseMessage(X.ChildLogMessage,Y.Child,this.configuration.projectId);n.content=i,J.sendMessage(window.parent,"*",n)},t}(),$=function(){function t(){}return t.prototype.setContext=function(t,e){this.visitorService=t,this.sessionService=e},t.prototype.getVisitorService=function(){return this.visitorService},t.prototype.getSessionService=function(){return this.sessionService},t}();function tt(t){return nt(t)&&("number"==typeof t||t instanceof Number)&&!isNaN(t)}function et(t){return t===parseInt(t,10)}function rt(t){return nt(t)&&("string"==typeof t||t instanceof csString)}function it(t){return"object"==typeof t}function nt(t){return void 0!==t}function ot(t){return nt(t)&&null!==t}function st(t){return"function"==typeof t}function at(t){return t instanceof Element}var ct,ut,pt,lt,ht=function(){function t(){}return t.setStrategy=function(e){t.strategy=e},t.getStrategy=function(){return t.strategy},t.debug=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,b.debug)},t.warn=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,b.warn)},t.error=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,b.error)},t.critical=function(t,e){void 0===e&&(e=""),this.strategy.send(t,e,b.critical)},t.tryToExecute=function(t,e){var r=this;return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];try{var o=e.apply(void 0,i);return nt(window.Promise)&&o instanceof window.Promise?o.then((function(t){return t}),(function(e){return r.error(e,t)})):o}catch(e){try{r.error(e,t)}catch(t){}}}},t}(),dt=function(t){return function(e,r,i){var n=r.toString(),o=t||(e.constructor&&e.constructor.name)+"."+n,s=i.value;i.value=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ht.tryToExecute(o,s.bind(this)).apply(void 0,t)}}};!function(t){function e(t){var e=new RegExp("(^|;)[ ]*"+t+"=([^;]*)").exec(document.cookie);return e?decodeURIComponent(e[2]):null}function r(e,r,n,o,s,a){var c=encodeURIComponent(""+r),u=n===t.CURRENT_DOMAIN?void 0:n,p=i(o),l=e+"="+c+(p?";expires="+p.toUTCString():"")+";path=/"+(ot(u)?";domain="+u:"");return nt(s)&&s!==pt.NotSet&&(l=l+";SameSite="+s),nt(a)&&a===lt.Yes&&(l+=";Secure"),document.cookie=l,!0}function i(t){return tt(t)?new csDate(V()+t):t}function n(t,i){e(t)&&r(t,"",i,new csDate(0)),e(t)&&r(t,"",i,new csDate(0),pt.None,lt.Yes)}t.CURRENT_DOMAIN="CURRENT_DOMAIN",t.get=e,t.set=r,t.toExpireDate=i,t.remove=n,t.isCookiePresent=function(){return document.cookie.length>0},t.getRootDomain=function(t,i){var o=e("_cs_root-domain");if(null!==o&&"1"!==o)return o;for(var s=csString.prototype.split.call(window.location.hostname,"."),a=csArray.prototype.pop.call(s);s.length&&(null===o||"1"===o);)r("_cs_root-domain",a=csArray.prototype.join.call([csArray.prototype.pop.call(s),a],"."),a,void 0,t,i),o=e("_cs_root-domain");return n("_cs_root-domain",a),a}}(ct||(ct={})),function(t){t.browserIsSafariV12=function(){return window.navigator.vendor&&csString.prototype.indexOf.call(window.navigator.vendor,"Apple")>-1&&window.navigator.appVersion&&csString.prototype.indexOf.call(window.navigator.appVersion,"Version/12.")>-1}}(ut||(ut={})),function(t){t.None="None",t.Lax="Lax",t.NotSet="X"}(pt||(pt={})),function(t){t[t.Yes=1]="Yes",t[t.No=0]="No"}(lt||(lt={}));var ft=function(){function t(t,e,r){this.configuration=t,this.urlService=e,this.cookieChecker=r,this.supportsSameSite=!1,this.sameSiteFlag=pt.NotSet,this.secureFlag=lt.No}return t.prototype.getSameSiteFlag=function(){return this.sameSiteFlag},t.prototype.getSecureFlag=function(){return this.secureFlag},t.prototype.getDomain=function(){return this.domain},t.prototype.getRootDomain=function(){return this.rootDomain},t.prototype.init=function(){if(!this.configuration.cookielessTrackingEnabled){var t=this.computeSameSiteFlag(),e=this.computeSecureFlag();this.supportsSameSite=this.checkSameSiteFromContext(t,e),this.supportsSameSite?(this.sameSiteFlag=t,this.secureFlag=e):this.configuration.secureCookiesEnabled&&"https:"===this.urlService.getUrlProtocol()&&(this.secureFlag=lt.Yes),this.rootDomain=this.computeRootDomain(),this.domain=this.computeDomain(this.rootDomain)}},t.prototype.checkSameSiteFromContext=function(e,r){return!ut.browserIsSafariV12()&&(ct.set(t.COOKIE_TEST_FOR_SAME_SITE,"Test same site",t.CURRENT_DOMAIN,void 0,e,r),!!ct.get(t.COOKIE_TEST_FOR_SAME_SITE)&&(ct.remove(t.COOKIE_TEST_FOR_SAME_SITE,t.CURRENT_DOMAIN),!0))},t.prototype.computeSameSiteFlag=function(){return"http:"===this.urlService.getUrlProtocol()?pt.Lax:this.cookieChecker.isSameSiteNoneSecureNeeded()||this.configuration.crossDomainTracking?pt.None:pt.Lax},t.prototype.computeSecureFlag=function(){return"http:"===this.urlService.getUrlProtocol()?lt.No:this.configuration.secureCookiesEnabled||this.configuration.crossDomainTracking||this.cookieChecker.isSameSiteNoneSecureNeeded()?lt.Yes:lt.No},t.prototype.isSameSiteSupported=function(){return this.supportsSameSite},t.prototype.set=function(t,e,r){var i=ct.toExpireDate(r);ct.set(t,e,this.domain,i,this.getSameSiteFlag(),this.getSecureFlag())},t.prototype.get=function(t){var e=new RegExp("(^|;)[ ]*"+t+"=([^;]*)").exec(document.cookie);return e?decodeURIComponent(e[2]):null},t.prototype.delete=function(t,e){var r=e||this.domain;ct.remove(t,r)},t.prototype.computeRootDomain=function(){var t=this.cookieChecker.isSameSiteNoneSecureNeeded()&&this.isSameSiteSupported(),e=t?pt.None:void 0,r=t?lt.Yes:void 0;return ct.getRootDomain(e,r)},t.prototype.computeDomain=function(t){return this.configuration.allowSubdomains?t:ct.CURRENT_DOMAIN},t.CURRENT_DOMAIN="CURRENT_DOMAIN",t.COOKIE_TEST_FOR_SAME_SITE="_cs_same_site",t}(),yt=function(){function t(t,e){this.iframeContext=t,this.configuration=e,this.cookieEnabled=!1,this.useSameSiteNoneSecureCookie=!1}return t.prototype.init=function(){if(!this.configuration.cookielessTrackingEnabled&&this.iframeContext.isTopWindowTracker()&&"cookie"in document){if(!this.iframeContext.isInIframeContext()&&ct.isCookiePresent())return this.cookieEnabled=!0,void(this.useSameSiteNoneSecureCookie=!1);if(ct.set("_cs_t","1",ct.CURRENT_DOMAIN),null!==ct.get("_cs_t"))return this.cookieEnabled=!0,this.useSameSiteNoneSecureCookie=!1,void ct.remove("_cs_t",ct.CURRENT_DOMAIN);ct.set("_cs_t","1",ct.CURRENT_DOMAIN,void 0,pt.None,lt.Yes),null!==ct.get("_cs_t")&&(this.cookieEnabled=!0,this.useSameSiteNoneSecureCookie=!0,ct.remove("_cs_t",ct.CURRENT_DOMAIN))}},t.prototype.areCookiesEnabled=function(){return this.cookieEnabled},t.prototype.isSameSiteNoneSecureNeeded=function(){return this.useSameSiteNoneSecureCookie},t}();function vt(){var t="CSLocalStorageTest";try{return localStorage.setItem(t,t),localStorage.getItem(t)!==t?!1:(localStorage.removeItem(t),!0)}catch(t){return!1}}var mt=function(){function t(){}return t.check=function(){return void 0===Object.assign||this.tryObjectAssign()},t.tryObjectAssign=function(){try{var t={},e=Object.assign(t,{a:1},{b:2,c:{d:4}}),r={a:1,b:2,c:{d:4}};return csJSON.stringify(e)===csJSON.stringify(r)&&csJSON.stringify(t)===csJSON.stringify(r)}catch(t){return!1}},t}();var gt,St,Et,Ct,Tt=function(){function t(t,e){this.configuration=t,this.cookieChecker=e}return t.prototype.canTrack=function(){return this.isBrowsingContextSupported()&&this.canTrackProject()&&this.canUseStorage()},t.prototype.canTrackInIframe=function(){return this.isBrowsingContextSupported()&&this.canTrackProject()},t.prototype.canUseStorage=function(){return this.configuration.cookielessTrackingEnabled?function(){var t="CSSessionStorageTest";try{return sessionStorage.setItem(t,t),sessionStorage.getItem(t)!==t?!1:(sessionStorage.removeItem(t),!0)}catch(t){return!1}}()&&vt():this.cookieChecker.areCookiesEnabled()&&vt()},t.prototype.canTrackProject=function(){return this.configuration.isProjectActive()&&K(window.location.hostname,this.configuration.hostnames)},t.prototype.isBrowsingContextSupported=function(){return!this.isDocPrerendered()&&this.isBrowserSupported()&&mt.check()},t.prototype.isDocPrerendered=function(){return"visibilityState"in document&&"prerender"===document.visibilityState},t.prototype.isBrowserSupported=function(){return"pageXOffset"in window&&"pageYOffset"in window&&"onpagehide"in window&&"JSON"in window&&"parse"in window.JSON&&"stringify"in window.JSON&&"addEventListener"in window&&"removeEventListener"in window&&"Node"in window&&"filter"in csArray.prototype&&"forEach"in csArray.prototype&&"querySelectorAll"in document&&"now"in Date&&"keys"in Object&&"performance"in window},t}(),Rt=function(){function t(t,e,r,i,n){this.visitorService=t,this.sessionService=e,this.exclusionService=r,this.customVariablesService=i,this.configuration=n}return t.prototype.get=function(){return{exclusion:this.exclusionService.getAppliedTrackingDraw(),visitor:this.visitorService.getVisitor(),session:this.sessionService.getSession(),cvars:this.customVariablesService.getCustomVariablesSession()}},t.prototype.apply=function(t){t&&(t.exclusion?this.exclude():this.include(t))},t.prototype.exclude=function(){this.exclusionService.exclude(this.configuration),this.visitorService.removeVisitor(),this.sessionService.removeSession(),this.customVariablesService.removeCustomVariablesSession()},t.prototype.include=function(t){this.exclusionService.removeExclusion(),this.visitorService.setVisitor(t.visitor),t.session?this.sessionService.setSession(t.session):this.sessionService.removeSession(),t.cvars?this.customVariablesService.setCustomVariableSession(t.cvars):this.customVariablesService.removeCustomVariablesSession()},t}(),bt=/^(([a-z0-9\-])+(\.[0-9]+){6})(\.(None|Lax|X)\.(0|1))?$/,wt=function(){function t(t,e,r,i){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=i}return t.prototype.get=function(){var e;return(e=this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.getItem("_cs_id"):this.cookieService.get("_cs_id"))?t.fromString(e):null},t.prototype.set=function(e){var r=t.toString(e);if(this.configuration.cookielessTrackingEnabled)this.browserSessionStorage.setItem("_cs_id",r);else{var i=new csDate(e.expires);this.cookieService.set("_cs_id",r,i),this.crossDomainSingleIframeService.setCookie("_cs_id",r,i)}},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_id"):(this.cookieService.delete("_cs_id"),this.crossDomainSingleIframeService.removeCookie("_cs_id"))},t.prototype.handleSubdomainChange=function(){if(!this.configuration.cookielessTrackingEnabled){var t=this.get();t&&(this.configuration.allowSubdomains?this.cookieService.delete("_cs_id",ft.CURRENT_DOMAIN):this.cookieService.delete("_cs_id",this.cookieService.getRootDomain()),this.set(t))}},t.fromString=function(t){var e=csString.prototype.split.call(t,"."),r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],c=e[6];return{id:r,creationTimestamp:Number(i),visitsCount:Number(n),hitTimestamp:Number(o),lastVisitTimestamp:Number(s),appliedTrackingDraw:Number(a),expires:Number(c)}},t.toString=function(t){return csArray.prototype.join.call([t.id,t.creationTimestamp,t.visitsCount,t.hitTimestamp,t.lastVisitTimestamp,t.appliedTrackingDraw,t.expires],".")},t.isValidVisitorString=function(t){return bt.test(t)},t}();!function(t){t.REPLAY_RECORDING_DISABLED="1",t.REPLAY_RECORDING_ENABLED="3",t.TRIGGER_REPLAY_RECORDING_ENABLED="5"}(gt||(gt={})),function(t){t.NOT_RECORDED="0",t.TEMPORARILY_RECORDED="T",t.GLOBAL_SAMPLING="5",t.URL_SAMPLING="6",t.ETR_SAMPLING="7"}(St||(St={})),function(t){t.ETR_OFF="0",t.ETR_ON="1"}(Et||(Et={})),function(t){t.ETR_LEGACY="0",t.ETR_SESSION="1",t.ETR_PAGE="2"}(Ct||(Ct={}));var At,kt=/^\d+\.[013567T](\.[01])?(\.\d+)?$/;!function(t){t[t.NOT_FOUND=0]="NOT_FOUND",t[t.EXPIRED=1]="EXPIRED",t[t.FOUND=2]="FOUND"}(At||(At={}));var It,Pt=function(){function t(t,e,r,i){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=i,this.cache=null}return t.prototype.get=function(e){var r=this.getRawSession(e);return this.isValid(r)?t.fromString(r):null},t.prototype.getRawSession=function(e){if(e){var r=this.getRawValueFromStorage();return t.removeSessionTimestamp(r)}var i=this.getFromCache(),n=i.sessionString,o=i.status,s=t.removeSessionTimestamp(n);if(o!==At.EXPIRED)return s;if(this.configuration.cookielessTrackingEnabled)return null;var a=this.getRawValueFromStorage();if(!a)return null;var c=csString.prototype.split.call(a,".");if(!t.isSessionWithTimestampValue(c))return a;var u=c[c.length-1],p=parseInt(u,10);return isNaN(p)||this.refreshCache(p),s},t.prototype.set=function(t,e){void 0===e&&(e=18e5);var r=V()+e,i=this.toString(t);i+="."+r,this.setInCache(i,r),this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.setItem("_cs_s",i):(this.cookieService.set("_cs_s",i,e),this.crossDomainSingleIframeService.setCookie("_cs_s",i,e))},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_s"):(this.cookieService.delete("_cs_s"),this.crossDomainSingleIframeService.removeCookie("_cs_s")),this.clearCache()},t.prototype.handleSubdomainChange=function(){if(!this.configuration.cookielessTrackingEnabled){var t=this.get(!0);t&&(this.configuration.allowSubdomains?this.cookieService.delete("_cs_s",ft.CURRENT_DOMAIN):this.cookieService.delete("_cs_s",this.cookieService.getRootDomain()),this.set(t))}},t.prototype.isValid=function(e){return null!==e&&t.isValidSessionString(e)},t.prototype.toString=function(t){return csArray.prototype.join.call([t.pageNumber,t.recordingState,t.etrState],".")},t.prototype.setInCache=function(t,e){this.cache={sessionString:t,expires:e}},t.prototype.getFromCache=function(){return this.cache?this.cache&&V()<=this.cache.expires?{sessionString:this.cache.sessionString,status:At.FOUND}:{sessionString:this.cache.sessionString,status:At.EXPIRED}:{sessionString:this.getRawValueFromStorage(),status:At.NOT_FOUND}},t.prototype.clearCache=function(){this.cache=null},t.prototype.refreshCache=function(t){this.cache&&(this.cache.expires=t)},t.prototype.getRawValueFromStorage=function(){if(this.configuration.cookielessTrackingEnabled){var t=this.browserSessionStorage.getItem("_cs_s");return!t||this.hasExpired(t)?null:t}return this.cookieService.get("_cs_s")},t.prototype.hasExpired=function(t){var e=csString.prototype.split.call(t,"."),r=parseInt(e[e.length-1],10);return!isNaN(r)&&V()>r},t.isSessionWithTimestampValue=function(t){return 13===t[t.length-1].length},t.removeSessionTimestamp=function(e){if(!e)return null;var r=csString.prototype.split.call(e,".");return t.isSessionWithTimestampValue(r)?csArray.prototype.join.call(csArray.prototype.slice.call(r,0,-1),"."):e},t.fromRawString=function(e){var r=t.removeSessionTimestamp(e);return null!==r?t.fromString(r):null},t.fromString=function(t){var e=csString.prototype.split.call(t,"."),r=e[0],i=e[1],n=e[2];return{recordingState:i,etrState:null!=n?n:Et.ETR_OFF,pageNumber:parseInt(r,10)}},t.isValidSessionString=function(t){return kt.test(t)},t}();(It||(It={})).fromRaw=function(t){return{exclusion:Number(t._cs_ex)||0,visitor:t._cs_id?wt.fromString(t._cs_id):null,session:t._cs_s?Pt.fromRawString(t._cs_s):null,cvars:t._cs_cvars?window.JSON.parse(t._cs_cvars):null}};var Nt,Ot=/^[0-9]+$/,Lt=function(){function t(t,e,r,i){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=i}return t.prototype.get=function(){return this.configuration.cookielessTrackingEnabled?Number(this.browserSessionStorage.getItem("_cs_ex")):Number(this.cookieService.get("_cs_ex"))},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.setItem("_cs_ex",t):(this.cookieService.set("_cs_ex",t,2592e6),this.crossDomainSingleIframeService.setCookie("_cs_ex",t,2592e6))},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_ex"):(this.cookieService.delete("_cs_ex"),this.crossDomainSingleIframeService.removeCookie("_cs_ex"))},t.isValidExclusionString=function(t){return Ot.test(t)},t}(),Mt=function(){function t(t,e,r,i){this.configuration=t,this.cookieService=e,this.crossDomainSingleIframeService=r,this.browserSessionStorage=i}return t.prototype.get=function(){return this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.getItem("_cs_cvars"):this.cookieService.get("_cs_cvars")},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.setItem("_cs_cvars",t):(this.cookieService.set("_cs_cvars",t),this.crossDomainSingleIframeService.setCookie("_cs_cvars",t))},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserSessionStorage.removeItem("_cs_cvars"):(this.cookieService.delete("_cs_cvars"),this.crossDomainSingleIframeService.removeCookie("_cs_cvars"))},t.isValidCustomVarString=function(t){return"string"==typeof t},t}();!function(t){function e(t){var e=["_cs_ex","_cs_id","_cs_s","_cs_cvars"];return csArray.prototype.every.call(Object.keys(t),(function(t){return csArray.prototype.indexOf.call(e,t)>=0}))}t.isRawDomainState=e,t.isValid=function(t){return!!e(t)&&((!t._cs_id||wt.isValidVisitorString(t._cs_id))&&(!t._cs_s||Pt.isValidSessionString(t._cs_s))&&(!t._cs_ex||Lt.isValidExclusionString(t._cs_ex))&&(!t._cs_cvars||Mt.isValidCustomVarString(t._cs_cvars)))}}(Nt||(Nt={}));var Dt,xt,_t=function(){function t(t,e){this.xdframeOpener=t,this.location=e}return t.prototype.retrieve=function(e,r){var i=this;this.callback=r,this.retrievedStates=[],this.xdframeOrigins=csArray.prototype.map.call(csArray.prototype.filter.call(e,(function(t){return i.isNotCurrentHostname(t)})),t.getXdframeOrigin),this.xdframeOpener.onMessage((function(t){i.handleXdframeMessage(t)})),this.xdframeOpener.onTimeout((function(){i.handleTimeout()})),this.xdframeOpener.start(),csArray.prototype.forEach.call(csArray.prototype.map.call(this.xdframeOrigins,t.getXdframeUrl),(function(t){return i.xdframeOpener.open(t)}))},t.prototype.handleXdframeMessage=function(t){if(this.isXdframeMessage(t)){var e=t.data;if(!Nt.isValid(e))throw this.xdframeOpener.stop(),"Invalid domain state: "+csJSON.stringify(t.data)+" from "+t.origin;csArray.prototype.push.call(this.retrievedStates,e)}this.allMessagesAreIn()&&(this.xdframeOpener.stop(),this.callback(csArray.prototype.map.call(this.retrievedStates,It.fromRaw)))},t.prototype.handleTimeout=function(){ht.warn("xdframe: all messages not received")},t.prototype.isXdframeMessage=function(t){return csArray.prototype.indexOf.call(this.xdframeOrigins,t.origin)>-1},t.prototype.allMessagesAreIn=function(){return this.retrievedStates.length===this.xdframeOrigins.length},t.prototype.isNotCurrentHostname=function(t){return!R(this.location.hostname,t)},t.getXdframeOrigin=function(t){return"https://csxd."+t},t.getXdframeUrl=function(t){return t+"/xdframe-1.0.0.html"},t}(),Vt=function(){function t(){var t=this;this.ALL_MESSAGES_RECEIVED_TIMEOUT=3e3,this.scopedHandleMessage=function(e){t.handleMessage(e)}}return t.prototype.onMessage=function(t){this.onMessageCallback=t},t.prototype.onTimeout=function(t){this.onTimeoutCallback=t},t.prototype.start=function(){var t=this;window.addEventListener("message",this.scopedHandleMessage),this.timeoutId=window.setTimeout((function(){t.onTimeoutCallback()}),this.ALL_MESSAGES_RECEIVED_TIMEOUT)},t.prototype.open=function(t){var e=document.createElement("iframe");return e.src=t,e.setAttribute("hidden",""),e.setAttribute("title","Intentionally blank"),document.body.appendChild(e),e},t.prototype.stop=function(){window.removeEventListener("message",this.scopedHandleMessage),window.clearTimeout(this.timeoutId),this.onMessageCallback=C,this.onTimeoutCallback=C},t.prototype.handleMessage=function(t){this.onMessageCallback(t)},v([dt("XdframeMessage")],t.prototype,"handleMessage",null),t}(),qt=function(){function t(){this.xhr=new XMLHttpRequest}return t.prototype.send=function(t){var e=this,r=t.path,i=t.domainUri,n=t.query,o=t.headers,s=t.method,a=t.body,c=t.onLoadCallback,u=t.onErrorCallback,p=t.timeout,l=t.onTimeoutCallback,h=i;if(r&&(h=csString.prototype.concat.call(h,"/",r)),n&&(h=csString.prototype.concat.call(h,"?",n)),this.xhr.open(s,h,!0),o)for(var d=0,f=o;d<f.length;d++){var y=f[d];this.xhr.setRequestHeader(y.name,y.value)}c&&(this.xhr.onload=function(){var t={responseText:e.xhr.responseText,status:e.xhr.status};c(t)}),u&&(this.xhr.onerror=function(){u()}),p&&l&&(this.xhr.timeout=p,this.xhr.ontimeout=function(){l()}),this.xhr.send(a)},t.prototype.abort=function(){this.xhr.abort()},t}(),zt=function(){function t(){}return t.prototype.send=function(t){return m(this,void 0,void 0,(function(){var e,r,i,n,o,s,a,c,u,p,l,h,d,f,y,v,m,S,E,C,T,R=this;return g(this,(function(g){switch(g.label){case 0:if(e=t.path,r=t.domainUri,i=t.query,n=t.headers,o=t.method,s=t.body,a=t.onLoadCallback,c=t.onErrorCallback,u=t.timeout,p=t.onTimeoutCallback,this.abortController=new AbortController,l={method:o},h={hasTimedOut:!1},u&&(d=window.setTimeout((function(){R.abortRequestAfterTimeout(h)}),u),l.signal=this.abortController.signal),n){for(f={},y=0,v=n;y<v.length;y++)m=v[y],f[m.name]=m.value;l.headers=f}s&&(l.body=s),S=r,e&&(S=csString.prototype.concat.call(S,"/",e)),i&&(S=csString.prototype.concat.call(S,"?",i)),g.label=1;case 1:return g.trys.push([1,5,,6]),[4,fetch(S,l)];case 2:return E=g.sent(),d&&window.clearTimeout(d),a?[4,E.text()]:[3,4];case 3:C=g.sent(),T={responseText:C,status:E.status},a(T),g.label=4;case 4:return[3,6];case 5:return g.sent(),d&&window.clearTimeout(d),h.hasTimedOut&&p?p():!this.abortController.signal.aborted&&c&&c(),[3,6];case 6:return[2]}}))}))},t.prototype.abort=function(){this.abortController&&this.abortController.abort()},t.prototype.abortRequestAfterTimeout=function(t){this.abortController.abort(),t.hasTimedOut=!0},t}(),Ut=function(){function t(){this.isFetchSupported()?this.httpSendStrategy=new zt:this.httpSendStrategy=new qt}return t.prototype.send=function(t){this.httpSendStrategy.send(t)},t.prototype.abort=function(){this.httpSendStrategy.abort()},t.prototype.isFetchSupported=function(){return"function"==typeof window.fetch&&!!window.AbortController},t}(),Bt=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.afterRequestDataRetrievedCallbacks=[],i.requestHeaders=[],i.timeout=0,i.httpSenderContext=new Ut,i}return f(e,t),e.prototype.setCompressionOptions=function(t,e){this.compressor=t,this.compressionOutputType=e},e.prototype.setRequestPayloadProvider=function(t){this.requestPayloadProvider=t},e.prototype.setRequestHeader=function(t){csArray.prototype.push.call(this.requestHeaders,t)},e.prototype.afterProvidersCalled=function(t){csArray.prototype.push.call(this.afterRequestDataRetrievedCallbacks,t)},e.prototype.onLoad=function(t){this.onLoadCallback=t},e.prototype.onError=function(t){this.onErrorCallback=t},e.prototype.onTimeout=function(t,e){this.timeout=t,this.onTimeoutCallback=e},e.prototype.send=function(){var t=this;csArray.prototype.forEach.call(this.beforeRequestCallbacks,(function(t){return t()}));var e=this.retrieveParameters(),r=this.retrievePayload();csArray.prototype.forEach.call(this.afterRequestDataRetrievedCallbacks,(function(t){return t()})),this.compressor&&this.compressionOutputType?this.compressor.compress(this.compressionOutputType,r,(function(r){t.doSend(e,r)})):this.doSend(e,r)},e.prototype.abort=function(){this.httpSenderContext.abort()},e.prototype.retrievePayload=function(){return this.requestPayloadProvider?this.requestPayloadProvider.getRequestPayload():""},e.prototype.doSend=function(t,e){var r,i,n=null!==(r=t.enc)&&void 0!==r?r:null===(i=this.compressor)||void 0===i?void 0:i.algorithm;t=y(y({},t),{enc:null!=n?n:"raw"});var o=w.toQuery(t);this.httpSenderContext.send({method:"POST",domainUri:this.domainUri,path:this.path,headers:this.requestHeaders,query:o,body:e,onLoadCallback:this.onLoadCallback,onErrorCallback:this.onErrorCallback,timeout:this.timeout,onTimeoutCallback:this.onTimeoutCallback}),csArray.prototype.forEach.call(this.afterRequestCallbacks,(function(e){return e(t)}))},v([dt("POST request")],e.prototype,"doSend",null),e}(P);!function(t){t[t.MUTATION_INSERT=1]="MUTATION_INSERT",t[t.MUTATION_REMOVE=2]="MUTATION_REMOVE",t[t.MUTATION_ATTRIBUTE=3]="MUTATION_ATTRIBUTE",t[t.MUTATION_CHARACTER_DATA=4]="MUTATION_CHARACTER_DATA",t[t.INITIAL_DOM=5]="INITIAL_DOM",t[t.SCROLL=6]="SCROLL",t[t.MOUSE_MOVE=7]="MOUSE_MOVE",t[t.CLICK=8]="CLICK",t[t.RESIZE=9]="RESIZE",t[t.INPUT_CHECKABLE=10]="INPUT_CHECKABLE",t[t.INPUT_SELECT=11]="INPUT_SELECT",t[t.INPUT_TEXT=12]="INPUT_TEXT",t[t.HASH_CHANGE=13]="HASH_CHANGE",t[t.CONSENT_GRANTED=14]="CONSENT_GRANTED",t[t.CONSENT_WITHDRAWN=15]="CONSENT_WITHDRAWN",t[t.MOUSE_OVER=16]="MOUSE_OVER",t[t.VISIBILITY_CHANGE=17]="VISIBILITY_CHANGE",t[t.STYLESHEET_RULE_INSERT=18]="STYLESHEET_RULE_INSERT",t[t.STATIC_RESOURCE_URL=19]="STATIC_RESOURCE_URL",t[t.PERFORMANCE_TIMINGS=20]="PERFORMANCE_TIMINGS",t[t.ATTACH_SHADOW=22]="ATTACH_SHADOW",t[t.STYLESHEET_CSS_TEXT_UPDATE=23]="STYLESHEET_CSS_TEXT_UPDATE",t[t.MOUSE_DOWN=24]="MOUSE_DOWN",t[t.MOUSE_UP=25]="MOUSE_UP",t[t.JAVASCRIPT_ERROR=26]="JAVASCRIPT_ERROR",t[t.PAGE_EVENT=27]="PAGE_EVENT",t[t.API_ERROR=28]="API_ERROR",t[t.TEXT_VISIBILITY=29]="TEXT_VISIBILITY",t[t.MUTATION_ENCRYPTED_CHARACTER_DATA=30]="MUTATION_ENCRYPTED_CHARACTER_DATA",t[t.INPUT_ENCRYPTED_TEXT=31]="INPUT_ENCRYPTED_TEXT",t[t.KEY_DOWN=32]="KEY_DOWN",t[t.KEY_UP=33]="KEY_UP",t[t.CLIPBOARD_COMMAND=34]="CLIPBOARD_COMMAND",t[t.STYLESHEET_RULE_DELETE=37]="STYLESHEET_RULE_DELETE",t[t.USER_IDENTIFIER=38]="USER_IDENTIFIER",t[t.TOUCH_START=41]="TOUCH_START",t[t.TOUCH_MOVE=42]="TOUCH_MOVE",t[t.TOUCH_END=43]="TOUCH_END",t[t.GESTURE_RECOGNITION=44]="GESTURE_RECOGNITION",t[t.POINTER_DOWN=47]="POINTER_DOWN",t[t.POINTER_MOVE=48]="POINTER_MOVE",t[t.POINTER_UP=49]="POINTER_UP",t[t.CUSTOM_ERROR=50]="CUSTOM_ERROR",t[t.CUSTOM_ELEMENT_REGISTRATION=54]="CUSTOM_ELEMENT_REGISTRATION"}(Dt||(Dt={})),function(t){t[t.SWIPE=0]="SWIPE",t[t.PINCH=1]="PINCH",t[t.SPREAD=2]="SPREAD",t[t.LONG_PRESS=3]="LONG_PRESS",t[t.TAP=4]="TAP",t[t.DOUBLE_TAP=5]="DOUBLE_TAP"}(xt||(xt={}));function Ht(t,e){void 0===e&&(e=!0),t.boundElement.addEventListener(t.type,t.listener,e)}function Ft(t,e){void 0===e&&(e=!0),t.boundElement.removeEventListener(t.type,t.listener,e)}function Gt(t){return t.nodeType===Node.ELEMENT_NODE}function jt(t){return t.nodeType===Node.TEXT_NODE}function Kt(t){return Gt(t)&&"a"===t.localName}function Wt(t){return function(t){return Gt(t)&&"link"===t.localName}(t)&&"stylesheet"===t.rel}function Yt(t){return Gt(t)&&"img"===t.localName}function Xt(t){return Gt(t)&&"style"===t.localName}function Jt(t){return Gt(t)&&"script"===t.localName}function Qt(t){switch(t.nodeType){case Node.DOCUMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:return!0;default:return!1}}function Zt(t){return Qt(t)&&"host"in t&&"mode"in t}var $t=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"];var te,ee,re=function(){function t(t,e,r,i,n,o,s,a,c,u){this.nodeIdentifier=t,this.projectConfiguration=e,this.asymmetricEncryption=r,this.symmetricEncryption=i,this.textNodesBuffer=n,this.textNodesMutationsBuffer=o,this.inputNodesBuffer=s,this.userIdentifierBuffer=a,this.apiErrorsBuffer=c,this.compressor=u,this.headerMaxSize=8e3,this.requestBodyMaxSize=64e3,this.responseBodyMaxSize=2e3,this.queryParamMaxSize=2e3,this.suppressedMessageMarker="…",this.publicKey=null,this.importKeyDone=!1}return t.prototype.onTextNodeToEncrypt=function(t){this.onTextNodeToEncryptCallback=t},t.prototype.onInputNodeToEncrypt=function(t){this.onInputNodeToEncryptCallback=t},t.prototype.onUserIdentifierToEncrypt=function(t){this.onUserIdentifierToEncryptCallback=t},t.prototype.onApiErrorToEncrypt=function(t){this.onApiErrorToEncryptCallback=t},t.prototype.init=function(){var t=this;this.isFeatureSupported()&&(this.textEncoder=new TextEncoder,this.textNodesBuffer.onSerializeData((function(e){return t.serializeTextNodeToEncrypt(e)})),this.textNodesMutationsBuffer.onSerializeData((function(e){return t.serializeTextNodeMutationToEncrypt(e)})),this.inputNodesBuffer.onSerializeData((function(e){return t.serializeInputNodeToEncrypt(e)})),this.userIdentifierBuffer.onSerializeData((function(e){return t.serializeUserIdentifierToEncrypt(e)})),this.apiErrorsBuffer.onSerializeData((function(e){return t.encryptAndProcessApiError(e)})),this.importPublicKey(this.projectConfiguration.encryptionPublicKey))},t.prototype.importPublicKey=function(t){return m(this,void 0,void 0,(function(){var e;return g(this,(function(r){switch(r.label){case 0:return[4,this.asymmetricEncryption.importKey(t)];case 1:return e=r.sent(),this.importKeyDone=!0,e?(this.publicKey=e,this.textNodesBuffer.serializeDataFromBuffer(),this.userIdentifierBuffer.serializeDataFromBuffer()):(this.textNodesBuffer.clear(),this.userIdentifierBuffer.clear(),ht.warn("Fail to import public key '"+t+"'")),this.textNodesMutationsBuffer.serializeDataFromBuffer(),this.inputNodesBuffer.serializeDataFromBuffer(),this.apiErrorsBuffer.serializeDataFromBuffer(),[2]}}))}))},t.prototype.registerTextNodeToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeTextNodeToEncrypt(t):this.textNodesBuffer.addData(t))},t.prototype.registerTextNodeMutationToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeTextNodeMutationToEncrypt(t):this.textNodesMutationsBuffer.addData(t))},t.prototype.registerInputNodeToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeInputNodeToEncrypt(t):this.inputNodesBuffer.addData(t))},t.prototype.registerUserIdentifierToEncrypt=function(t){this.isFeatureSupported()&&(this.importKeyDone?this.serializeUserIdentifierToEncrypt(t):this.userIdentifierBuffer.addData(t))},t.prototype.registerApiErrorToEncrypt=function(t){this.isFeatureSupported()?this.importKeyDone?this.encryptAndProcessApiError(t):this.apiErrorsBuffer.addData(t):this.fallbackToApiError(t)},t.prototype.isFeatureSupported=function(){return this.projectConfiguration.encryptionEnabled&&!!this.projectConfiguration.encryptionPublicKey&&this.projectConfiguration.encryptionPublicKeyId>0&&this.asymmetricEncryption.isSupported()&&this.symmetricEncryption.isSupported()},t.prototype.serializeTextNodeToEncrypt=function(t){var e=this,r=t.textNode,i=this.nodeIdentifier.getId(r);if(i){if(this.publicKey){var n=y(y({},t),{targetId:i,date:V()});this.encryptAndProcessEvent(n,(function(t){return t.textNode.data}),(function(){return ht.warn("Fail to encrypt text node data")}),(function(t,r){return e.processEncryptedTextMutation(t,r)}))}}else ht.warn("serializeTextNodeToEncrypt: node without identifier")},t.prototype.serializeTextNodeMutationToEncrypt=function(t){var e=this;if(!this.publicKey)return this.fallbackToCharacterData(t);this.encryptAndProcessEvent(t,(function(t){return t.textNode.data}),(function(){ht.warn("Fail to encrypt text node data - Text node processed as MUTATION_CHARACTER_DATA"),e.fallbackToCharacterData(t)}),(function(t,r){return e.processEncryptedTextMutation(t,r)}))},t.prototype.serializeInputNodeToEncrypt=function(t){var e=this;if(!this.publicKey)return this.fallbackToInputText(t);this.encryptAndProcessEvent(t,(function(t){return t.targetValue}),(function(){ht.warn("Fail to encrypt input data - Input node processed as INPUT_TEXT"),e.fallbackToInputText(t)}),(function(t,r){return e.processEncryptedInputText(t,r)}))},t.prototype.serializeUserIdentifierToEncrypt=function(t){var e=this;this.publicKey&&this.encryptAndProcessEvent(t,(function(t){return t.userIdentifier}),(function(){ht.warn("Fail to encrypt userIdentifier")}),(function(t,r){return e.processEncryptedUserIdentifier(t,r)}))},t.prototype.encryptAndProcessEvent=function(t,e,r,i){return m(this,void 0,void 0,(function(){var n,o;return g(this,(function(s){switch(s.label){case 0:return n=e(t),[4,this.asymmetricEncryption.encrypt({publicKey:this.publicKey},n)];case 1:return(o=s.sent())?(i(t,o),[2]):(r(t),[2])}}))}))},t.prototype.fallbackToCharacterData=function(t){var e=t.targetId,r=t.serializedTextData,i=t.date;this.onTextNodeToEncryptCallback({date:i,args:[e,r],type:Dt.MUTATION_CHARACTER_DATA})},t.prototype.fallbackToInputText=function(t){var e=t.targetId,r=t.targetValue,i=t.date;this.onInputNodeToEncryptCallback({date:i,args:[e,csString.prototype.replace.call(r,/\S/g,"•")],type:Dt.INPUT_TEXT})},t.prototype.processEncryptedTextMutation=function(t,e){var r=t.targetId,i=t.serializedTextData,n=t.date;this.onTextNodeToEncryptCallback({date:n,args:[r,i,e,this.projectConfiguration.encryptionPublicKeyId],type:Dt.MUTATION_ENCRYPTED_CHARACTER_DATA})},t.prototype.processEncryptedInputText=function(t,e){var r=t.targetId,i=t.targetValue,n=t.date;this.onInputNodeToEncryptCallback({date:n,args:[r,csString.prototype.replace.call(i,/\S/g,"•"),e,this.projectConfiguration.encryptionPublicKeyId],type:Dt.INPUT_ENCRYPTED_TEXT})},t.prototype.processEncryptedUserIdentifier=function(t,e){var r={type:Dt.USER_IDENTIFIER,args:[e,t.keyId],date:t.date};this.onUserIdentifierToEncryptCallback(r)},t.prototype.encryptAndProcessApiError=function(t){return m(this,void 0,void 0,(function(){var e,r,i,n,o,s,a,c,u,p,l;return g(this,(function(h){switch(h.label){case 0:return this.publicKey?[4,this.symmetricEncryption.generateEncryptionKey()]:(this.fallbackToApiError(t),[2]);case 1:if(e=h.sent(),r=this.symmetricEncryption.generateInitializationVector(),null===e||null===r)return this.fallbackToApiError(t),[2];h.label=2;case 2:return h.trys.push([2,19,,20]),t.customRequestHeaders?this.sizeWithinLimit(t.customRequestHeaders,this.headerMaxSize)?[3,3]:(t.customRequestHeaders="",[3,5]):[3,5];case 3:return i=t,[4,this.symmetricEncrypt(e,r,t.customRequestHeaders)];case 4:i.customRequestHeaders=h.sent(),h.label=5;case 5:return t.customResponseHeaders?this.sizeWithinLimit(t.customResponseHeaders,this.headerMaxSize)?[3,6]:(t.customResponseHeaders="",[3,8]):[3,8];case 6:return n=t,[4,this.symmetricEncrypt(e,r,t.customResponseHeaders)];case 7:n.customResponseHeaders=h.sent(),h.label=8;case 8:return t.queryParameters?this.sizeWithinLimit(t.queryParameters,this.queryParamMaxSize)?[3,9]:(t.queryParameters=this.suppressedMessageMarker,[3,11]):[3,11];case 9:return o=this.compressor.compressSync(t.queryParameters),s=t,[4,this.symmetricEncrypt(e,r,o)];case 10:s.queryParameters=h.sent(),h.label=11;case 11:return t.requestBody?this.sizeWithinLimit(t.requestBody,this.requestBodyMaxSize)?[3,12]:(t.requestBody=this.suppressedMessageMarker,[3,14]):[3,14];case 12:return a=this.compressor.compressSync(t.requestBody),c=t,[4,this.symmetricEncrypt(e,r,a)];case 13:c.requestBody=h.sent(),h.label=14;case 14:return t.responseBody?this.sizeWithinLimit(t.responseBody,this.responseBodyMaxSize)?[3,15]:(t.responseBody=this.suppressedMessageMarker,[3,17]):[3,17];case 15:return u=this.compressor.compressSync(t.responseBody),p=t,[4,this.symmetricEncrypt(e,r,u)];case 16:p.responseBody=h.sent(),h.label=17;case 17:return l=t,[4,this.encryptSecret(e,this.publicKey)];case 18:return l.secret=h.sent(),[3,20];case 19:return h.sent(),this.fallbackToApiError(t),[2];case 20:return t.initializationVector=this.symmetricEncryption.exportInitializationVector(r),t.encryptionKeyId=this.projectConfiguration.encryptionPublicKeyId,this.onApiErrorToEncryptCallback(t),[2]}}))}))},t.prototype.sizeWithinLimit=function(t,e){return this.textEncoder.encode(t).byteLength<=e},t.prototype.fallbackToApiError=function(t){t.customRequestHeaders="",t.customResponseHeaders="",t.queryParameters="",t.requestBody="",t.responseBody="",this.onApiErrorToEncryptCallback(t)},t.prototype.symmetricEncrypt=function(t,e,r){return m(this,void 0,void 0,(function(){var i;return g(this,(function(n){switch(n.label){case 0:return[4,this.symmetricEncryption.encrypt({encryptionKey:t,initializationVector:e},r)];case 1:if(!(i=n.sent()))throw new Error("Encryption failed");return[2,i]}}))}))},t.prototype.encryptSecret=function(t,e){return m(this,void 0,void 0,(function(){var r,i;return g(this,(function(n){switch(n.label){case 0:return[4,this.symmetricEncryption.exportSecret(t)];case 1:if(!(r=n.sent()))throw new Error("Export secret failed");return[4,this.asymmetricEncryption.encrypt({publicKey:e},r)];case 2:if(!(i=n.sent()))throw new Error("Encrypt secret failed");return[2,i]}}))}))},t}();function ie(t){var e=csEventtarget.apply(t);return e&&Gt(e)&&csElementshadowRoot.apply(e)&&t.composedPath?t.__csOriginalTarget||t.composedPath()[0]:e}function ne(){return function(t,e,r){var i=r.value;return i&&(r.value=function(t){if(ie(t)===csEventtarget.apply(t))return i.call(this,t)}),r}}!function(t){t[t.SPACE=0]="SPACE",t[t.ENTER=1]="ENTER",t[t.BACKSPACE=2]="BACKSPACE",t[t.DELETE=3]="DELETE",t[t.ARROWUP=4]="ARROWUP",t[t.ARROWDOWN=5]="ARROWDOWN",t[t.ARROWLEFT=6]="ARROWLEFT",t[t.ARROWRIGHT=7]="ARROWRIGHT",t[t.CAPSLOCK=8]="CAPSLOCK",t[t.SHIFT=9]="SHIFT",t[t.TAB=10]="TAB",t[t.ALPHANUMERICAL=11]="ALPHANUMERICAL",t[t.ESCAPE=12]="ESCAPE",t[t.END=13]="END",t[t.ALT=14]="ALT",t[t.CTRL=15]="CTRL",t[t.META=16]="META"}(te||(te={})),function(t){t[t.COPY=0]="COPY",t[t.CUT=1]="CUT",t[t.PASTE=2]="PASTE"}(ee||(ee={}));var oe,se=function(){function t(e,r,i,n){var o=this;this.selector=e,this.nodeIdentifier=r,this.sensitiveContentService=i,this.encryptionService=n,this.documents=[],this.onEventCallbacks=[],this.eventHandlers=[{type:"change",listener:this.selector.on(t.whiteListedCheckableInputsSelector,(function(t){return o.inputCheckableListener(csEventtarget.apply(t))}))},{type:"change",listener:this.selector.on("select",(function(t){return o.inputSelectListener(csEventtarget.apply(t))}))},{type:"keyup",listener:this.selector.on(t.whiteListedTextInputSelector,(function(t){return o.inputTextListener(csEventtarget.apply(t))}))},{type:"change",listener:this.selector.on(t.whiteListedNumberInputsSelector,(function(t){return o.inputTextListener(csEventtarget.apply(t))}))},{type:"keyup",listener:this.selector.on(t.whiteListedNumberInputsSelector,(function(t){return o.inputTextListener(csEventtarget.apply(t))}))},{type:"scroll",listener:function(t){return o.scrollListener(csEventtarget.apply(t))}},{type:"mouseover",listener:function(t){return o.mouseOverListener(t)}},{type:"click",listener:function(t){return o.clickListener(t)}},{type:"mousedown",listener:function(t){return o.mouseDownListener(t)}},{type:"mouseup",listener:function(t){return o.mouseUpListener(t)}},{type:"keyup",listener:function(t){return o.keyUpListener(t)}},{type:"keydown",listener:function(t){return o.keyDownListener(t)}},{type:"paste",listener:function(t){return o.pasteListener(t)}},{type:"cut",listener:function(t){return o.cutListener(t)}},{type:"copy",listener:function(t){return o.copyListener(t)}}],this.pointerEventHandlers=[{type:"pointerup",listener:function(t){return o.pointerUpListener(t)}},{type:"pointermove",listener:function(t){return o.pointerMoveListener(t)}},{type:"pointerdown",listener:function(t){return o.pointerDownListener(t)}}],this.touchEventHandlers=[{type:"touchstart",listener:function(t){return o.touchStartListener(t)}},{type:"touchmove",listener:function(t){return o.touchMoveListener(t)}},{type:"touchend",listener:function(t){return o.touchEndListener(t)}}]}return t.prototype.init=function(){var t=this;this.initTouchEventHandlers(),this.initPointerEventHandlers(),this.initKeyStrokesMap(),this.initSubscribers(),this.encryptionService.onInputNodeToEncrypt((function(e){return t.triggerCallbacks(e)}))},t.prototype.initSubscribers=function(){var t=this;this.nodeIdentifier.onDocumentIdentified((function(e){t.bindHandlers(e)}))},t.prototype.onEvent=function(t){csArray.prototype.push.call(this.onEventCallbacks,(function(e){e.date=V(),t(e)}))},t.prototype.triggerCallbacks=function(t){csArray.prototype.forEach.call(this.onEventCallbacks,(function(e){return e(t)}))},t.prototype.start=function(){this.triggerInitialEvents()},t.prototype.stop=function(){this.unbindAllHandlers()},t.prototype.initPointerEventHandlers=function(){var t;this.arePointerEventsSupported()&&(t=csArray.prototype.push).call.apply(t,S([this.eventHandlers],this.pointerEventHandlers))},t.prototype.initTouchEventHandlers=function(){var t;this.areTouchEventsSupported()&&(t=csArray.prototype.push).call.apply(t,S([this.eventHandlers],this.touchEventHandlers))},t.prototype.bindHandlers=function(t){-1===csArray.prototype.indexOf.call(this.documents,t)&&(csArray.prototype.push.call(this.documents,t),csArray.prototype.forEach.call(this.eventHandlers,(function(e){return Ht(y({boundElement:t},e))})))},t.prototype.unbindHandlers=function(t){this.documents=csArray.prototype.filter.call(this.documents,(function(e){return e!==t})),csArray.prototype.forEach.call(this.eventHandlers,(function(e){return Ft(y({boundElement:t},e))}))},t.prototype.arePointerEventsSupported=function(){return"PointerEvent"in window&&"function"==typeof window.PointerEvent},t.prototype.areTouchEventsSupported=function(){return"TouchEvent"in window&&"function"==typeof window.TouchEvent},t.prototype.unbindAllHandlers=function(){var t=this;csArray.prototype.forEach.call(this.documents,(function(e){return t.unbindHandlers(e)}))},t.prototype.triggerInitialEvents=function(){this.initialTextInputListener(t.whiteListedTextInputSelector),this.initialScrollListener(),this.initialSelectListener(),this.initialCheckableListener(),this.initialTextInputListener(t.whiteListedNumberInputsSelector)},t.prototype.initialTextInputListener=function(t){for(var e=document.querySelectorAll(t),r=0;r<e.length;r+=1){var i=e.item(r);i.value.length>0&&this.inputTextListener(i)}},t.prototype.initialScrollListener=function(){for(var t=document.getElementsByTagName("*"),e=0;e<t.length;e+=1){var r=t[e],i=this.getScrollPosition(r),n=i.top,o=i.left;0===n&&0===o||this.scrollListener(r)}},t.prototype.initialSelectListener=function(){for(var t=document.getElementsByTagName("select"),e=0;e<t.length;e+=1)this.inputSelectListener(t[e])},t.prototype.initialCheckableListener=function(){for(var e=document.querySelectorAll(t.whiteListedCheckableInputsSelector),r=0;r<e.length;r+=1)this.inputCheckableListener(e[r])},t.prototype.getScrollPosition=function(t){return t===document?{top:window.pageYOffset,left:window.pageXOffset}:{top:t.scrollTop,left:t.scrollLeft}},t.prototype.scrollListener=function(t){if(!Gt(t)||!this.sensitiveContentService.isSensitive(t)&&!this.sensitiveContentService.isSensitiveChild(t)){var e=this.nodeIdentifier.getId(t);if(e){var r=this.getScrollPosition(t);this.triggerCallbacks({type:Dt.SCROLL,args:[e,r.left,r.top]})}else ht.warn("scrollListener: node without identifier")}},t.prototype.mouseOverListener=function(t){if(!Gt(t.target)||!this.sensitiveContentService.isSensitiveChild(t.target)){var e=this.nodeIdentifier.getId(t.target);e?this.triggerCallbacks({type:Dt.MOUSE_OVER,args:[e]}):ht.warn("mouseOverListener: node without identifier")}},t.prototype.clickListener=function(t){if(!Gt(t.target)||!this.sensitiveContentService.isSensitiveChild(t.target)){var e=this.nodeIdentifier.getId(t.target);e?this.triggerCallbacks({type:Dt.CLICK,args:[e]}):ht.warn("clickListener: node without identifier")}},t.prototype.mouseDownListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));e?this.triggerCallbacks({type:Dt.MOUSE_DOWN,args:[e,t.button,{pageX:t.pageX,pageY:t.pageY}]}):ht.warn("mouseDownListener: node without identifier")}},t.prototype.mouseUpListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));e?this.triggerCallbacks({type:Dt.MOUSE_UP,args:[e,t.button]}):ht.warn("mouseUpListener: node without identifier")}},t.prototype.inputCheckableListener=function(t){if(!this.sensitiveContentService.isSensitive(t)&&!this.sensitiveContentService.isSensitiveChild(t)){var e=this.nodeIdentifier.getId(t);e?this.triggerCallbacks({type:Dt.INPUT_CHECKABLE,args:[e,t.checked]}):ht.warn("inputCheckableListener: node without identifier")}},t.prototype.inputSelectListener=function(t){if(!this.sensitiveContentService.isSensitive(t)&&!this.sensitiveContentService.isSensitiveChild(t)){var e=this.nodeIdentifier.getId(t);e?this.triggerCallbacks({type:Dt.INPUT_SELECT,args:[e,t.selectedIndex]}):ht.warn("inputSelectListener: node without identifier")}},t.prototype.inputTextListener=function(t){if(!this.sensitiveContentService.isSensitive(t)&&!this.sensitiveContentService.isSensitiveChild(t)){var e=this.nodeIdentifier.getId(t);if(e)if(t.hasAttribute("data-cs-encrypt")&&"password"!==t.type)this.encryptionService.registerInputNodeToEncrypt({targetId:e,targetValue:t.value,date:V()});else{var r="number"===t.type?"0":"•";this.triggerCallbacks({type:Dt.INPUT_TEXT,args:[e,csString.prototype.replace.call(t.value,/\S/g,r)]})}else ht.warn("inputTextListener: node without identifier")}},t.prototype.keyUpListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));if(e){var r=this.keyStrokeMap[t.key];void 0!==r&&this.triggerCallbacks({type:Dt.KEY_UP,args:[e,r]})}else ht.warn("keyUpListener: node without identifier")}},t.prototype.keyDownListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));if(e){var r=this.keyStrokeMap[t.key];void 0!==r&&this.triggerCallbacks({type:Dt.KEY_DOWN,args:[e,r]})}else ht.warn("keyDownListener: node without identifier")}},t.prototype.copyListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));e?this.triggerCallbacks({type:Dt.CLIPBOARD_COMMAND,args:[e,ee.COPY]}):ht.warn("copyListener: node without identifier")}},t.prototype.cutListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));e?this.triggerCallbacks({type:Dt.CLIPBOARD_COMMAND,args:[e,ee.CUT]}):ht.warn("cutListener: node without identifier")}},t.prototype.pasteListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));e?this.triggerCallbacks({type:Dt.CLIPBOARD_COMMAND,args:[e,ee.PASTE]}):ht.warn("pasteListener: node without identifier")}},t.prototype.pointerUpListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));if(e){var r={type:Dt.POINTER_UP,args:[t.pointerId,t.pointerType,t.clientX,t.clientY,e,t.button]};this.triggerCallbacks(r)}else ht.warn("pointerup: node without identifier")}},t.prototype.pointerMoveListener=function(t){var e={type:Dt.POINTER_MOVE,args:[t.pointerId,t.pointerType,t.clientX,t.clientY]};this.triggerCallbacks(e)},t.prototype.pointerDownListener=function(t){if(!Gt(csEventtarget.apply(t))||!this.sensitiveContentService.isSensitiveChild(csEventtarget.apply(t))){var e=this.nodeIdentifier.getId(csEventtarget.apply(t));if(e){var r={type:Dt.POINTER_DOWN,args:[t.pointerId,t.pointerType,t.clientX,t.clientY,e,t.button,{pageX:t.pageX,pageY:t.pageY}]};this.triggerCallbacks(r)}else ht.warn("pointerdown: node without identifier")}},t.prototype.touchStartListener=function(t){for(var e=t.changedTouches,r=0;r<e.length;r+=1){var i=e[r],n={type:Dt.TOUCH_START,args:[i.identifier,i.clientX,i.clientY]};this.triggerCallbacks(n)}},t.prototype.touchMoveListener=function(t){for(var e=t.changedTouches,r=0;r<e.length;r+=1){var i=e[r],n={type:Dt.TOUCH_MOVE,args:[i.identifier,i.clientX,i.clientY]};this.triggerCallbacks(n)}},t.prototype.touchEndListener=function(t){for(var e=t.changedTouches,r=0;r<e.length;r+=1){var i=e[r],n={type:Dt.TOUCH_END,args:[i.identifier,i.clientX,i.clientY]};this.triggerCallbacks(n)}},t.prototype.initKeyStrokesMap=function(){this.keyStrokeMap={},this.keyStrokeMap[" "]=te.SPACE,this.keyStrokeMap.Spacebar=te.SPACE,this.keyStrokeMap.Backspace=te.BACKSPACE,this.keyStrokeMap.Enter=te.ENTER,this.keyStrokeMap.Delete=te.DELETE,this.keyStrokeMap.ArrowUp=te.ARROWUP,this.keyStrokeMap.ArrowDown=te.ARROWDOWN,this.keyStrokeMap.ArrowLeft=te.ARROWLEFT,this.keyStrokeMap.ArrowRight=te.ARROWRIGHT,this.keyStrokeMap.Up=te.ARROWUP,this.keyStrokeMap.Down=te.ARROWDOWN,this.keyStrokeMap.Left=te.ARROWLEFT,this.keyStrokeMap.Right=te.ARROWRIGHT,this.keyStrokeMap.CapsLock=te.CAPSLOCK,this.keyStrokeMap.Shift=te.SHIFT,this.keyStrokeMap.Tab=te.TAB,this.keyStrokeMap.Escape=te.ESCAPE,this.keyStrokeMap.Esc=te.ESCAPE,this.keyStrokeMap.End=te.END,this.keyStrokeMap.Alt=te.ALT,this.keyStrokeMap.Control=te.CTRL,this.keyStrokeMap.Meta=te.META},t.whiteListedTextInputSelector=csArray.prototype.join.call(["textarea","input:not([type])",'input[type="text"]','input[type="email"]','input[type="search"]','input[type="tel"]','input[type="url"]','input[type="password"]'],","),t.whiteListedCheckableInputsSelector=csArray.prototype.join.call(['input[type="checkbox"]','input[type="radio"]'],","),t.whiteListedNumberInputsSelector='input[type="number"]',v([dt("scroll")],t.prototype,"scrollListener",null),v([dt("mouseOver")],t.prototype,"mouseOverListener",null),v([dt("click"),ne()],t.prototype,"clickListener",null),v([dt("mousedown"),ne()],t.prototype,"mouseDownListener",null),v([dt("mouseup"),ne()],t.prototype,"mouseUpListener",null),v([dt("checkable")],t.prototype,"inputCheckableListener",null),v([dt("select")],t.prototype,"inputSelectListener",null),v([dt("text")],t.prototype,"inputTextListener",null),v([dt("Event handler type: keyup"),ne()],t.prototype,"keyUpListener",null),v([dt("Event handler type: keydown"),ne()],t.prototype,"keyDownListener",null),v([dt("Event handler type: copy"),ne()],t.prototype,"copyListener",null),v([dt("Event handler type: cut"),ne()],t.prototype,"cutListener",null),v([dt("Event handler type: paste"),ne()],t.prototype,"pasteListener",null),v([dt("Event handler type: pointerup"),ne()],t.prototype,"pointerUpListener",null),v([dt("Event handler type: pointermove"),ne()],t.prototype,"pointerMoveListener",null),v([dt("Event handler type: pointerdown"),ne()],t.prototype,"pointerDownListener",null),v([dt("Event handler type: touchstart"),ne()],t.prototype,"touchStartListener",null),v([dt("Event handler type: touchmove"),ne()],t.prototype,"touchMoveListener",null),v([dt("Event handler type: touchend"),ne()],t.prototype,"touchEndListener",null),t}(),ae=function(){function t(t,e,r,i,n,o,s){var a=this;void 0===s&&(s=document),this.mutationSerializer=t,this.mutationObserver=e,this.staticResourceUrlTracker=r,this.lifeCycleEventsEmitter=i,this.nodeIdentifier=n,this.sensitiveContentService=o,this.refDocument=s,this.onSerializationInitialDomDone=function(t){a.onEventCallback({args:[t],date:V(),type:Dt.INITIAL_DOM}),a.lifeCycleEventsEmitter.emitInitialDomDone(t)},this.mutationObserver.onCharacterDataMutation((function(t){a.characterDataMutation(t)})),this.mutationObserver.onAttributesMutation((function(t){Yt(t.target)&&a.sensitiveContentService.isSensitive(t.target)&&"src"===t.attributeName&&(a.sensitiveContentService.unidentifySensitiveNodes(t.target),a.sensitiveContentService.identifySensitiveNodes(t.target)),a.attributesMutation(t)})),this.mutationObserver.onChildListMutation((function(t){csArray.prototype.forEach.call(t.removedNodes,(function(t){return a.sensitiveContentService.unidentifySensitiveNodes(t)})),csArray.prototype.forEach.call(t.addedNodes,(function(t){a.sensitiveContentService.identifySensitiveNodes(t),a.nodeIdentifier.identifyNodes(t)})),a.childListMutation(t)})),this.mutationObserver.onAttachShadowMutation((function(t){t.target.isConnected&&null!==csElementshadowRoot.apply(t.target)&&(a.sensitiveContentService.identifySensitiveNodes(t.target),a.nodeIdentifier.identifyNodes(csElementshadowRoot.apply(t.target)),a.attachShadowEvent(t))}))}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.mutationObserver.start(),this.recordInitialDom()},t.prototype.stop=function(){this.sensitiveContentService.unidentifySensitiveNodes(this.refDocument),this.mutationObserver.stop()},t.prototype.flushEvents=function(){this.mutationObserver.flushPendingMutations()},t.prototype.recordInitialDom=function(){this.sensitiveContentService.identifySensitiveNodes(this.refDocument),this.nodeIdentifier.identifyNodes(this.refDocument),this.mutationSerializer.serializeInitialDom(this.refDocument,this.onSerializationInitialDomDone)},t.prototype.attachShadowEvent=function(t){if(!this.sensitiveContentService.isSensitive(t.target)&&!this.sensitiveContentService.isSensitiveChild(t.target)){var e=this.mutationSerializer.serializeAttachShadowEvent(t);e&&this.onEventCallback({args:e,date:t.date,type:Dt.ATTACH_SHADOW})}},t.prototype.attributesMutation=function(t){if(!Gt(t.target)||!this.sensitiveContentService.isSensitiveChild(t.target)&&!this.sensitiveContentService.isSensitiveAttribute(t.target,t.attributeName)){var e=this.mutationSerializer.serializeMutationAttribute(t);e&&(this.onEventCallback({args:e,date:t.date,type:Dt.MUTATION_ATTRIBUTE}),this.staticResourceUrlTracker.scanAttribute(t.target,t.attributeName))}},t.prototype.characterDataMutation=function(t){var e=t.target.parentElement;if(!e||!this.sensitiveContentService.isSensitive(e)&&!this.sensitiveContentService.isSensitiveChild(e)){var r=this.mutationSerializer.serializeMutationCharacterData(t);r&&(this.onEventCallback({args:r,date:t.date,type:Dt.MUTATION_CHARACTER_DATA}),this.staticResourceUrlTracker.scanText(t.target))}},t.prototype.childListMutation=function(t){var e=this;if(!Gt(t.target)&&!Qt(t.target)||!this.sensitiveContentService.isSensitive(t.target)&&!this.sensitiveContentService.isSensitiveChild(t.target)){var r=this.mutationSerializer.serializeMutationChildList(t);if(r){var i=r.removedNodes,n=r.addedNodes;csArray.prototype.forEach.call(i,(function(r){e.onEventCallback({args:r,date:t.date,type:Dt.MUTATION_REMOVE})})),csArray.prototype.forEach.call(n,(function(r){e.onEventCallback({args:r,date:t.date,type:Dt.MUTATION_INSERT})}))}}},t}(),ce=function(){function t(t){this.storageCharsUsed=0,this.maxStoredChars=0,this.maxStoredChars=t/2}return t.prototype.add=function(t){this.storageCharsUsed+=t.length},t.prototype.isThresholdReached=function(){return this.storageCharsUsed>this.maxStoredChars},t.prototype.reset=function(){this.storageCharsUsed=0},t}(),ue=function(){function t(t,e,r){void 0===t&&(t=[]),void 0===e&&(e={}),void 0===r&&(r=512e3),this.events=t,this.requestParameters=e,this.sizeCounter=new ce(r)}return t.prototype.addEvent=function(t){this.sizeCounter.add(csJSON.stringify(t)),csArray.prototype.push.call(this.events,t)},t.prototype.eventsCount=function(){return this.events.length},t.prototype.clearEvents=function(){this.sizeCounter.reset(),this.events=[]},t.prototype.isFull=function(){return this.sizeCounter.isThresholdReached()||this.eventsCount()>=100},t.prototype.setRequestParametersFromProvider=function(t){var e=t.getRequestParameters();for(var r in e)e.hasOwnProperty(r)&&(this.requestParameters[r]=e[r])},t.prototype.removeRequestParameter=function(t){this.requestParameters.hasOwnProperty(t)&&delete this.requestParameters[t]},t.prototype.getEvents=function(){return this.events},t.prototype.extractEvents=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=[],i=[];return csArray.prototype.forEach.call(this.events,(function(e){-1!==csArray.prototype.indexOf.call(t,e.type)?csArray.prototype.push.call(r,e):csArray.prototype.push.call(i,e)})),this.events=i,r},t.prototype.getRequestPayload=function(){return csJSON.stringify(this.events)},t.prototype.getRequestParameters=function(){var t=y({},this.requestParameters);return this.events.length>0&&(t.let=this.events[this.events.length-1].date.toString()),t},t}(),pe=function(){function t(){this.index=1}return t.prototype.getCurrentIndex=function(){return this.index},t.prototype.increment=function(){this.index+=1},t.prototype.reset=function(){this.index=1},t.prototype.getRequestParameters=function(){return{ri:""+this.index}},t}();function le(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),i=0,n=t.length;i<n;i+=1)r[i]=csString.prototype.charCodeAt.call(t,i);return e}function he(t){for(var e=new Uint8Array(t),r="",i=0;i<e.byteLength;i+=1)r+=csString.fromCodePoint(e[i]);return r}function de(t){return le(self.atob(t))}!function(t){t.UNCOMPRESSED="0",t.BASE64="1"}(oe||(oe={}));var fe=function(t){this.onError=t},ye=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.algorithm="raw",e}return f(e,t),e.prototype.isSupported=function(){return!0},e.prototype.compress=function(t,e,r){if("base64"===t)return"string"!=typeof e&&(e=he(e)),r(e);r(e)},e.prototype.compressSync=function(t){return t},e}(fe),ve=function(){function t(){}return t.prototype.emit=function(e,r){var i=t.prefix+"."+e,n=t.createEvent(i,{detail:r});null!==n&&document.dispatchEvent(n)},t.createEvent=function(t,e){if(void 0===e&&(e={}),"function"==typeof CustomEvent)return new CustomEvent(t,e);var r=this.tryToCreateCustomEvent();if(null===r)return null;var i=e.bubbles,n=void 0!==i&&i,o=e.cancelable,s=void 0!==o&&o,a=e.detail;return r.initCustomEvent(t,n,s,a),r},t.tryToCreateCustomEvent=function(){try{return document.createEvent("CustomEvent")}catch(t){return null}},t.prefix="cs.tracking",t}(),me=function(){function t(){this.isStarted=!1}return t.prototype.start=function(){this.isStarted||(this.isStarted=!0,this.onStart())},t.prototype.stop=function(){this.isStarted&&(this.isStarted=!1,this.onStop())},t.prototype.restart=function(){this.stop(),this.start()},t}(),ge=function(t){function e(e,r,i,n,o,s,a,c,u,p,l,h,d,f,y,v,m,g,S,E,C){var T=t.call(this)||this;return T.configuration=e,T.recordingRequest=r,T.recordingBatch=i,T.requestParameters=n,T.requestIndex=o,T.styleSheetRuleTracker=s,T.recordingMutationsTracker=a,T.recordingPageEventsTracker=c,T.recordingBrowserEventsTracker=u,T.recordingGesturesTracker=p,T.sessionRenewer=l,T.staticResourceUrlTracker=h,T.recordingPerformanceTimingsTracker=d,T.javaScriptErrorsTracker=f,T.javaScriptErrorsAnonymizer=y,T.apiErrorsTracker=v,T.textVisibilityTracker=m,T.apiErrorsAnonymizer=g,T.encryptionService=S,T.recoveryService=E,T.customElementRegistrationTracker=C,T.javaScriptErrorsCount=0,T.apiErrorsCount=0,T.customErrorsCount=0,T.eventEmitter=new ve,T.canSendEvents=!0,T.onEvent=function(t){return T.processEvent(t)},T}return f(e,t),e.prototype.init=function(){this.bindRecordingRequest(),this.bindTrackers()},e.prototype.bindRecordingRequest=function(){var t=this;this.recordingRequest.setRequestPayloadProvider(this.recordingBatch),this.recordingRequest.setRequestParametersProviders(this.recordingBatch),this.recordingRequest.afterProvidersCalled((function(){t.recoveryService.addBatchInProgress(""+t.requestIndex.getCurrentIndex(),t.recordingBatch.getRequestParameters(),t.recordingBatch.getEvents()),t.recordingBatch.clearEvents(),t.requestIndex.increment(),t.recordingBatch.setRequestParametersFromProvider(t.requestParameters)})),this.recordingRequest.after((function(e){"ri"in e&&t.recoveryService.removeBatchInProgress(e.ri)}))},e.prototype.bindTrackers=function(){var t=this;this.styleSheetRuleTracker.onEvent(this.onEvent),this.recordingMutationsTracker.onEvent(this.onEvent),this.recordingBrowserEventsTracker.onEvent(this.onEvent),this.recordingPageEventsTracker.onEvent(this.onEvent),this.staticResourceUrlTracker.onEvent(this.onEvent),this.recordingPerformanceTimingsTracker.onEvent(this.onEvent),this.textVisibilityTracker.onEvent(this.onEvent),this.recordingGesturesTracker.onEvent(this.onEvent),this.encryptionService.onTextNodeToEncrypt(this.onEvent),this.encryptionService.onApiErrorToEncrypt((function(e){t.processApiError(e)})),this.encryptionService.onUserIdentifierToEncrypt(this.onEvent),this.customElementRegistrationTracker.onEvent(this.onEvent)},e.prototype.blockSendingEvents=function(){this.canSendEvents=!1},e.prototype.allowSendingEvents=function(){this.canSendEvents=!0},e.prototype.processEvent=function(t){this.sessionRenewer.isSessionValid()&&(this.recordingBatch.addEvent(t),this.recordingBatch.isFull()&&this.pushEvents(),this.configuration.emitDebugEvents&&this.eventEmitter.emit("recordingEvent",y(y({},t),{typeName:Dt[t.type]})))},e.prototype.onStart=function(){var t=this;this.recordingBatch.setRequestParametersFromProvider(this.requestParameters),this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){return{rst:V().toString()}}}),this.customElementRegistrationTracker.start(),this.recordingPerformanceTimingsTracker.start(),this.styleSheetRuleTracker.start(),this.textVisibilityTracker.start(),this.recordingMutationsTracker.start(),this.recordingBrowserEventsTracker.start(),this.recordingGesturesTracker.start(),this.configuration.jsErrorsEnabled&&this.javaScriptErrorsTracker.subscribe(e.SERVICE_IDENTIFIER,(function(e){return t.processJavascriptError(e)})),this.configuration.apiErrors.enabled&&this.apiErrorsTracker.subscribe(e.SERVICE_IDENTIFIER,(function(e){return t.encryptApiError(e)}),{detailedEvent:!0}),this.configuration.emitDebugEvents&&this.eventEmitter.emit("replayRecordingStarted")},e.prototype.onStop=function(){this.styleSheetRuleTracker.stop(),this.recordingMutationsTracker.stop(),this.recordingBrowserEventsTracker.stop(),this.recordingPageEventsTracker.stop(),this.javaScriptErrorsTracker.unsubscribe(e.SERVICE_IDENTIFIER),this.apiErrorsTracker.unsubscribe(e.SERVICE_IDENTIFIER),this.textVisibilityTracker.stop(),this.recordingGesturesTracker.stop(),this.customElementRegistrationTracker.stop()},e.prototype.clearStates=function(){this.recordingMutationsTracker.flushEvents(),this.pushEvents(),this.removeEtrRequestParameters()},e.prototype.initStates=function(){this.requestIndex.reset(),this.recordingBatch.setRequestParametersFromProvider(this.requestParameters),this.javaScriptErrorsCount=0,this.apiErrorsCount=0,this.customErrorsCount=0},e.prototype.pushEvents=function(){this.textVisibilityTracker.flushEvents(),this.recordingBatch.eventsCount()>0&&this.canSendEvents&&(this.isStarted?this.recordingRequest.send():this.recordingBatch.clearEvents())},e.prototype.encryptApiError=function(t){t.customRequestHeaders||t.customResponseHeaders||t.queryParameters||t.requestBody||t.responseBody?this.encryptionService.registerApiErrorToEncrypt(t):this.processApiError(t)},e.prototype.processApiError=function(t){if(this.apiErrorsCount<e.MAX_API_ERROR_COUNT){var r={type:Dt.API_ERROR,date:V(),args:[this.apiErrorsAnonymizer.anonymize(t)]};this.onEvent(r),this.apiErrorsCount=this.apiErrorsCount+1}},e.prototype.processJavascriptError=function(t){if(this.javaScriptErrorsCount<e.MAX_JAVASCRIPT_ERROR_COUNT){var r={type:Dt.JAVASCRIPT_ERROR,date:V(),args:[this.javaScriptErrorsAnonymizer.anonymize(t)]};this.onEvent(r),this.javaScriptErrorsCount=this.javaScriptErrorsCount+1}},e.prototype.processCustomError=function(t){if(this.customErrorsCount<e.MAX_CUSTOM_ERROR_COUNT){var r={type:Dt.CUSTOM_ERROR,date:V(),args:[t]};this.onEvent(r),this.customErrorsCount=this.customErrorsCount+1}},e.prototype.setEtrRequestParameters=function(t){this.isStarted&&(t===Ct.ETR_SESSION?this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){var t;return(t={})[e.ETRS_PARAMETER]=e.ETR_ACTIVE,t}}):t===Ct.ETR_PAGE&&this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){var t;return(t={})[e.ETRP_PARAMETER]=e.ETR_ACTIVE,t}}))},e.prototype.removeEtrRequestParameters=function(){this.recordingBatch.removeRequestParameter(e.ETRP_PARAMETER),this.recordingBatch.removeRequestParameter(e.ETRS_PARAMETER)},e.prototype.clearEvents=function(){this.recordingBatch.clearEvents()},e.prototype.onCustomJavaScriptErrorEvent=function(t){this.processJavascriptError(t)},e.prototype.onCustomErrorEvent=function(t){this.processCustomError(t)},e.prototype.onPageEvent=function(t){this.processPageEvent(t)},e.prototype.onUserIdentifierEvent=function(t){var e={userIdentifier:t,date:V(),keyId:this.configuration.encryptionPublicKeyId};this.encryptionService.registerUserIdentifierToEncrypt(e)},e.prototype.onEventTriggerRecording=function(t,e){this.setEtrRequestParameters(e),this.processPageEvent(t),this.pushEvents()},e.prototype.processPageEvent=function(t){var r={type:Dt.PAGE_EVENT,date:V(),args:[{eventName:csString.prototype.slice.call(t,0,e.MAX_PAGE_EVENT_LENGTH)}]};this.recordingBatch.addEvent(r)},e.prototype.triggerConsentGranted=function(){var t={date:V(),type:Dt.CONSENT_GRANTED};this.recordingBatch.addEvent(t)},e.prototype.triggerConsentWithdrawn=function(){var t={date:V(),type:Dt.CONSENT_WITHDRAWN};this.recordingBatch.addEvent(t)},e.SERVICE_IDENTIFIER="RecordingService",e.MAX_PAGE_EVENT_LENGTH=255,e.MAX_JAVASCRIPT_ERROR_COUNT=20,e.MAX_API_ERROR_COUNT=20,e.MAX_CUSTOM_ERROR_COUNT=20,e.ETRP_PARAMETER="etrp",e.ETRS_PARAMETER="etrs",e.ETR_ACTIVE="1",e}(me),Se=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;return s.recordingRecoveryRequest=e,s.recordingBatch=r,s.recoveryStorage=i,s.configuration=n,s.lastMessageBeaconRequest=o,s.batchesInProgress={},s.pageChangeHandler=function(){try{s.saveBatchesInProgress();var t=s.recordingBatch.getRequestParameters();if(!s.hasValidRecordingType(t.rt))return;if(s.sendLastMessageBeacon(),0===s.recordingBatch.eventsCount())return;s.configuration.useMalkaPipeline&&(t.hlm="true"),s.recoveryStorage.save("last",{metadata:t,events:s.recordingBatch.getEvents()})}catch(t){}},s}return f(e,t),e.prototype.onStart=function(){this.batchesInProgress={},this.addPageChangeListener()},e.prototype.onStop=function(){this.removePageChangeListener()},e.prototype.recover=function(){this.sendPersistedRecordings()},e.prototype.addBatchInProgress=function(t,e,r){this.batchesInProgress[t]={metadata:e,events:r}},e.prototype.removeBatchInProgress=function(t){delete this.batchesInProgress[t]},e.prototype.sendPersistedRecordings=function(){var t=this,e=this.recoveryStorage.recover(),r=e.rawBatches,i=e.recoveredSize;if(0!==r.length){var n=csArray.prototype.map.call(csArray.prototype.filter.call(r,(function(e){var r=e.metadata;return t.hasValidRecordingType(r.rt)})),(function(e){var r=e,i=r.metadata,n=r.events,o=new ue(n,i);return t.recordingRecoveryRequest.setRequestPayloadProvider(o),t.recordingRecoveryRequest.setRequestParametersProviders(o),t.recordingRecoveryRequest.send(),e}));i>1048576&&ht.warn("\n        Size of data retrieved from local storage "+i+" exceeds 1048576.\n        Number of tabs saved in local storage: "+n.length+"\n      ")}},e.prototype.sendLastMessageBeacon=function(){this.configuration.useMalkaPipeline&&this.lastMessageBeaconRequest.send()},e.prototype.addPageChangeListener=function(){window.addEventListener("pagehide",this.pageChangeHandler)},e.prototype.removePageChangeListener=function(){window.removeEventListener("pagehide",this.pageChangeHandler)},e.prototype.hasValidRecordingType=function(t){return!this.configuration.useMalkaPipeline||!!t&&-1===csString.prototype.indexOf.call(t,St.TEMPORARILY_RECORDED)},e.prototype.saveBatchesInProgress=function(){var t=Object.keys(this.batchesInProgress);if(t.length<=3)for(var e=0,r=t;e<r.length;e++){var i=r[e],n=this.batchesInProgress[i],o=n.metadata,s=n.events;this.recoveryStorage.save(i,{metadata:o,events:s})}},e}(me),Ee=/[^\s]/g;function Ce(t){return csString.prototype.replace.call(t,Ee,"a")}var Te=function(){function t(t,e,r,i,n,o,s){this.consentService=t,this.domSerializer=e,this.nodeIdentifier=r,this.anonymization=i,this.encryptionService=n,this.configuration=o,this.urlService=s,this.domSerializationInProgress=!1}return t.prototype.init=function(){this.resetAnonymization()},t.prototype.isDOMSerializationInProgress=function(){return this.domSerializationInProgress},t.prototype.serializeInitialDom=function(t,e){if(this.domSerializer.isAsynchronous())this.serializeDocumentAsync(t).then((function(t){e(t)})).catch((function(t){ht.error(t)}));else{var r=this.serializeDocumentSync(t);e(r)}},t.prototype.serializeDocumentSync=function(t){return this.domSerializer.serialize(t,{withAnonymization:this.useAnonymization})},t.prototype.serializeDocumentAsync=function(t){return m(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:this.domSerializationInProgress=!0,e.label=1;case 1:return e.trys.push([1,,3,4]),[4,this.domSerializer.startSerializeAsync(t,{withAnonymization:this.useAnonymization})];case 2:return[2,e.sent()];case 3:return this.domSerializationInProgress=!1,[7];case 4:return[2]}}))}))},t.prototype.serializeMutationCharacterData=function(t){var e=this.nodeIdentifier.getId(t.target);if(!e)return ht.warn("serializeMutationCharacterData: node without identifier"),null;var r=t.target;if(r.data===t.oldValue)return null;var i=t.target.parentElement;if(jt(r)&&(null==i?void 0:i.hasAttribute("data-cs-encrypt")))return this.encryptionService.registerTextNodeMutationToEncrypt({targetId:e,textNode:r,serializedTextData:Ce(r.data),date:t.date}),null;var n=[e,this.anonymization.getAnonymizedText(this.useAnonymization,r)];return this.isAsyncSerialization(this.domSerializer)&&this.isDOMSerializationInProgress()&&this.domSerializer.updateTextNode(n),n},t.prototype.serializeAttachShadowEvent=function(t){var e=this.nodeIdentifier.getId(t.target);return e?[e,this.domSerializer.serialize(t.shadowRoot)]:(ht.warn("serializeAttachShadowEvent: node without identifier"),null)},t.prototype.serializeMutationAttribute=function(t){var e=this.nodeIdentifier.getId(t.target);if(!e)return ht.warn("serializeMutationAttribute: node without identifier"),null;var r=t.target,i=t.attributeName,n=t.attributeNamespace,o=t.target.getAttributeNS(n,i);if(o===t.oldValue)return null;o&&(o=this.anonymization.getAnonymizedAttributeValue(r,this.useAnonymization,i,o));var s=[e,n,i,o];return this.isAsyncSerialization(this.domSerializer)&&this.isDOMSerializationInProgress()&&this.domSerializer.updateAttribute(s,this.useAnonymization),s},t.prototype.serializeMutationChildList=function(t){var e=this.nodeIdentifier.getId(t.target);if(!e)return ht.warn("serializeMutationChildList: node without identifier"),null;var r={removedNodes:this.serializeRemovedNodes(t),addedNodes:this.serializeAddedNodes(t,e)};return this.isAsyncSerialization(this.domSerializer)&&this.isDOMSerializationInProgress()&&this.domSerializer.updateChildren(e,r),r},t.prototype.isAsyncSerialization=function(t){return t.isAsynchronous()},t.prototype.serializeRemovedNodes=function(t){for(var e=[],r=0;r<t.removedNodes.length;r+=1){var i=this.nodeIdentifier.getId(t.removedNodes[r]);i&&csArray.prototype.push.call(e,[i])}return e},t.prototype.serializeAddedNodes=function(t,e){var r=[],i=null;if(t.nextSibling){var n=this.nodeIdentifier.getId(t.nextSibling);i=void 0!==n?n:null}for(var o=0;o<t.addedNodes.length;o+=1){var s=t.addedNodes[o],a=this.domSerializer.serialize(s,{withAnonymization:this.useAnonymization});csArray.prototype.push.call(r,[e,i,a])}return r},t.prototype.resetAnonymization=function(){this.useAnonymization=!this.consentService.isAllowedByConsent(),this.useAnonymization?this.configuration.replayRecordingUnmaskedUrlRegex&&this.configuration.replayRecordingUnmaskedUrlRegex.test(this.urlService.getUrl())&&(this.useAnonymization=!1):this.configuration.replayRecordingMaskedUrlRegex&&this.configuration.replayRecordingMaskedUrlRegex.test(this.urlService.getUrl())&&(this.useAnonymization=!0)},t}(),Re=function(){function t(t,e,r,i){var n=this;this.monkeyPatcher=t,this.nodeIdentifier=e,this.sensitiveContentService=r,this.staticResourceUrlTracker=i,this.canTrackRuleInsertions()&&(this.insertRuleInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:window.CSSStyleSheet.prototype,methodName:"insertRule",hook:function(t){var e=t.context,r=t.args;return n.sendInsertion(e,r)}})),this.canTrackRuleDeletions()&&(this.deleteRuleInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:window.CSSStyleSheet.prototype,methodName:"deleteRule",hook:function(t){var e=t.context,r=t.args;return n.sendDeletion(e,r)}})),this.canTrackStyleDeclarationChanges()&&(this.cssTextInterceptor=this.monkeyPatcher.createDescriptorInterceptor(window.CSSStyleDeclaration.prototype,"cssText",(function(t,e){return n.setStyleDeclarationCssText(t,e)})))}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.insertRuleInterceptor&&this.insertRuleInterceptor.activate(),this.deleteRuleInterceptor&&this.deleteRuleInterceptor.activate(),this.cssTextInterceptor&&this.cssTextInterceptor.activate()},t.prototype.stop=function(){this.insertRuleInterceptor&&this.insertRuleInterceptor.deactivate(),this.deleteRuleInterceptor&&this.deleteRuleInterceptor.deactivate(),this.cssTextInterceptor&&this.cssTextInterceptor.deactivate()},t.prototype.setStyleDeclarationCssText=function(t,e){var r=this.getSyleSheet(t);if((null==r?void 0:r.ownerNode)&&(!at(r.ownerNode)||!this.sensitiveContentService.isSensitiveChild(r.ownerNode))){var i=this.nodeIdentifier.getId(r.ownerNode);if(i){var n=this.indexOfRule(r.cssRules,t.parentRule);this.onEventCallback({date:V(),type:Dt.STYLESHEET_CSS_TEXT_UPDATE,args:[i,n,e]}),this.staticResourceUrlTracker.scanCssString(e)}}},t.prototype.getSyleSheet=function(t){var e=t.parentRule;return e&&e.parentStyleSheet},t.prototype.indexOfRule=function(t,e){return csArray.prototype.indexOf.call(csArray.from(t),e)},t.prototype.canTrackRuleInsertions=function(){var t,e;return"function"==typeof(null===(e=null===(t=window.CSSStyleSheet)||void 0===t?void 0:t.prototype)||void 0===e?void 0:e.insertRule)},t.prototype.canTrackRuleDeletions=function(){var t,e;return"function"==typeof(null===(e=null===(t=window.CSSStyleSheet)||void 0===t?void 0:t.prototype)||void 0===e?void 0:e.deleteRule)},t.prototype.canTrackStyleDeclarationChanges=function(){return window.CSSStyleDeclaration&&window.CSSStyleDeclaration.prototype&&Object.getOwnPropertyDescriptor(window.CSSStyleDeclaration.prototype,"cssText")},t.prototype.sendInsertion=function(t,e){var r=e[0],i=e[1];if(t.ownerNode&&(!at(t.ownerNode)||!this.sensitiveContentService.isSensitiveChild(t.ownerNode))){var n=this.nodeIdentifier.getId(t.ownerNode);n&&(this.onEventCallback({date:V(),type:Dt.STYLESHEET_RULE_INSERT,args:nt(i)?[n,r,i]:[n,r]}),this.staticResourceUrlTracker.scanCssString(r))}},t.prototype.sendDeletion=function(t,e){var r=e[0];if(t.ownerNode&&(!at(t.ownerNode)||!this.sensitiveContentService.isSensitiveChild(t.ownerNode))){var i=this.nodeIdentifier.getId(t.ownerNode);i&&this.onEventCallback({date:V(),type:Dt.STYLESHEET_RULE_DELETE,args:[i,r]})}},v([dt("styleSheetRuleTracker.setStyleDeclarationCssText")],t.prototype,"setStyleDeclarationCssText",null),v([dt("styleSheetRuleTracker.sendInsertion")],t.prototype,"sendInsertion",null),v([dt("styleSheetRuleTracker.sendDeletion")],t.prototype,"sendDeletion",null),t}(),be=function(){function t(){this.documentIdentifiedHandlers=[],this.currentCsId=1}return t.prototype.identifyNodes=function(t){for(var e,r=document.createNodeIterator(t,NodeFilter.SHOW_ALL,null,!1);e=r.nextNode();)if(e.__contentsquare_identifier=this.currentCsId,this.currentCsId+=1,Gt(e)&&csElementshadowRoot.apply(e)){var i=csElementshadowRoot.apply(e);this.identifyNodes(i)}else Qt(e)&&this.notifySubscribers(e)},t.prototype.getId=function(t){return t.__contentsquare_identifier},t.prototype.onDocumentIdentified=function(t){csArray.prototype.push.call(this.documentIdentifiedHandlers,t)},t.prototype.notifySubscribers=function(t){for(var e=0,r=this.documentIdentifiedHandlers;e<r.length;e++){(0,r[e])(t)}},t}(),we=function(){function t(){}return t.prototype.beforeSerialize=function(t,e){return t},t.prototype.beforeSerializeChildren=function(t,e,r){return e},t.prototype.beforeSerializeAttributes=function(t,e,r){return e},t.prototype.serializeNode=function(t,e,r){return e},t.prototype.afterSerialize=function(t,e,r){return e},t.prototype.afterSerializeShadowRoot=function(t,e,r){return e},t.prototype.serializeElementNode=function(t,e,r){return e},t.prototype.serializeAttribute=function(t,e,r,i){return r},t.prototype.serializeTextNode=function(t,e,r){return e},t.prototype.serializeCDATASectionNode=function(t,e,r){return e},t.prototype.serializeCommentNode=function(t,e,r){return e},t.prototype.serializeDoctypeNode=function(t,e,r){return e},t.prototype.serializeDocumentNode=function(t,e,r){return e},t.prototype.serializeShadowRootNode=function(t,e,r){return e},t}(),Ae=function(t){function e(e){var r=t.call(this)||this;return r.sensitiveContentService=e,r}return f(e,t),e.prototype.beforeSerializeChildren=function(t,e){return this.isSensitiveElementNode(t)||this.hasSensitiveShadowHost(t)?[]:e},e.prototype.beforeSerializeAttributes=function(t,e){var r=this;return this.isSensitiveElementNode(t)&&!Jt(t)&&(csArray.prototype.push.call(e,this.createSensitiveElementDimensionsAttribute(t)),t.hasAttribute("data-cs-mask")||csArray.prototype.push.call(e,document.createAttribute("data-cs-mask"))),csArray.prototype.filter.call(e,(function(e){return!r.sensitiveContentService.isSensitiveAttribute(t,e.name)}))},e.prototype.isSensitiveElementNode=function(t){return Gt(t)&&this.sensitiveContentService.isSensitive(t)},e.prototype.hasSensitiveShadowHost=function(t){return Zt(t)&&this.sensitiveContentService.isSensitive(t.host)},e.prototype.createSensitiveElementDimensionsAttribute=function(t){var e=t.getBoundingClientRect(),r=document.createAttribute("style");return r.value="width: "+e.width+"px !important; height: "+e.height+"px !important;",r},e}(we);function ke(t){return csString.prototype.replace.call(t,/([#;&,.+*~':"!^$[\]()<=>|/%?@`{}\\ ])/g,"\\$1")}var Ie;function Pe(t,e,r){var i=csArray.prototype.shift.call(t);if(0===t.length)return Ne(i,r);var n=function(t,e,r,i){var n=i.dynamicIdRegex||null,o=function(t){return ke(csString.prototype.toLowerCase.call(t.localName))}(t);if(function(t,e){var r=Ve(t);return r&&csString.prototype.match.call(r,/^[\w-]+$/)&&qe("data-cs-override-id",r,e)}(t,r)){var s=Ve(t);return{hasUniqueIdentifier:!0,elementSelector:o+'[data-cs-override-id="'+s+'"]'}}var a=function(t,e,r){if(!r.uniqueAttributes)return{success:!1};for(var i=0,n=r.uniqueAttributes;i<n.length;i++){var o=n[i],s=t.getAttribute(o);if(null!==s)if(qe(o,s,e))return{attributeName:o,attributeValue:s,success:!0}}return{success:!1}}(t,r,i);if(a.success)return{hasUniqueIdentifier:!0,elementSelector:o+"#UA["+a.attributeName+'="'+a.attributeValue+'"]'};var c=function(t,e,r){if(!r.uniqueCssSelectors)return;for(var i=0,n=r.uniqueCssSelectors;i<n.length;i++){var o=n[i];if(De.call(t,o)&&ze(o,e))return o}return}(t,r,i);if(c)return{hasUniqueIdentifier:!0,elementSelector:o+"#UCS["+c+"]"};var u=function(t){var e=t.getAttribute("id");return e?ke(e):e}(t);if(function(t,e,r,i){return e&&!function(t){return null!==Ve(t)}(t)&&!function(t,e,r){return t.hasAttribute("data-cs-dynamic-id")||function(t,e){var r=!1;t&&e&&(r=e.test(t));return t&&(csArray.prototype.some.call(_e,(function(e){return e.test(t)}))||r)}(e,r)}(t,e,i)&&function(t,e){return t&&qe("id",t,e)}(e,r)}(t,u,r,n))return{hasUniqueIdentifier:!0,elementSelector:o+"#"+u};var p=function(t,e){if(!e.reliableSelectors)return;for(var r=0,i=e.reliableSelectors;r<i.length;r++){var n=i[r];if(De.call(t,n))return n}return}(t,i);if(p){var l=function(t,e,r){if(t===Oe||9===t.nodeType)return 0;var i=0,n=e.previousElementSibling;for(;n;)De.call(n,r)&&(i+=1),n=n.previousElementSibling;return i}(e,t,p);return{hasUniqueIdentifier:!1,elementSelector:o+"["+p+"]("+l+")"}}var h=function(t,e,r){if(t===Oe||9===t.nodeType)return 0;var i=csString.prototype.toLowerCase.call(e.localName),n=0,o=e.previousElementSibling;for(;o;)o.localName!==i||xe(o,r.reliableSelectors)||(n+=1),o=o.previousElementSibling;return n}(e,t,i);return{hasUniqueIdentifier:!1,elementSelector:o+":eq("+h+")"}}(i,t[0],e,r),o=n.elementSelector,s=n.hasUniqueIdentifier;if(!r.fullPath&&s)return""+Ne(t[t.length-1],r)+o;var a=Pe(t,e,r);return(a?a+">":"")+o}function Ne(t,e){if(t===Oe)return"|detached|";if(t.host){var r=Le(t.host);return Pe(r.ancestors,r.selectionRoot,e)+"|shadow-root|"}return 11===t.nodeType?"|fragment|":""}!function(t){function e(t){return!!t&&"localName"in t&&"getAttribute"in t&&"hasAttribute"in t&&"parentNode"in t}function r(t){return t&&"jquery"in t&&1===t.length?t[0]:t}t.INVALID_ELEMENT="INVALID_ELEMENT",t.isValidElement=e,t.getElementPath=function(i,n){void 0===n&&(n={fullPath:!1,dynamicIdRegex:null});var o=r(i);if(o===document)return"";if(!e(o))return t.INVALID_ELEMENT;var s=Le(o);return Pe(s.ancestors,s.selectionRoot,n)},t.getElementPathAndFirstAnchorParent=function(i,n){void 0===n&&(n={fullPath:!1,dynamicIdRegex:null});var o=r(i);if(o===document)return{path:"",firstAnchorParent:null};if(!e(o))return{path:t.INVALID_ELEMENT,firstAnchorParent:null};var s=function(t){var e=t,r=[e],i=null;for(;null!==csNodeparentNode.apply(e);)null===i&&Kt(e)&&(i=e),csArray.prototype.push.call(r,csNodeparentNode.apply(e)),e=csNodeparentNode.apply(e);Me(e)&&csArray.prototype.push.call(r,Oe);return{firstAnchorParent:i,ancestors:r,selectionRoot:e}}(o),a=s.firstAnchorParent;return{path:Pe(s.ancestors,s.selectionRoot,n),firstAnchorParent:a}}}(Ie||(Ie={}));var Oe="detached";function Le(t){for(var e=t,r=[e];null!==csNodeparentNode.apply(e);)e=csNodeparentNode.apply(e),csArray.prototype.push.call(r,e);return Me(e)&&csArray.prototype.push.call(r,Oe),{ancestors:r,selectionRoot:e}}function Me(t){return Ie.isValidElement(t)}var De=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;function xe(t,e){return!!e&&csArray.prototype.some.call(e,(function(e){return De.call(t,e)}))}var _e=[/\d{4}/,/^ember\d+$/];function Ve(t){return t.getAttribute("data-cs-override-id")}function qe(t,e,r){try{return 1===r.querySelectorAll("["+t+'="'+e+'"]').length}catch(t){if("SyntaxError"!==t.name)throw t}return!1}function ze(t,e){try{return 1===e.querySelectorAll(t).length}catch(t){if("SyntaxError"!==t.name)throw t}return!1}var Ue,Be=["id","class","style","src","srcset","sizes","href","rel","type","width","height","media","align","dir","bgcolor","color","border","colspan","rowspan","cols","rows","size","start","data-cs-override-id"],He=function(t){function e(e,r){var i=t.call(this)||this;return i.pii=e,i.configuration=r,i.allWhitelistedAttributes=[],i}return f(e,t),e.prototype.init=function(){this.allWhitelistedAttributes=S(Be,this.configuration.whitelistedAttributes)},e.prototype.beforeSerializeChildren=function(t,e,r){return(Xt(t)||this.isWhitelistedElement(t))&&(r.withAnonymization=!1),e},e.prototype.serializeNode=function(t,e,r){return e.anonymized=r.withAnonymization,e},e.prototype.serializeAttribute=function(t,e,r,i){r.anonymized=i.withAnonymization;var n=this.getAnonymizedAttributeValue(t,i.withAnonymization,e.name,e.value);return r.value=n,r},e.prototype.serializeTextNode=function(t,e,r){return e.data=this.getAnonymizedText(r.withAnonymization,t),e},e.prototype.serializeCDATASectionNode=function(t,e,r){var i=t.data;return e.data=r.withAnonymization?Ce(i):this.pii.anonymize(i),e},e.prototype.getAnonymizedText=function(t,e){if(csNodeparentNode.apply(e)){if(Xt(csNodeparentNode.apply(e)))return e.data;if(this.isWhitelistedElement(csNodeparentNode.apply(e)))return this.pii.anonymize(e.data)}return t?Ce(e.data):this.pii.anonymize(e.data)},e.prototype.getAnonymizedAttributeValue=function(t,e,r,i){return this.isWhitelistedAttribute(r)||Gt(n=t)&&"ownerSVGElement"in n?i:e?"":this.pii.anonymize(i);var n},e.prototype.setWhitelistedElementsSelector=function(t){this.whitelistedElementsSelector=t},e.prototype.isWhitelistedAttribute=function(t){return-1!==csArray.prototype.indexOf.call(this.allWhitelistedAttributes,t)},e.prototype.isWhitelistedElement=function(t){return Gt(t)&&(t.hasAttribute("data-cs-capture")||this.elementMatchesWhitelistedSelectors(t))},e.prototype.elementMatchesWhitelistedSelectors=function(t){return!!this.whitelistedElementsSelector&&De.call(t,this.whitelistedElementsSelector)},e}(we),Fe=function(){function t(t){this.prefixStorageName=t;var e=csString.prototype.slice.call(""+Math.random(),2,8);this.storageName=""+this.prefixStorageName+e}return t.prototype.save=function(t,e){localStorage.setItem(this.storageName+"."+t,csJSON.stringify(e))},t.prototype.recover=function(){var t=this,e=0,r=[];return csArray.prototype.forEach.call(this.getStorageKeys(),(function(i){var n=localStorage.getItem(i);if(null!==n){e+=n.length;var o=t.parseStoredItem(n,i);o&&csArray.prototype.push.call(r,o),t.removeItem(i)}})),{rawBatches:r,recoveredSize:e}},t.prototype.getStorageKeys=function(){for(var t=[],e=0;e<localStorage.length;e+=1){var r=localStorage.key(e);r&&T(r,this.prefixStorageName)&&csArray.prototype.push.call(t,r)}return t},t.prototype.removeItem=function(t){localStorage.removeItem(t)},t.prototype.parseStoredItem=function(t,e){try{return csJSON.parse(t)}catch(r){return ht.error("Invalid item in localStorage.(key:"+e+"; value:"+t+")"),null}},t}(),Ge=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.requestParametersProviders=t}return t.prototype.addProvider=function(t){csArray.prototype.push.call(this.requestParametersProviders,t)},t.prototype.getRequestParameters=function(){return csArray.prototype.reduce.call(this.requestParametersProviders,(function(t,e){return y(y({},e.getRequestParameters()),t)}),{})},t}(),je=function(){function t(t){this.asyncTaskFactory=t,this.userActive=!1,this.pendingInactivity=null}return t.prototype.start=function(){this.userActive=!0,this.createPendingInactivity()},t.prototype.stop=function(){this.userActive=!1,this.clearPendingInactivity()},t.prototype.trackActivity=function(){this.userActive||(this.userActive=!0,this.onActivityResumedCallback()),this.clearPendingInactivity(),this.createPendingInactivity()},t.prototype.createPendingInactivity=function(){var t=this;this.pendingInactivity=this.asyncTaskFactory.create("recorded user inactive",(function(){t.userActive=!1,t.clearPendingInactivity(),t.onActivityStoppedCallback()}),5e3)},t.prototype.clearPendingInactivity=function(){null!==this.pendingInactivity&&(this.pendingInactivity.cancel(),this.pendingInactivity=null)},t.prototype.isUserActive=function(){return this.userActive},t.prototype.onActivityStopped=function(t){this.onActivityStoppedCallback=t},t.prototype.onActivityResumed=function(t){this.onActivityResumedCallback=t},t}(),Ke=function(){function t(t,e,r){var i=this;this.taskName=t,this.task=e,this.timeout=r,this.timeoutId=setTimeout((function(){i.execute()}),this.timeout)}return t.prototype.execute=function(){var t=this;ht.tryToExecute(this.taskName,(function(){t.task()}))()},t.prototype.cancel=function(){clearTimeout(this.timeoutId)},t}(),We=function(){function t(){}return t.prototype.create=function(t,e,r){return new Ke(t,e,r)},t}();!function(t){function e(){var t=[i()];return document.documentElement&&csArray.prototype.push.call(t,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),document.body&&csArray.prototype.push.call(t,document.body.scrollHeight,document.body.offsetHeight),Math.max.apply(Math,t)}function r(){return document.documentElement.scrollWidth}function i(){return window.innerHeight}function n(){return window.innerWidth}function o(){var t=window.csScreen.width;return et(t)&&t>0?t:window.screen.width}function s(){var t=window.csScreen.height;return et(t)&&t>0?t:window.screen.height}t.documentHeight=e,t.documentWidth=r,t.windowHeight=i,t.windowWidth=n,t.screenWidth=o,t.screenHeight=s,t.windowOffsetX=function(){return window.pageXOffset},t.windowOffsetY=function(){return window.pageYOffset},t.getRequestParameters=function(){return{dw:""+r(),dh:""+e(),ww:""+n(),wh:""+i(),sw:""+o(),sh:""+s()}}}(Ue||(Ue={}));var Ye=function(){function t(t,e){var r=this;this.location=t,this.pii=e,this.eventHandlers=[{boundElement:window,type:"resize",listener:function(){return r.resizeListener()}},{boundElement:window,type:"hashchange",listener:function(){return r.hashChangeListener()}},{boundElement:window,type:"mousemove",listener:function(t){return r.mouseMoveListener(t)}},{boundElement:document,type:"visibilitychange",listener:function(){return r.visibilityChangeListener()}}]}return t.prototype.onEvent=function(t){this.onEventCallback=function(e){e.date=V(),t(e)}},t.prototype.start=function(){this.bindHandlers(),this.triggerInitialEvents()},t.prototype.stop=function(){this.unbindHandlers()},t.prototype.bindHandlers=function(){csArray.prototype.forEach.call(this.eventHandlers,(function(t){return Ht(t)}))},t.prototype.unbindHandlers=function(){csArray.prototype.forEach.call(this.eventHandlers,(function(t){return Ft(t)}))},t.prototype.triggerInitialEvents=function(){this.resizeListener(),this.hashChangeListener()},t.prototype.resizeListener=function(){this.onEventCallback({type:Dt.RESIZE,args:[Ue.windowWidth(),Ue.windowHeight()]})},t.prototype.hashChangeListener=function(){this.onEventCallback({type:Dt.HASH_CHANGE,args:[this.pii.anonymize(this.location.href)]})},t.prototype.visibilityChangeListener=function(){this.onEventCallback({type:Dt.VISIBILITY_CHANGE,args:[document.visibilityState]})},t.prototype.mouseMoveListener=function(t){this.onEventCallback({type:Dt.MOUSE_MOVE,args:[t.clientX,t.clientY]})},v([dt("resize")],t.prototype,"resizeListener",null),v([dt("hashChange")],t.prototype,"hashChangeListener",null),v([dt("visibilityChange")],t.prototype,"visibilityChangeListener",null),v([dt("mouseMove")],t.prototype,"mouseMoveListener",null),t}(),Xe=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;return s.recordingPageEventsTracker=e,s.recordingMutationsTracker=r,s.recordingActivityTracker=i,s.recordingRequest=n,s.mutationSerializer=o,s.recordingRequestDuringInactivityCount=0,s.isMutationTrackerStopped=!1,s}return f(e,t),e.prototype.init=function(){var t=this;this.recordingPageEventsTracker.onEvent((function(){t.recordingActivityTracker.trackActivity(),t.recordingRequestDuringInactivityCount=0})),this.recordingRequest.after((function(){t.recordingRequestDuringInactivityCount+=1,t.stopMutationTrackerIfNeeded()})),this.recordingActivityTracker.onActivityStopped((function(){t.stopMutationTrackerIfNeeded()})),this.recordingActivityTracker.onActivityResumed((function(){t.isMutationTrackerStopped&&(t.recordingMutationsTracker.start(),t.isMutationTrackerStopped=!1)}))},e.prototype.onStart=function(){this.recordingActivityTracker.start()},e.prototype.onStop=function(){this.recordingActivityTracker.stop()},e.prototype.stopMutationTrackerIfNeeded=function(){!this.isMutationTrackerStopped&&!this.mutationSerializer.isDOMSerializationInProgress()&&!this.recordingActivityTracker.isUserActive()&&this.recordingRequestDuringInactivityCount>=2&&(this.recordingMutationsTracker.stop(),this.isMutationTrackerStopped=!0)},e}(me),Je=r(2);function Qe(t){var e=csString.prototype.trim.call(t);if(""===t)return[];var r,i=(r=e,csString.prototype.split.call(r,/\s(.+)/)),n=i[0],o=i[1];return o?(R(n,",")||(o=function(t){return csString.prototype.split.call(t,/,(.+)/)[1]||""}(o)),S([Ze(n)],Qe(o))):[Ze(n)]}function Ze(t){return csString.prototype.split.call(t,/,$/)[0]}var $e,tr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.onEvent=function(t){this.onEventCallback=t},e.prototype.serializeElementNode=function(t,e,r){return this.scanElement(t),e},e.prototype.beforeSerializeChildren=function(t,e,r){return this.scanStyleElement(t,e),e},e.prototype.scanElement=function(t){this.scanElementAttributes(t)},e.prototype.scanAttribute=function(t,e){this.scanElementAttributes(t,e)},e.prototype.scanText=function(t){jt(t)&&csNodeparentNode.apply(t)&&Xt(csNodeparentNode.apply(t))&&this.scanCssString(t.data)},e.prototype.scanStyleElement=function(t,e){if(Xt(t))for(var r=0,i=e;r<i.length;r++){var n=i[r];jt(n)&&this.scanCssString(n.data)}},e.prototype.scanElementAttributes=function(t,e){this.scanCssLink(t,e),this.scanImage(t,e),this.scanStyleAttribute(t,e)},e.prototype.scanCssLink=function(t,e){!Wt(t)||e&&"href"!==e||!t.href||this.onStaticResourceUrl(t.href)},e.prototype.scanImage=function(t,e){Yt(t)&&(e&&"src"!==e||!t.src||this.isDataUrl(t.src)||null===t.getAttribute("src")||this.isHashStartUrl(t.getAttribute("src"))||this.onStaticResourceUrl(t.src),e&&"srcset"!==e||!t.srcset||this.scanSrcset(t.srcset))},e.prototype.scanStyleAttribute=function(t,e){if((!e||"style"===e)&&t.hasAttribute("style")){var r=t.getAttribute("style");if("string"!=typeof r)throw new Error("Unexpected style: "+t.outerHTML);this.scanCssString(r)}},e.prototype.isHashStartUrl=function(t){return T(t,"#")},e.prototype.isDataUrl=function(t){return T(t,"data:")},e.prototype.scanCssString=function(t){this.processRawUrls(Object(Je.extractFrom)(t))},e.prototype.scanSrcset=function(t){this.processRawUrls(Qe(t))},e.prototype.processRawUrls=function(t){var e=this;return csArray.prototype.forEach.call(csArray.prototype.map.call(csArray.prototype.filter.call(csArray.prototype.filter.call(t,(function(t){return!e.isDataUrl(t)})),(function(t){return!e.isHashStartUrl(t)})),(function(t){return G(t)})),(function(t){return e.onStaticResourceUrl(t)}))},e.prototype.onStaticResourceUrl=function(t){this.onEventCallback({date:V(),type:Dt.STATIC_RESOURCE_URL,args:[t]})},e}(we);!function(t){t.REQUEST_START="requestStart",t.DOM_INTERACTIVE="domInteractive"}($e||($e={}));var er=function(){function t(t){this.windowPerformance=t.performance}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.areTimingsAvailable()&&this.recordPerformanceTimings()},t.prototype.recordPerformanceTimings=function(){var t=this.getPerformanceTimings();this.onEventCallback({args:t,date:V(),type:Dt.PERFORMANCE_TIMINGS})},t.prototype.areTimingsAvailable=function(){return!(!this.windowPerformance||!this.windowPerformance.timing)},t.prototype.getPerformanceTimings=function(){return[{performanceTiming:$e.REQUEST_START,timestamp:this.windowPerformance.timing.requestStart},{performanceTiming:$e.DOM_INTERACTIVE,timestamp:this.windowPerformance.timing.domInteractive}]},t}(),rr=function(t){function e(e){var r=t.call(this)||this;return r.monkeyPatcher=e,r}return f(e,t),e.prototype.init=function(){this.initInterceptors(),this.initMutationObserver()},e.prototype.initMutationObserver=function(){var t=this;this.observer=new csMutationObserver((function(e){t.handleMutations(e)}))},e.prototype.initInterceptors=function(){var t=this;this.supportAttachShadow()&&(this.attachShadowInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:Element.prototype,methodName:"attachShadow",hook:function(e){var r=e.context,i=e.result;return t.handleAttachShadow(r,i)}})),this.supportCreateShadowRoot()&&(this.createShadowRootInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:Element.prototype,methodName:"createShadowRoot",hook:function(e){var r=e.context,i=e.result;return t.handleAttachShadow(r,i)}}))},e.prototype.onChildListMutation=function(t){this.childListMutationCallback=t},e.prototype.onCharacterDataMutation=function(t){this.characterDataMutationCallback=t},e.prototype.onAttributesMutation=function(t){this.attributesMutationCallback=t},e.prototype.onAttachShadowMutation=function(t){this.attachShadowMutationCallback=t},e.prototype.observe=function(t,e){this.isStarted&&this.observer.observe(t,e)},e.prototype.onStart=function(){this.attachShadowInterceptor&&this.attachShadowInterceptor.activate(),this.createShadowRootInterceptor&&this.createShadowRootInterceptor.activate()},e.prototype.onStop=function(){this.attachShadowInterceptor&&this.attachShadowInterceptor.deactivate(),this.createShadowRootInterceptor&&this.createShadowRootInterceptor.deactivate(),this.observer.disconnect()},e.prototype.flushPendingMutations=function(){if(this.isStarted){var t=this.observer.takeRecords();this.handleMutations(t)}},e.prototype.supportAttachShadow=function(){return window.Element&&window.Element.prototype&&"function"==typeof window.Element.prototype.attachShadow},e.prototype.supportCreateShadowRoot=function(){return window.Element&&window.Element.prototype&&"function"==typeof window.Element.prototype.createShadowRoot},e.prototype.handleMutations=function(t){for(var e=V(),r=0;r<t.length;r+=1){var i=t[r];switch(i.date=e,i.type){case"attributes":this.attributesMutationCallback(i);break;case"characterData":this.characterDataMutationCallback(i);break;case"childList":this.childListMutationCallback(i);break;default:throw new Error("mutation type is not supported")}}},e.prototype.handleAttachShadow=function(t,e){this.attachShadowMutationCallback({shadowRoot:e,date:V(),target:t})},v([dt("mutations")],e.prototype,"handleMutations",null),e}(me),ir=function(t){function e(e,r){var i=t.call(this,e)||this;return i.nodeIdentifier=r,i.recordingMutationObserverOptions={subtree:!0,attributes:!0,childList:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0},i}return f(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.initSubscribers()},e.prototype.initSubscribers=function(){var t=this;this.nodeIdentifier.onDocumentIdentified((function(e){t.observe(e,t.recordingMutationObserverOptions)}))},e}(rr);function nr(){var t,e=(t=new Error).stack?csArray.prototype.filter.call(csString.prototype.split.call(t.stack,"\n"),(function(t){return"Error"!==t&&-1===csString.prototype.indexOf.call(csString.prototype.toLowerCase.call(t),"promise ")&&-1===csString.prototype.indexOf.call(t,"[native code]")})):[];if(0===e.length)return"";var r=function(t){return t.length>0?or(t[0]):""}(e);return""===r||0===(e=function(t,e){return csArray.prototype.filter.call(t,(function(t){return-1===csString.prototype.indexOf.call(t,e)}))}(e,r)).length?"":or(e[0])}function or(t){var e,r="";e=t;var i=(-1!==csString.prototype.indexOf.call(e,"@")?new RegExp("@(.+):(\\d+):(\\d+)$"):new RegExp("\\((.+):(\\d+):(\\d+)\\)")).exec(t);return i&&(r=i[1]),r}var sr,ar,cr,ur=function(){function t(){this.defaultHookPrepareArgs=function(t,e){return{context:t,args:e}}}return t.prototype.copyFunctionSignature=function(t,e){t.prototype=e.prototype,Object.defineProperty(t,"toString",{value:function(){return e.toString()}})},t.prototype.createSyncFunctionInterceptor=function(t){var e,r=t.target,i=t.methodName,n=t.hook,o=t.hookPrepareArgs,s=void 0===o?this.defaultHookPrepareArgs:o,a=t.options;if(!(null===(e=Object.getOwnPropertyDescriptor(r,i))||void 0===e?void 0:e.writable))return ht.warn("Cannot intercept read only function '"+i+"' of object '"+r+"'"),null;var c=!1,u=r[i];if("function"==typeof u){var p=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,i=s(this,t),o=u.apply(this,t);c&&(a&&a.withCallerName&&(r=nr()),ht.tryToExecute("SyncFunctionInterceptor",(function(){n(y(y({result:o},i),{callerName:r}))}))());return o};this.copyFunctionSignature(p,u),r[i]=p}return{activate:function(){return c=!0},deactivate:function(){return c=!1}}},t.prototype.createAsyncFunctionInterceptor=function(t){var e,r=t.target,i=t.methodName,n=t.hook,o=t.hookPrepareArgs,s=void 0===o?this.defaultHookPrepareArgs:o,a=t.options;if(!(null===(e=Object.getOwnPropertyDescriptor(r,i))||void 0===e?void 0:e.writable))return ht.warn("Cannot intercept read only function '"+i+"' of object '"+r+"'"),null;var c=!1,u=r[i];if("function"==typeof u){var p=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return m(this,void 0,void 0,(function(){var e,r,i;return g(this,(function(o){return e=s(this,t),r=u.apply(this,t),c&&(a&&a.withCallerName&&(i=nr()),ht.tryToExecute("AsyncFunctionInterceptor",(function(){n(y(y({result:r},e),{callerName:i}))}))()),[2,r]}))}))};this.copyFunctionSignature(p,u),r[i]=p}return{activate:function(){return c=!0},deactivate:function(){return c=!1}}},t.prototype.createDescriptorInterceptor=function(t,e,r){var i=!1,n=Object.getOwnPropertyDescriptor(t,e);if(n){if(!n.configurable)return ht.warn("Cannot intercept read only property '"+e+"' of object '"+t+"'"),null;Object.defineProperty(t,e,y(y({},n.get?{get:function(){return n.get.apply(this,arguments)}}:{}),n.set?{set:function(){var t=this,e=arguments,o=n.set.apply(this,e);return i&&ht.tryToExecute("DescriptorInterceptor",(function(){r(t,e[0])}))(),o}}:{}))}return{activate:function(){return i=!0},deactivate:function(){return i=!1}}},t}();function pr(t){return csArray.prototype.slice.call(t)}(ar=sr||(sr={})).getShadowRoot=function(t){return at(t)?csElementshadowRoot.apply(t):null},ar.getAllShadowHosts=function t(e){for(var r,i,n=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,null,!1),o=[];i=n.nextNode();)csElementshadowRoot.apply(i)&&(r=csArray.prototype.push).call.apply(r,S([o,i],t(i.shadowRoot)));return o},function(t){function e(t){var e=t.getBoundingClientRect(),r=e.left+.5*e.width,i=e.top+.5*e.height,n=document.elementFromPoint(r,i);return sr.getShadowRoot(n)?t.getRootNode().elementFromPoint(r,i):n}t.findAllElements=function(t,e){var r;void 0===e&&(e=document);for(var i=pr(e.querySelectorAll(t)),n=0,o=sr.getAllShadowHosts(e);n<o.length;n++){var s=pr(o[n].shadowRoot.querySelectorAll(t));(r=csArray.prototype.push).call.apply(r,S([i],s))}return i},t.getTopElement=e,t.isVisibleInDocument=function(t){return!function(t){var e=t.getBoundingClientRect();return e.right+Ue.windowOffsetX()<0||e.bottom+Ue.windowOffsetY()<0}(t)&&!function(t){var e,r=window.getComputedStyle(t);return 0===t.getClientRects().length||"hidden"===r.visibility||"collapse"===r.visibility||"0"===r.opacity||"opacity(0)"===r.filter||(e=r.color,/^rgba\(\d+, \d+, \d+, 0\)$/.test(e))}(t)&&!function(t){var r=e(t);return!t.contains(r)&&null!==r}(t)},t.isInViewPort=function(t){return null!==e(t)}}(cr||(cr={}));var lr,hr,dr=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;return s.configuration=e,s.nodeIdentifier=r,s.sensitiveContentService=i,s.textVisibilityBatch=n,s.textVisibilityDelay=o,s.isStarted=!1,s.seenInViewPort=new Set,s.seenGlobally=new Set,s}return f(e,t),e.prototype.onEvent=function(t){this.onEventCallback=t},e.prototype.start=function(){var t=this;this.isStarted||this.configuration.textVisibilityEnabled&&window.IntersectionObserver&&(this.intersectionObserver=new IntersectionObserver((function(e,r){t.handleIntersection(e,r)}),e.INTERSECTION_OPTIONS),this.mutationObserver=new csMutationObserver((function(e){t.handleMutations(e)})),this.isStarted=!0)},e.prototype.stop=function(){this.isStarted&&(this.textVisibilityBatch.clear(),this.intersectionObserver.disconnect(),this.mutationObserver.disconnect(),this.seenInViewPort.clear(),this.seenGlobally.clear(),this.isStarted=!1)},e.prototype.flushEvents=function(){this.isStarted&&this.onTextVisibility()},e.prototype.serializeTextNode=function(t,e,r){if(!this.isStarted||r.withAnonymization)return e;var i=t.parentElement;if(i&&(this.sensitiveContentService.isSensitive(i)||this.sensitiveContentService.isSensitiveChild(i)))return e;if(""!==csString.prototype.trim.call(t.data)&&i&&!Xt(i)&&!Jt(i)){if(!cr.isVisibleInDocument(i))return this.observeMutation(i),this.observeIntersection(i),e;var n=cr.isInViewPort(i);n||this.observeIntersection(i),this.processTextVisibilityFromSerialization(i,n)}return e},e.prototype.observeIntersection=function(t){this.intersectionObserver.observe(t)},e.prototype.observeMutation=function(t){this.mutationObserver.observe(t,{attributeFilter:e.MUTATION_ATTRIBUTE_FILTER})},e.prototype.processTextVisibilityAfterDelay=function(t,e,r){cr.isVisibleInDocument(t)&&(this.pushIdSeenGlobally(e),cr.isInViewPort(t)&&r&&(this.pushIdSeenInViewPort(e),this.intersectionObserver.unobserve(t)),this.textVisibilityBatch.isFull()&&this.onTextVisibility())},e.prototype.processTextVisibilityFromSerialization=function(t,e){var r=this,i=this.nodeIdentifier.getId(t);i?this.seenInViewPort.has(i)||setTimeout((function(){r.processTextVisibilityAfterDelay(t,i,e),r.seenGlobally.has(i)||r.observeMutation(t),!r.seenInViewPort.has(i)&&e&&r.observeIntersection(t)}),this.textVisibilityDelay):ht.warn("processTextVisibilityFromSerialization: node without identifier")},e.prototype.processTextVisibilityFromMutation=function(t){var e=this.nodeIdentifier.getId(t);e?this.seenInViewPort.has(e)||this.processTextVisibility(t,e):ht.warn("processTextVisibilityFromMutation: node without identifier")},e.prototype.processTextVisibilityFromIntersection=function(t,e){var r=this.nodeIdentifier.getId(t);r?this.seenInViewPort.has(r)?e.unobserve(t):this.processTextVisibility(t,r):ht.warn("processTextVisibilityFromIntersection: node without identifier")},e.prototype.processTextVisibility=function(t,e){var r=this,i=this.isVisibleInViewPort(t);setTimeout((function(){return r.processTextVisibilityAfterDelay(t,e,i)}),this.textVisibilityDelay)},e.prototype.handleMutations=function(t){var r=this;csArray.prototype.forEach.call(t,(function(t){var i=t.attributeName;at(t.target)&&!r.sensitiveContentService.isSensitiveChild(t.target)&&i&&-1!==csArray.prototype.indexOf.call(e.MUTATION_ATTRIBUTE_FILTER,i)&&r.processTextVisibilityFromMutation(t.target)}))},e.prototype.handleIntersection=function(t,e){var r=this;csArray.prototype.forEach.call(t,(function(t){t.isIntersecting&&!r.sensitiveContentService.isSensitiveChild(t.target)&&r.processTextVisibilityFromIntersection(t.target,e)}))},e.prototype.isVisibleInViewPort=function(t){return cr.isVisibleInDocument(t)&&cr.isInViewPort(t)},e.prototype.pushIdSeenInViewPort=function(t){this.seenInViewPort.has(t)||(this.seenInViewPort.add(t),this.textVisibilityBatch.addIdInViewPort(t))},e.prototype.pushIdSeenGlobally=function(t){this.seenGlobally.has(t)||(this.seenGlobally.add(t),this.textVisibilityBatch.addIdInGlobally(t))},e.prototype.onTextVisibility=function(){if(!this.textVisibilityBatch.isEmpty()){var t={visibleGlobally:this.textVisibilityBatch.flushIdsSeenGlobally(),visibleInViewPort:this.textVisibilityBatch.flushIdsSeenInViewport()};this.onEventCallback({type:Dt.TEXT_VISIBILITY,date:V(),args:[t]})}},e.INTERSECTION_OPTIONS={root:null,rootMargin:"0px",threshold:.5},e.MUTATION_ATTRIBUTE_FILTER=["style","class","hidden"],v([dt("TextVisibilityTracker.processTextVisibilityAfterDelay")],e.prototype,"processTextVisibilityAfterDelay",null),v([dt("TextVisibilityTracker.processTextVisibilityFromSerialization")],e.prototype,"processTextVisibilityFromSerialization",null),v([dt("TextVisibilityTracker.processTextVisibilityFromMutation")],e.prototype,"processTextVisibilityFromMutation",null),v([dt("TextVisibilityTracker.processTextVisibilityFromIntersection")],e.prototype,"processTextVisibilityFromIntersection",null),v([dt("TextVisibilityTracker.handleMutations")],e.prototype,"handleMutations",null),v([dt("TextVisibilityTracker.handleIntersection")],e.prototype,"handleIntersection",null),e}(we),fr=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.onBeaconSuccessCallbacks=[],i.onBeaconFailureCallbacks=[],i}return f(e,t),e.prototype.setRequestPayloadProvider=function(t){this.requestPayloadProvider=t},e.prototype.onBeaconSuccess=function(t){csArray.prototype.push.call(this.onBeaconSuccessCallbacks,t)},e.prototype.onBeaconFailure=function(t){csArray.prototype.push.call(this.onBeaconFailureCallbacks,t)},e.prototype.send=function(){csArray.prototype.forEach.call(this.beforeRequestCallbacks,(function(t){return t()}));var t=y(y({},this.retrieveParameters()),{enc:"raw"}),e=w.toQuery(t),r=this.retrievePayload();this.sendBeacon(e,r)?csArray.prototype.forEach.call(this.onBeaconSuccessCallbacks,(function(t){return t()})):csArray.prototype.forEach.call(this.onBeaconFailureCallbacks,(function(t){return t()})),csArray.prototype.forEach.call(this.afterRequestCallbacks,(function(t){return t()}))},e.prototype.retrievePayload=function(){return this.requestPayloadProvider?this.requestPayloadProvider.getRequestPayload():""},e.prototype.sendBeacon=function(t,e){return void 0!==navigator.sendBeacon&&navigator.sendBeacon(this.domainUri+"/"+this.path+"?"+t,e)},e}(P),yr=function(){function t(){this.seenGloballyBuffer=[],this.seenInViewPortBuffer=[]}return t.prototype.isFull=function(){return this.seenGloballyBuffer.length>=t.BATCH_SIZE||this.seenInViewPortBuffer.length>=t.BATCH_SIZE},t.prototype.isEmpty=function(){return 0===this.seenGloballyBuffer.length&&0===this.seenInViewPortBuffer.length},t.prototype.addIdInGlobally=function(t){csArray.prototype.push.call(this.seenGloballyBuffer,t)},t.prototype.addIdInViewPort=function(t){csArray.prototype.push.call(this.seenInViewPortBuffer,t)},t.prototype.clear=function(){this.seenGloballyBuffer=[],this.seenInViewPortBuffer=[]},t.prototype.flushIdsSeenGlobally=function(){var t=S(this.seenGloballyBuffer);return this.seenGloballyBuffer=[],t},t.prototype.flushIdsSeenInViewport=function(){var t=S(this.seenInViewPortBuffer);return this.seenInViewPortBuffer=[],t},t.BATCH_SIZE=20,t}(),vr=function(t){function e(e){var r=t.call(this)||this;return r.encryptionService=e,r}return f(e,t),e.prototype.serializeTextNode=function(t,e){var r;return(null===(r=t.parentElement)||void 0===r?void 0:r.hasAttribute("data-cs-encrypt"))&&(e.data=Ce(t.data),this.encryptionService.registerTextNodeToEncrypt({textNode:t,serializedTextData:e.data})),e},e}(we),mr=function(){function t(){this.dataToEncryptBuffer=[]}return t.prototype.onSerializeData=function(t){this.onSerializeDataCallback=t},t.prototype.addData=function(t){csArray.prototype.push.call(this.dataToEncryptBuffer,t)},t.prototype.serializeDataFromBuffer=function(){for(;this.dataToEncryptBuffer.length>0;){var t=csArray.prototype.shift.call(this.dataToEncryptBuffer);this.onSerializeDataCallback(t)}},t.prototype.clear=function(){this.dataToEncryptBuffer=[]},t}(),gr=function(){function t(t){this.crypto=t,this.isEncryptionSupported=!1}return t.prototype.init=function(){this.isEncryptionSupported=this.canSupportEncryption(),this.isEncryptionSupported&&(this.textEncoder=new TextEncoder)},t.prototype.isSupported=function(){return this.isEncryptionSupported},t.prototype.canSupportEncryption=function(){return!!(this.crypto&&this.crypto.subtle&&this.crypto.subtle.encrypt&&self.CryptoKey&&self.TextEncoder&&csString.fromCodePoint)},t}(),Sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.exportInitializationVector=function(t){return he(t)},e.prototype.exportSecret=function(t){var e;return m(this,void 0,void 0,(function(){var r;return g(this,(function(i){switch(i.label){case 0:if(!this.isSupported())return[2,null];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.crypto.subtle.exportKey("jwk",t)];case 2:return r=i.sent(),[2,null!==(e=r.k)&&void 0!==e?e:null];case 3:return i.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.generateEncryptionKey=function(){return m(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:if(!this.isSupported())return[2,null];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.crypto.subtle.generateKey({name:"AES-CTR",length:128},!0,["encrypt","decrypt"])];case 2:return[2,t.sent()];case 3:return t.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.generateInitializationVector=function(){return this.isSupported()?this.crypto.getRandomValues(new Uint8Array(16)):null},e.prototype.encrypt=function(t,e){return m(this,void 0,void 0,(function(){var r,i;return g(this,(function(n){switch(n.label){case 0:if(!this.isSupported())return[2,null];r={counter:t.initializationVector,name:"AES-CTR",length:64},i=this.textEncoder.encode(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.crypto.subtle.encrypt(r,t.encryptionKey,i)];case 2:return[2,he(n.sent())];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.canSupportEncryption=function(){return t.prototype.canSupportEncryption.call(this)&&!!this.crypto.getRandomValues&&!!this.crypto.subtle.generateKey&&!!this.crypto.subtle.exportKey},e}(gr),Er=function(){function t(t){this.crypto=t,this.isDecryptionSupported=!1}return t.prototype.init=function(){this.isDecryptionSupported=this.canSupportDecryption(),this.isDecryptionSupported&&(this.textDecoder=new TextDecoder)},t.prototype.isSupported=function(){return this.isDecryptionSupported},t.prototype.canSupportDecryption=function(){return!!(this.crypto&&this.crypto.subtle&&this.crypto.subtle.importKey&&this.crypto.subtle.decrypt&&self.CryptoKey&&self.TextDecoder)},t}(),Cr=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}f(e,t),e.prototype.importInitializationVector=function(t){return le(t)},e.prototype.importSecret=function(t){return m(this,void 0,void 0,(function(){var e,r;return g(this,(function(i){switch(i.label){case 0:if(!this.isSupported())return[2,null];e={alg:"A128CTR",ext:!0,k:t,key_ops:["encrypt","decrypt"],kty:"oct"},r={name:"AES-CTR"},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.crypto.subtle.importKey("jwk",e,r,!1,["encrypt","decrypt"])];case 2:return[2,i.sent()];case 3:return i.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.decrypt=function(t,e){return m(this,void 0,void 0,(function(){var r,i;return g(this,(function(n){switch(n.label){case 0:if(!this.isSupported())return[2,null];r={name:"AES-CTR",counter:t.initializationVector,length:64},n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.crypto.subtle.decrypt(r,t.encryptionKey,le(e))];case 2:return i=n.sent(),[2,this.textDecoder.decode(i)];case 3:return n.sent(),[2,null];case 4:return[2]}}))}))}}(Er),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.importKey=function(t){return m(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:if(!this.isSupported())return[2,null];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.crypto.subtle.importKey("spki",de(t),{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"])];case 2:return[2,e.sent()];case 3:return e.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.encrypt=function(t,e){return m(this,void 0,void 0,(function(){var r;return g(this,(function(i){switch(i.label){case 0:if(!this.isSupported())return[2,null];if(!(r=this.truncateAndEncode(e,190)))return[2,null];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.crypto.subtle.encrypt({name:"RSA-OAEP"},t.publicKey,r)];case 2:return[2,he(i.sent())];case 3:return i.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.truncateAndEncode=function(t,e){for(var r=0,i=0,n=0;n<t.length;n++){var o=csString.prototype.codePointAt.call(t,n);if(!o)return null;var s=this.getByteSize(o);if(s+r>e)break;i++,r+=s}var a=csString.prototype.slice.call(t,0,i);return this.textEncoder.encode(a)},e.prototype.getByteSize=function(t){return t<=127?1:t<=2047?2:t<=65535?3:4},e.prototype.canSupportEncryption=function(){return t.prototype.canSupportEncryption.call(this)&&!!this.crypto.subtle.importKey},e}(gr)),Tr=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}f(e,t),e.prototype.importKey=function(t){return m(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:if(!this.isSupported())return[2,null];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.crypto.subtle.importKey("pkcs8",de(t),{name:"RSA-OAEP",hash:"SHA-256"},!1,["decrypt"])];case 2:return[2,e.sent()];case 3:return e.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.decrypt=function(t,e){return m(this,void 0,void 0,(function(){var r;return g(this,(function(i){switch(i.label){case 0:if(!this.isSupported())return[2,null];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.crypto.subtle.decrypt({name:"RSA-OAEP"},t.privateKey,le(e))];case 2:return r=i.sent(),[2,this.textDecoder.decode(r)];case 3:return i.sent(),[2,null];case 4:return[2]}}))}))}}(Er),function(){function t(t){this.crypto=t,this.isHashingSupported=!1}return t.prototype.init=function(){this.isHashingSupported=this.canSupportHashing(),this.isHashingSupported&&(this.textEncoder=new TextEncoder)},t.prototype.canSupportHashing=function(){return!!(this.crypto&&this.crypto.subtle&&this.crypto.subtle.digest&&self.TextEncoder&&csArray.from)},t.prototype.isSupported=function(){return this.isHashingSupported},t.prototype.isValidInput=function(t){return!!t&&t.length<=100},t.prototype.formatInput=function(t,e){return csString.prototype.toLowerCase.call(csString.prototype.trim.call(t))+":"+e},t.prototype.digest=function(t,e){return m(this,void 0,void 0,(function(){var r,i,n;return g(this,(function(o){switch(o.label){case 0:if(!this.isHashingSupported)return[2,null];r=this.formatInput(t,e),i=this.textEncoder.encode(r),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,crypto.subtle.digest("SHA-1",i)];case 2:return n=o.sent(),[2,(s=n,a=csArray.from(new Uint8Array(s)),csArray.prototype.join.call(csArray.prototype.map.call(a,(function(t){return csString.prototype.padStart.call(t.toString(16),2,"0")})),""))];case 3:return o.sent(),[2,null];case 4:return[2]}var s,a}))}))},t}());!function(t){t[t.TAP=0]="TAP",t[t.LONG_PRESS=1]="LONG_PRESS",t[t.DRAG=2]="DRAG",t[t.FLICK=3]="FLICK"}(lr||(lr={})),function(t){t[t.UP=1]="UP",t[t.DOWN=2]="DOWN",t[t.LEFT=3]="LEFT",t[t.RIGHT=4]="RIGHT"}(hr||(hr={}));var Rr,br=function(){function t(t,e,r){this.gestureTracker=t,this.nodeIdentifier=e,this.sensitiveContentService=r}return t.prototype.start=function(){var e=this;this.gestureTracker.subscribe(t.TRACKER_IDENTIFIER,(function(t){return e.processGesture(t)}))},t.prototype.stop=function(){this.gestureTracker.unsubscribe(t.TRACKER_IDENTIFIER)},t.prototype.onEvent=function(t){this.onEventCallback=function(e){t(y(y({},e),{date:V()}))}},t.prototype.processGesture=function(t){if(t.target&&(!Gt(t.target)||!this.sensitiveContentService.isSensitiveChild(t.target))){var e=this.nodeIdentifier.getId(t.target);if(e)switch(t.type){case lr.DRAG:case lr.FLICK:this.triggerGestureRecognitionEvent(xt.SWIPE,t,e);break;case lr.LONG_PRESS:this.triggerGestureRecognitionEvent(xt.LONG_PRESS,t,e);break;case lr.TAP:this.triggerGestureRecognitionEvent(xt.TAP,t,e)}else ht.warn("processGesture: node without identifier")}},t.prototype.triggerGestureRecognitionEvent=function(t,e,r){var i=this.buildGestureEvent(e,t),n={type:Dt.GESTURE_RECOGNITION,args:[r,i]};this.onEventCallback(n)},t.prototype.buildGestureEvent=function(t,e){var r={type:e};return t.direction&&(r.direction=t.direction),t.distance&&(r.distance=t.distance),t.velocity&&(r.velocity=t.velocity),r},t.TRACKER_IDENTIFIER="RecordingGesturesTracker",t}();!function(t){t[t.WebElement=0]="WebElement",t[t.MobileView=1]="MobileView",t[t.WebViewContainer=2]="WebViewContainer"}(Rr||(Rr={}));var wr=function(){function t(t){this.processors=t}return t.prototype.serialize=function(t,e){void 0===e&&(e={});var r,i=y({},e),n=t.nodeType,o=csArray.prototype.reduce.call(this.processors,(function(t,e){return e.beforeSerialize(t,i)}),t);switch(n){case Node.ELEMENT_NODE:r=this.serializeElementNode(o,i);break;case Node.TEXT_NODE:r=this.serializeTextNode(o,i);break;case Node.CDATA_SECTION_NODE:r=this.serializeCDATASectionNode(o,i);break;case Node.COMMENT_NODE:r=this.serializeCommentNode(o,i);break;case Node.DOCUMENT_TYPE_NODE:r=this.serializeDoctypeNode(o,i);break;case Node.DOCUMENT_NODE:r=this.serializeDocumentNode(o,i);break;case Node.DOCUMENT_FRAGMENT_NODE:r=this.serializeDocumentFragmentNode(o,i);break;default:throw new Error("serialization is not supported (nodeType: "+n+")")}return r=csArray.prototype.reduce.call(this.processors,(function(t,e){return e.afterSerialize(o,t,i)}),r)},t.prototype.serializeElementNode=function(t,e){var r,i=csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeElementNode(t,n,e)}),{attributes:[]});(r=csArray.prototype.push).call.apply(r,S([i.attributes],this.serializeAttributes(t,e)));var n=csElementshadowRoot.apply(t);return n&&(i.shadowRoot=this.serializeShadowRootNode(n,e)),i.children=this.serializeChildren(t,e),i},t.prototype.serializeAttributes=function(t,e){var r=this,i=pr(t.attributes);return csArray.prototype.map.call(csArray.prototype.reduce.call(this.processors,(function(r,i){return i.beforeSerializeAttributes(t,r,e)}),i),(function(i){return r.serializeAttribute(t,i,e)}))},t.prototype.serializeAttribute=function(t,e,r){return csArray.prototype.reduce.call(this.processors,(function(i,n){return n.serializeAttribute(t,e,i,r)}),{})},t.prototype.runBeforeSerializeChildrenHook=function(t,e){var r=pr(csNodechildNodes.apply(t));return csArray.prototype.reduce.call(this.processors,(function(r,i){return i.beforeSerializeChildren(t,r,e)}),r)},t.prototype.serializeChildren=function(t,e){var r=this;if(e.skipChildrenSerialization)return[];var i=this.runBeforeSerializeChildrenHook(t,e);return csArray.prototype.map.call(i,(function(t){return r.serialize(t,e)}))},t.prototype.serializeTextNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeTextNode(t,n,e)}),{})},t.prototype.serializeCDATASectionNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeCDATASectionNode(t,n,e)}),{})},t.prototype.serializeCommentNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeCommentNode(t,n,e)}),{})},t.prototype.serializeDoctypeNode=function(t,e){return csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeDoctypeNode(t,n,e)}),{})},t.prototype.serializeDocumentNode=function(t,e){var r=csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeDocumentNode(t,n,e)}),{});return r.children=this.serializeChildren(t,e),r},t.prototype.serializeShadowRootNode=function(t,e){var r=csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.serializeNode(t,r,e);return i.serializeShadowRootNode(t,n,e)}),{});return r.children=this.serializeChildren(t,e),r=csArray.prototype.reduce.call(this.processors,(function(r,i){return i.afterSerializeShadowRoot(t,r,e)}),r)},t.prototype.serializeDocumentFragmentNode=function(t,e){if(t.mode)return this.serializeShadowRootNode(t,e);throw new Error("Not implemented yet.")},t}(),Ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.beforeSerializeChildren=function(t,e){if(Xt(t)){var r=this.getAllCssRules(t);if(null===r||0===r.length)return e;if(this.isEmptyStyleElement(t))csArray.prototype.push.call(e,this.createTextNodeFromRules(r));else{var i=this.getInlineCssRules(t);if(i.length===r.length)return e;for(var n=[],o=i.length;o<r.length;o+=1)csArray.prototype.push.call(n,r[o]);csArray.prototype.push.call(e,this.createTextNodeFromRules(n))}}return e},e.prototype.getAllCssRules=function(t){try{var e=t.sheet;return e?e.cssRules||e.rules:null}catch(t){if("SecurityError"!==t.name&&"InvalidAccessError"!==t.name)throw t;return null}},e.prototype.getInlineCssRules=function(t){var e=document.implementation.createHTMLDocument(""),r=t.cloneNode(!0);return r.textContent=t.textContent,e.head.appendChild(r),this.getAllCssRules(r)},e.prototype.isEmptyStyleElement=function(t){var e=t.textContent||"";return/^\s*$/.test(e)},e.prototype.createTextNodeFromRules=function(t){var e=csArray.prototype.join.call(csArray.prototype.map.call(t,(function(t){return t.cssText})),""),r=document.createTextNode(e);return r.__contentsquare_artificial=!0,r},e.prototype.serializeNode=function(t,e){return e.nodeType=t.nodeType,e.format=Rr.WebElement,t.__contentsquare_artificial&&(e.artificial=t.__contentsquare_artificial),e},e.prototype.serializeElementNode=function(t,e){return e.localName=t.localName,e.namespaceURI=t.namespaceURI,e},e.prototype.serializeAttribute=function(t,e,r){return r.name=e.name,r.value=e.value,r.namespaceURI=null!==e.namespaceURI?e.namespaceURI:"",r},e.prototype.serializeTextNode=function(t,e){return e.data=t.data,e},e.prototype.serializeCDATASectionNode=function(t,e){return e.data=t.data,e},e.prototype.serializeCommentNode=function(t,e){return e.data=t.data,e},e.prototype.serializeDoctypeNode=function(t,e){return e.name=t.name,e.publicId=t.publicId,e.systemId=t.systemId,e},e.prototype.serializeDocumentNode=function(t,r){return r.baseURI=e.getBaseURI(t),r},e.prototype.serializeShadowRootNode=function(t,e){return e.mode=t.mode,t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&(e.adoptedStyleSheets=this.serializeStyleSheets(t.adoptedStyleSheets)),e},e.prototype.serializeStyleSheets=function(t){var e=this;return csArray.prototype.map.call(t,(function(t){return e.serializeStyleSheet(t)}))},e.prototype.serializeStyleSheet=function(t){return{cssRules:csArray.prototype.map.call(t.cssRules,(function(t){return t.cssText}))}},e.getBaseURI=function(t){var e=t.baseURI;if(null==e){var r=t.getElementsByTagName("base");e=0!==r.length?r[0].href:t.URL}return e},e}(we),kr=(function(){function t(t){this.processors=t}t.prototype.unserialize=function(t){if(void 0!==t.format&&t.format!==Rr.WebElement)throw new Error("unserialization is not supported (format: "+t.format+")");var e=t.nodeType;switch(e){case Node.ELEMENT_NODE:return this.unserializeElementNode(t);case Node.TEXT_NODE:return this.unserializeTextNode(t);case Node.CDATA_SECTION_NODE:return this.unserializeCDATASectionNode(t);case Node.COMMENT_NODE:return this.unserializeCommentNode(t);case Node.DOCUMENT_TYPE_NODE:return this.unserializeDoctypeNode(t);case Node.DOCUMENT_NODE:return this.unserializeDocumentNode(t);default:throw new Error("unserialization is not supported (nodeType: "+e+")")}},t.prototype.unserializeShadowRoot=function(t,e){var r=csArray.prototype.reduce.call(this.processors,(function(r,i){var n=i.unserializeShadowRoot(t,e,r);return i.unserializeNode(e,n)}),null);return this.unserializeChildren(r,e.children),r},t.prototype.unserializeElementNode=function(t){var e=csArray.prototype.reduce.call(this.processors,(function(e,r){var i=r.unserializeElementNode(t,e);return r.unserializeNode(t,i)}),null);return this.unserializeAttributes(e,t.attributes),this.unserializeChildren(e,t.children),t.shadowRoot&&this.unserializeShadowRoot(e,t.shadowRoot),e},t.prototype.unserializeChildren=function(t,e){var r=this;csArray.prototype.forEach.call(pr(e),(function(e){return t.appendChild(r.unserialize(e))}))},t.prototype.unserializeAttributes=function(t,e){var r=this;csArray.prototype.forEach.call(pr(e),(function(e){try{r.unserializeAttribute(t,e)}catch(t){}}))},t.prototype.unserializeAttribute=function(t,e){csArray.prototype.reduce.call(this.processors,(function(t,r){return r.unserializeAttribute(e,t)}),t)},t.prototype.unserializeTextNode=function(t){return csArray.prototype.reduce.call(this.processors,(function(e,r){var i=r.unserializeTextNode(t,e);return r.unserializeNode(t,i)}),null)},t.prototype.unserializeCDATASectionNode=function(t){return csArray.prototype.reduce.call(this.processors,(function(e,r){var i=r.unserializeCDATASectionNode(t,e);return r.unserializeNode(t,i)}),null)},t.prototype.unserializeCommentNode=function(t){return csArray.prototype.reduce.call(this.processors,(function(e,r){var i=r.unserializeCommentNode(t,e);return r.unserializeNode(t,i)}),null)},t.prototype.unserializeDoctypeNode=function(t){return csArray.prototype.reduce.call(this.processors,(function(e,r){var i=r.unserializeDoctypeNode(t,e);return r.unserializeNode(t,i)}),null)},t.prototype.unserializeDocumentNode=function(t){var e=this,r=csArray.prototype.reduce.call(this.processors,(function(e,r){var i=r.unserializeDocumentNode(t,e);return r.unserializeNode(t,i)}),null);return csArray.prototype.forEach.call(pr(t.children),(function(t){return r.appendChild(e.unserialize(t))})),r}}(),function(){function t(){}return t.prototype.unserializeShadowRoot=function(t,e,r){return r},t.prototype.unserializeNode=function(t,e){return e},t.prototype.unserializeElementNode=function(t,e){return e},t.prototype.unserializeCDATASectionNode=function(t,e){return e},t.prototype.unserializeAttribute=function(t,e){return e},t.prototype.unserializeTextNode=function(t,e){return e},t.prototype.unserializeCommentNode=function(t,e){return e},t.prototype.unserializeDoctypeNode=function(t,e){return e},t.prototype.unserializeDocumentNode=function(t,e){return e},t}()),Ir=function(){function t(){this.domParser=new DOMParser}return t.prototype.createElement=function(t){var e=this.htmlSanitizer(t);return this.parseHtmlElement("<"+e+" />")},t.prototype.createAttribute=function(t,e){var r=this.htmlSanitizer(t),i=this.parseHtmlElement("<div "+r+'=""></div>'),n=i.getAttributeNode(r);return i.removeAttributeNode(n),n.value=e,n},t.prototype.createDoctype=function(t,e,r){var i=this.htmlSanitizer(t||""),n=this.htmlSanitizer(r||""),o=this.htmlSanitizer(e||"");return this.domParser.parseFromString("<!DOCTYPE"+(i?" "+i:"")+(n?' PUBLIC "'+n+'"':"")+" "+(o?n?' "'+o+'"':' SYSTEM "'+o+'"':"")+">","text/html").doctype},t.prototype.parseHtmlElement=function(t){return this.domParser.parseFromString(t,"text/html").body.children[0]},t.prototype.htmlSanitizer=function(t){return csString.prototype.replace.call(t,/[\s<>\/\0]/g,"")},t}(),Pr=(function(t){function e(e){var r=t.call(this)||this;return r.document=e,r.dirtyElementBuilder=new Ir,r.xmlDocument=(new DOMParser).parseFromString("<xml></xml>","application/xml"),r}f(e,t),e.prototype.unserializeShadowRoot=function(t,e){var r=t.attachShadow({mode:"open"});if(e.adoptedStyleSheets)for(var i=0,n=this.unserializeStyleSheets(e.adoptedStyleSheets);i<n.length;i++){var o=n[i];r.appendChild(this.createStyleElementFromStyleSheet(o))}return r},e.prototype.unserializeElementNode=function(t){var e=this.getTagName(t),r=t.namespaceURI;try{return this.isXhtmlNamespace(r)&&e.indexOf(":")>-1?this.document.createElement(e):this.document.createElementNS(r,e)}catch(t){switch(t.name){case"InvalidCharacterError":return this.dirtyElementBuilder.createElement(e);default:throw t}}},e.prototype.unserializeAttribute=function(t,e){try{e.setAttributeNS(t.namespaceURI,t.name,t.value)}catch(r){switch(r.name){case"NamespaceError":e.setAttribute(t.name,t.value);break;case"InvalidCharacterError":e.setAttributeNode(this.dirtyElementBuilder.createAttribute(t.name,t.value));break;default:throw r}}return e},e.prototype.unserializeTextNode=function(t){return this.document.createTextNode(t.data)},e.prototype.unserializeCommentNode=function(t){return this.document.createComment(t.data)},e.prototype.unserializeCDATASectionNode=function(t){return this.xmlDocument.createCDATASection(t.data)},e.prototype.unserializeDoctypeNode=function(t){var e=t.name,r=t.systemId,i=t.publicId;try{return this.document.implementation.createDocumentType(e,i,r)}catch(t){if("InvalidCharacterError"===t.name)return this.dirtyElementBuilder.createDoctype(e,r,i);throw t}},e.prototype.unserializeDocumentNode=function(){return this.document.implementation.createDocument(null,null,null)},e.prototype.isXhtmlNamespace=function(t){return"http://www.w3.org/1999/xhtml"===t},e.prototype.isSvgNamespace=function(t){return"http://www.w3.org/2000/svg"===t},e.prototype.getTagName=function(t){var e=t,r=e.localName,i=e.tagName;return r||(this.isSvgNamespace(t.namespaceURI)?i:i.toLowerCase())},e.prototype.unserializeStyleSheets=function(t){for(var e=[],r=0,i=t;r<i.length;r++){var n=i[r],o=this.unserializeStyleSheet(n);csArray.prototype.push.call(e,o)}return e},e.prototype.unserializeStyleSheet=function(t){var e=new CSSStyleSheet;return csArray.prototype.forEach.call(t.cssRules,(function(t,r){return e.insertRule(t,r)})),e},e.prototype.createStyleElementFromStyleSheet=function(t){var e=document.createElement("style"),r=csArray.prototype.join.call(csArray.prototype.map.call(t.cssRules,(function(t){return t.cssText})),"\n"),i=document.createTextNode(r);return e.appendChild(i),e}}(kr),function(t){function e(e){var r=t.call(this)||this;return r.nodeIdentifier=e,r.serializationMap=new Map,r.defaultOptions={},r}return f(e,t),e.prototype.clear=function(){this.serializationMap.clear()},e.prototype.deleteNode=function(t){this.serializationMap.delete(t)},e.prototype.setDefaultSerializationOptions=function(t){this.defaultOptions=t},e.prototype.getSerializedNodeById=function(t){var e;return null===(e=this.serializationMap.get(t))||void 0===e?void 0:e.serializedNode},e.prototype.getSerializedNodeByNode=function(t){var e,r=this.nodeIdentifier.getId(t);if(r)return null===(e=this.serializationMap.get(r))||void 0===e?void 0:e.serializedNode},e.prototype.getOptions=function(t){var e,r=this.nodeIdentifier.getId(t);return r&&(null===(e=this.serializationMap.get(r))||void 0===e?void 0:e.options)||this.defaultOptions},e.prototype.afterSerialize=function(t,e,r){return csNodeparentNode.apply(t)&&!this.getSerializedNodeByNode(csNodeparentNode.apply(t))||this.registerNode(e,r),e},e.prototype.afterSerializeShadowRoot=function(t,e,r){return this.registerNode(e,r),e},e.prototype.registerNode=function(t,e){t.csId&&this.serializationMap.set(t.csId,{serializedNode:t,options:e})},e}(we));function Nr(t){return"csId"in t}function Or(t){return Nr(t)&&"children"in t}function Lr(t){return Or(t)&&"attributes"in t&&"localName"in t&&"namespaceURI"in t}function Mr(){return m(this,void 0,void 0,(function(){return g(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){setTimeout((function(){t()}),0)}))];case 1:return t.sent(),[2]}}))}))}var Dr=function(t){function e(e,r){return t.call(this,S([new Ar,e],r))||this}return f(e,t),e}(wr),xr={taskTime:25},_r=function(t){function e(e,r,i,n){void 0===n&&(n=xr);var o=t.call(this,e,S([r],i))||this;return o.asyncSerializerMapProcessor=r,o.asyncSerializerOptions=n,o.taskTime=o.asyncSerializerOptions.taskTime,o}return f(e,t),e.prototype.isAsynchronous=function(){return!0},e.prototype.updateAttribute=function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=this.asyncSerializerMapProcessor.getSerializedNodeById(r);if(s&&Lr(s)){s.attributes||(s.attributes=[]);var a=csArray.prototype.findIndex.call(s.attributes,(function(t){return t.name===n}));a>-1?null===o?csArray.prototype.splice.call(s.attributes,a,1):s.attributes[a].value=o:o&&csArray.prototype.push.call(s.attributes,{anonymized:e,namespaceURI:i,name:n,value:o})}},e.prototype.updateTextNode=function(t){var e,r=t[0],i=t[1],n=this.asyncSerializerMapProcessor.getSerializedNodeById(r);n&&(Nr(e=n)&&"data"in e)&&(n.data=i)},e.prototype.updateChildren=function(t,e){var r=this,i=e.addedNodes,n=e.removedNodes,o=this.asyncSerializerMapProcessor.getSerializedNodeById(t);o&&Lr(o)&&(o.children||(o.children=[]),csArray.prototype.forEach.call(i,(function(t){var e=t[1],r=t[2],i=csArray.prototype.findIndex.call(o.children,(function(t){return t.csId===e}));i>-1?csArray.prototype.splice.call(o.children,i,0,r):csArray.prototype.push.call(o.children,r)})),csArray.prototype.forEach.call(n,(function(t){t.forEach((function(t){return r.removeNodeFromMap(o,t)}))})))},e.prototype.removeNodeFromMap=function(t,e){var r=csArray.prototype.findIndex.call(t.children,(function(t){return t.csId===e}));-1!==r&&csArray.prototype.splice.call(t.children,r,1),this.asyncSerializerMapProcessor.deleteNode(e)},e.prototype.startSerializeAsync=function(t,e){return void 0===e&&(e={}),m(this,void 0,void 0,(function(){return g(this,(function(r){return this.asyncSerializerMapProcessor.clear(),this.asyncSerializerMapProcessor.setDefaultSerializationOptions(e),[2,this.traverseAndSerialize(t,e)]}))}))},e.prototype.indexInParent=function(t,e){return e?csArray.prototype.indexOf.call(csNodechildNodes.apply(e),t):-1},e.prototype.serializeAndAddToParent=function(t,e,r){var i=this.asyncSerializerMapProcessor.getSerializedNodeByNode(e);if(i&&Or(i)){var n,o=this.serialize(t,r),s=this.indexInParent(t,e);s>=0&&Nr(o)?csArray.prototype.splice.call(i.children,s,0,o):!("csId"in(n=o))&&"artificial"in n&&csArray.prototype.push.call(i.children,o)}},e.prototype.traverseAndSerialize=function(t,e){return void 0===e&&(e={}),m(this,void 0,void 0,(function(){var r,i,n,o,s,a,c;return g(this,(function(u){switch(u.label){case 0:return e.skipChildrenSerialization=!0,r=[t],[4,Mr()];case 1:u.sent(),this.timer=csDate.now(),this.serialize(t,e),u.label=2;case 2:if(!(r.length>0))return[3,7];i=csArray.prototype.pop.call(r),n=this.asyncSerializerMapProcessor.getOptions(i),o=this.runBeforeSerializeChildrenHook(i,n),s=csArray.prototype.shift.call(o),u.label=3;case 3:return s?csDate.now()-this.timer>this.taskTime?[4,Mr()]:[3,5]:[3,6];case 4:u.sent(),this.timer=csDate.now(),u.label=5;case 5:return this.asyncSerializerMapProcessor.getSerializedNodeByNode(s)?(s=csArray.prototype.shift.call(o),[3,3]):(csArray.prototype.push.call(r,s),this.serializeAndAddToParent(s,i,n),Gt(s)&&csElementshadowRoot.apply(s)&&(a=csElementshadowRoot.apply(s),csArray.prototype.push.call(r,a)),s=csArray.prototype.shift.call(o),[3,3]);case 6:return[3,2];case 7:if(!(c=this.asyncSerializerMapProcessor.getSerializedNodeByNode(t)))throw new Error("traverseAndSerialize : fail to serialize");return[2,c]}}))}))},e}(Dr),Vr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.isAsynchronous=function(){return!1},e}(Dr),qr=function(){function t(){this.elements=new Set,this.isRunning=!1,this.isSupported="object"==typeof window.customElements&&"function"==typeof window.customElements.whenDefined&&"function"==typeof window.Set}return t.prototype.start=function(){!this.isRunning&&this.isSupported&&(this.elements.clear(),this.isRunning=!0)},t.prototype.stop=function(){this.isRunning&&(this.isRunning=!1)},t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.register=function(t){return m(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return this.elements.has(t)?[2]:(this.elements.add(t),[4,window.customElements.whenDefined(t)]);case 1:return e.sent(),this.onRegistration(t),[2]}}))}))},t.prototype.onRegistration=function(t){this.isRunning&&this.onEventCallback({type:Dt.CUSTOM_ELEMENT_REGISTRATION,date:V(),args:[t]})},t.prototype.getProcessor=function(){return new(function(t){function e(e){var r=t.call(this)||this;return r.tracker=e,r}return f(e,t),e.prototype.serializeElementNode=function(t,e){return function(t){return Gt(t)&&csString.prototype.indexOf.call(t.tagName,"-")>0&&csArray.prototype.indexOf.call($t,csString.prototype.toLocaleLowerCase.call(t.tagName))<0}(t)&&this.tracker.register(csString.prototype.toLowerCase.call(t.tagName)),e},e}(we))(this)},t}(),zr=function(){function t(t){this.recordingBatch=t}return t.prototype.getRequestPayload=function(){var t=this.recordingBatch.extractEvents(Dt.JAVASCRIPT_ERROR,Dt.API_ERROR,Dt.CUSTOM_ERROR);return t.length?csJSON.stringify(t):""},t}(),Ur=function(t){function e(e){var r=t.call(this)||this;return r.nodeIdentifierService=e,r}return f(e,t),e.prototype.serializeNode=function(t,e,r){var i=this.nodeIdentifierService.getId(t);return i&&(e.csId=i),e},e}(we),Br=function(){function t(t,e,r,i,n,o,s,a,c,u,p,l,h,d,f,y,v,m){this.sessionService=t,this.configuration=e,this.compressor=r,this.selector=i,this.consentService=n,this.basicParameters=o,this.commandsService=s,this.pii=a,this.sessionRenewer=c,this.urlService=u,this.sensitiveContentService=p,this.javaScriptErrorsTracker=l,this.javaScriptErrorsAnonymizer=h,this.apiErrorsTracker=d,this.gestureTracker=f,this.apiErrorsAnonymizer=y,this.lifeCycleEventsEmitter=v,this.customEventEmitter=m}return t.prototype.init=function(){var t=this,e=new ur,r=new be,i=new Ae(this.sensitiveContentService);this.anonymizationService=new He(this.pii,this.configuration),this.anonymizationService.init();var n=new tr,o=new ir(e,r),s=new Sr(window.crypto),a=new Cr(window.crypto);a.init(),s.init();var c=new mr,u=new mr,p=new mr,l=new mr,h=new mr,d=new re(r,this.configuration,a,s,c,u,p,h,l,this.compressor);d.init();var f=new vr(d),y=[i,this.anonymizationService,f,n],v=new dr(this.configuration,r,this.sensitiveContentService,new yr,1e3);this.configuration.textVisibilityEnabled&&csArray.prototype.push.call(y,v);var m,g=new Ur(r),S=new qr;if(csArray.prototype.push.call(y,S.getProcessor()),this.isAsynchronousSerialization()){var E=new Pr(r);m=new _r(g,E,y)}else m=new Vr(g,y);this.recordingBatch=new ue;var C=new pe,T=new Ge(C,this.basicParameters),R=new fr(this.configuration.getRecordingUri(),"v2/recording");this.configuration.useMalkaPipeline&&(T.addProvider({getRequestParameters:function(){return{rt:csArray.prototype.join.call(t.sessionService.getRecordingStates())}}}),R.setRequestParametersProviders(this.basicParameters,{getRequestParameters:function(){return{rt:csArray.prototype.join.call(t.sessionService.getRecordingStates()),ct:oe.UNCOMPRESSED,hlm:"true"}}}),R.setRequestPayloadProvider(new zr(this.recordingBatch)));var b=this.createRecordingPostRequest(this.compressor);this.mutationSerializer=new Te(this.consentService,m,r,this.anonymizationService,d,this.configuration,this.urlService),this.mutationSerializer.init(),this.recordingPageEventsTracker=new se(this.selector,r,this.sensitiveContentService,d),this.recordingPageEventsTracker.init();var w=new ae(this.mutationSerializer,o,n,this.lifeCycleEventsEmitter,r,this.sensitiveContentService),A=new Fe("csPersisted"),k=this.createRecordingPostRequest(this.compressor);this.recordingRecoveryService=new Se(k,this.recordingBatch,A,this.configuration,R),this.recordingService=new ge(this.configuration,b,this.recordingBatch,T,C,new Re(e,r,this.sensitiveContentService,n),w,this.recordingPageEventsTracker,new Ye(window.location,this.pii),new br(this.gestureTracker,r,this.sensitiveContentService),this.sessionRenewer,n,new er(window),this.javaScriptErrorsTracker,this.javaScriptErrorsAnonymizer,this.apiErrorsTracker,v,this.apiErrorsAnonymizer,d,this.recordingRecoveryService,S),this.customEventEmitter.addListeners(this.recordingService),this.recordingInactivityService=new Xe(this.recordingPageEventsTracker,w,new je(new We),b,this.mutationSerializer),o.init(),this.recordingInactivityService.init(),this.recordingService.init(),this.commandsService.register(["isRecording"],(function(){return t.sessionService.isReplayRecorded()})),this.commandsService.register(["setCapturedElementsSelector"],(function(e){t.anonymizationService.setWhitelistedElementsSelector(e)})),this.commandsService.register(["setPIISelectors"],(function(e){t.sensitiveContentService.setPIISelectors(e)}))},t.prototype.onStartTracking=function(){this.recordingRecoveryService.recover(),this.sessionService.isReplayRecorded()&&(this.configuration.useMalkaPipeline&&this.sessionService.isTemporarilyRecorded()&&this.recordingService.blockSendingEvents(),this.recordingInactivityService.start(),this.recordingService.start(),this.recordingRecoveryService.start())},t.prototype.onArtificialPageViewEnd=function(){this.recordingService.clearStates(),this.sessionService.isReplayRecorded()&&!this.sessionService.isTemporarilyRecorded()&&this.recordingRecoveryService.sendLastMessageBeacon()},t.prototype.onAfterArtificialPageView=function(){this.recordingService.initStates(),this.mutationSerializer.resetAnonymization(),this.sessionService.isReplayRecorded()?(this.configuration.useMalkaPipeline&&this.sessionService.isTemporarilyRecorded()&&this.recordingService.blockSendingEvents(),this.recordingInactivityService.restart(),this.recordingService.restart(),this.recordingRecoveryService.restart()):(this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop())},t.prototype.onBeforeSessionRenewal=function(){this.recordingService.clearStates(),this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop()},t.prototype.onOptout=function(){this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop()},t.prototype.onConsentGranted=function(){this.mutationSerializer.resetAnonymization(),this.recordingService.triggerConsentGranted()},t.prototype.onConsentWithdrawn=function(){this.mutationSerializer.resetAnonymization(),this.recordingService.triggerConsentWithdrawn()},t.prototype.onRecordingStateChange=function(t,e){var r=this;this.configuration.useMalkaPipeline&&(t===St.NOT_RECORDED&&e===Et.ETR_OFF?(this.recordingService.clearEvents(),this.recordingInactivityService.stop(),this.recordingService.stop(),this.recordingRecoveryService.stop()):(this.recordingBatch.setRequestParametersFromProvider({getRequestParameters:function(){return{rt:csArray.prototype.join.call(r.sessionService.getRecordingStates())}}}),this.recordingService.allowSendingEvents(),this.mutationSerializer.isDOMSerializationInProgress()||this.recordingService.pushEvents()))},t.prototype.onInitialDomDone=function(){this.recordingPageEventsTracker.start()},t.prototype.createRecordingPostRequest=function(t){var e=this.configuration.useMalkaPipeline?"v2/recording":"recording",r=this.configuration.useMalkaPipeline?"byteArray":"base64",i=new Bt(this.configuration.getRecordingUri(),e);return i.setCompressionOptions(t,r),i},t.prototype.isAsynchronousSerialization=function(){return"Promise"in window&&"Map"in window&&"findIndex"in csArray.prototype&&this.configuration.asyncSerializerEnabled},t.isSupported=function(){return"MutationObserver"in window&&"visibilityState"in document},t}(),Hr=function(){function t(t,e,r){this.visitorService=t,this.sessionService=e,this.configuration=r,this.naturalPageViewSent=!1}return t.prototype.isNaturalPageViewSent=function(){return this.naturalPageViewSent},t.prototype.setNaturalPageViewSent=function(t){this.naturalPageViewSent=t},t.prototype.getTrackingContext=function(){var t=this.getSessionKey(),e=this.getPageNumber(),r=this.getProjectId();return t&&e?{projectId:r,sessionKey:t,pageNumber:e}:null},t.prototype.getSessionKey=function(){var t=this.visitorService.getVisitor();return t?t.id+"."+t.visitsCount:null},t.prototype.getPageNumber=function(){return this.sessionService.doesSessionExist()?this.sessionService.getSession().pageNumber:null},t.prototype.getProjectId=function(){return this.configuration.projectId},t}(),Fr=function(){function t(t){this.trackingContextService=t,this.registeredCallbacks=[]}return t.prototype.handleCommand=function(t){if(st(t)&&(this.registerCallback(t),this.trackingContextService.isNaturalPageViewSent())){var e=this.trackingContextService.getTrackingContext();null!==e&&this.executeAsync(t,e)}},t.prototype.registerCallback=function(t){csArray.prototype.push.call(this.registeredCallbacks,t)},t.prototype.executeRegisteredCallbacks=function(){var t=this,e=this.trackingContextService.getTrackingContext();null!==e&&csArray.prototype.map.call(this.registeredCallbacks,(function(r){return t.executeAsync(r,e)}))},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),Gr=function(){function t(t){this.trackingContextService=t,this.pendingCallbacks=[]}return t.prototype.handleCommand=function(t){return this.trackingContextService.isNaturalPageViewSent()?this.applyGetSessionKey(t):void this.addPendingCallback(t)},t.prototype.applyGetSessionKey=function(t){var e=this.trackingContextService.getSessionKey();return this.hasCallback(t)&&null!==e&&this.executeAsync(t.callback,e),e},t.prototype.addPendingCallback=function(t){this.hasCallback(t)&&csArray.prototype.push.call(this.pendingCallbacks,t.callback)},t.prototype.flushPendingCallbacks=function(){var t=this,e=this.trackingContextService.getSessionKey();null!==e&&csArray.prototype.forEach.call(this.pendingCallbacks,(function(r){t.executeAsync(r,e)})),this.pendingCallbacks=[]},t.prototype.hasCallback=function(t){return t&&"function"==typeof t.callback},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),jr=function(){function t(t,e){this.iframeParentToChildrenCommunicationService=t,this.trackingContextService=e}return t.prototype.onIframeIntegrationCallback=function(t){if(this.trackingContextService.isNaturalPageViewSent()){var e=this.trackingContextService.getTrackingContext();null!==e&&(t.trackingContext=e,this.iframeParentToChildrenCommunicationService.sendToChildren(X.IntegrationCallback,t))}},t.prototype.sendAfterPageViewCallbackToChildren=function(){var t=this.trackingContextService.getTrackingContext();if(null!==t){var e={trackingContext:t,initiator:W.AfterPageView};this.iframeParentToChildrenCommunicationService.sendToChildren(X.IntegrationCallback,e)}},t}(),Kr=["afterPageView"],Wr=["getSessionKey"],Yr=function(){function t(t,e,r,i,n,o){this.visitorService=t,this.sessionService=e,this.commandsService=r,this.iframeEventsEmitter=i,this.iframeParentToChildrenCommunicationService=n,this.configuration=o}return t.prototype.init=function(){var t=this;this.trackingContextService=new Hr(this.visitorService,this.sessionService,this.configuration),this.afterPageViewService=new Fr(this.trackingContextService),this.getSessionKeyService=new Gr(this.trackingContextService),this.parentToChildrenIntegrationService=new jr(this.iframeParentToChildrenCommunicationService,this.trackingContextService),this.iframeEventsEmitter.addListeners(this.parentToChildrenIntegrationService),this.commandsService.register(Wr,(function(e){return t.getSessionKeyService.handleCommand(e)})),this.commandsService.register(Kr,(function(e){t.afterPageViewService.handleCommand(e)}))},t.prototype.onAfterNaturalPageView=function(){this.trackingContextService.setNaturalPageViewSent(!0),this.getSessionKeyService.flushPendingCallbacks(),this.afterPageViewService.executeRegisteredCallbacks(),this.parentToChildrenIntegrationService.sendAfterPageViewCallbackToChildren()},t.prototype.onAfterArtificialPageView=function(){this.afterPageViewService.executeRegisteredCallbacks(),this.parentToChildrenIntegrationService.sendAfterPageViewCallbackToChildren()},t}(),Xr=function(){function t(t,e){this.key=csString.prototype.slice.call(t,0,512),this.value=rt(e)?csString.prototype.slice.call(e,0,255):e}return t.isValid=function(t,e){return rt(t)&&(rt(e)||et(e))},t}(),Jr=function(t){function e(e,r){var i=t.call(this)||this;return i.batch=e,i.pii=r,i.dynamicVariablesQueue=[],i}return f(e,t),e.prototype.onStart=function(){var t=this;csArray.prototype.forEach.call(this.dynamicVariablesQueue,(function(e){return t.trackDynamicVariable(e.key,e.value)})),this.dynamicVariablesQueue=[]},e.prototype.onStop=function(){},e.prototype.trackDynamicVariable=function(t,e){this.isStarted?Xr.isValid(t,e)&&this.batch.add(new Xr(this.pii.anonymize(t),this.pii.anonymize(e))):csArray.prototype.push.call(this.dynamicVariablesQueue,{key:t,value:e})},e}(me);var Qr,Zr,$r=function(t){return void 0===t&&(t=0),function(e,r,i){var n=i.value,o=!1;i.value=function(){for(var e=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];o||(o=!0,setTimeout((function(){n.apply(e,r),o=!1}),t))}}},ti=function(){function t(t){this.compressor=t,this.batch=[]}return t.prototype.add=function(t){csArray.prototype.push.call(this.batch,t),this.setBatchReadyCall()},t.prototype.clear=function(){this.batch=[]},t.prototype.onBatchReady=function(t){this.batchReadyCallback=t},t.prototype.getRequestParameters=function(){for(var t={},e=0,r=this.batch;e<r.length;e++){var i=r[e];t[i.key]=i.value}return{dv:this.compressor.compressSync(csJSON.stringify(t)),enc:this.compressor.algorithm}},t.prototype.setBatchReadyCall=function(){this.batchReadyCallback()},v([$r(),dt("dynamicVariablesBatchReady")],t.prototype,"setBatchReadyCall",null),t}(),ei=["trackDynamicVariable"],ri=function(){function t(t,e,r,i,n,o){this.commandsService=t,this.sessionService=e,this.configuration=r,this.basicParameters=i,this.compressor=n,this.pii=o,this.request=new N(this.configuration.getTrackerUri(),"dvar"),this.batch=new ti(this.compressor),this.service=new Jr(this.batch,this.pii)}return t.prototype.init=function(){var t=this;this.request.setRequestParametersProviders(this.basicParameters,this.batch),this.sessionService.setDynamicVariablesService(this.service),this.batch.onBatchReady((function(){return t.request.send()})),this.request.after((function(){return t.batch.clear()})),this.commandsService.register(ei,(function(e){var r=void 0===e?{}:e,i=r.key,n=r.value;t.service.trackDynamicVariable(i,n)}))},t.prototype.onStartTracking=function(){this.service.start()},t}(),ii=function(){function t(t,e){this.id=t,this.revenue=e}return t.from=function(e){var r=new t(e.id,parseFloat(e.revenue));return isNaN(parseFloat(e.tax))||(r.tax=parseFloat(e.tax)),isNaN(parseFloat(e.shipping))||(r.shipping=parseFloat(e.shipping)),rt(e.currency)&&e.currency.length<=10&&(r.currency=e.currency),r},t.prototype.hasValidRevenue=function(){return!isNaN(this.revenue)&&this.revenue>=0},t}(),ni=function(){function t(t,e,r,i){this.id=t,this.name=e,this.price=r,this.quantity=i}return t.from=function(e){if(!t.isValid(e))return null;var r=new t(e.id,e.name,parseFloat(e.price),parseInt(e.quantity,10));return nt(e.sku)&&(r.sku=e.sku),nt(e.category)&&(r.category=e.category),nt(e.merchant)&&e.merchant.length>0&&(r.merchant=e.merchant.slice(0,100)),r},t.isValid=function(t){return rt(t.id)&&rt(t.name)&&tt(parseFloat(t.price))&&et(parseInt(t.quantity,10))&&(!nt(t.sku)||rt(t.sku))&&(!nt(t.category)||rt(t.category))&&(!nt(t.merchant)||rt(t.merchant))},t}(),oi=function(){function t(t,e,r){this.pii=t,this.transactionRequest=e,this.sessionRenewer=r,this.clear()}return t.prototype.addTransaction=function(t){var e=this.pii.anonymizeFields(t,["id"]);this.transaction=ii.from(e)},t.prototype.getTransaction=function(){return this.transaction},t.prototype.sendTransaction=function(){this.sessionRenewer.isSessionValid()&&(this.transaction.hasValidRevenue()?this.transactionRequest.send():ht.warn("Transaction Service: unable to send transaction with invalid parameters"))},t.prototype.addItem=function(t){if(!st(t)){var e=this.pii.anonymizeFields(t,["id","name","sku","category"]),r=ni.from(e);null!==r&&csArray.prototype.push.call(this.transactionItems,r)}},t.prototype.getItems=function(){return this.transactionItems},t.prototype.clear=function(){this.transaction=ii.from({revenue:NaN}),this.transactionItems=[]},t.prototype.getRequestParameters=function(){var t={id:this.transaction.id?""+this.transaction.id:"",revenue:""+this.transaction.revenue};return nt(this.transaction.tax)&&(t.tax=""+this.transaction.tax),nt(this.transaction.shipping)&&(t.shipping=""+this.transaction.shipping),nt(this.transaction.currency)&&(t.cu=""+this.transaction.currency),t.items=window.JSON.stringify(this.transactionItems),t},t}(),si=function(){function t(t,e){this.skuItem=csString.prototype.slice.call(t,0,100),this.merchantItem=e&&csString.prototype.slice.call(e,0,100)}return Object.defineProperty(t.prototype,"sku",{get:function(){return this.skuItem},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"merchant",{get:function(){return this.merchantItem},enumerable:!1,configurable:!0}),t}(),ai=function(){function t(t,e){this.cartItemRequest=t,this.sessionRenewer=e,this.cartItem=null}return t.prototype.addToCart=function(t){!this.isValidSku(t.sku)||nt(t.merchant)&&!rt(t.merchant)||(this.cartItem=new si(t.sku,t.merchant),this.sendCartItem())},t.prototype.isValidSku=function(t){return rt(t)&&t.length>0},t.prototype.getCartItem=function(){return this.cartItem},t.prototype.sendCartItem=function(){this.sessionRenewer.isSessionValid()&&this.cartItemRequest.send()},t.prototype.clear=function(){this.cartItem=null},t.prototype.getRequestParameters=function(){if(!this.cartItem)return{};var t={sku:""+this.cartItem.sku};return nt(this.cartItem.merchant)&&this.cartItem.merchant.length>0&&(t.me=this.cartItem.merchant),t},t}(),ci=["ecommerce:addToCart","ec:cart:add"],ui=["ecommerce:addTransaction","ec:transaction:create"],pi=["ecommerce:addItem","ec:transaction:items:add"],li=["ecommerce:send","ec:transaction:send"],hi=function(){function t(t,e,r,i,n,o,s){this.configuration=t,this.visitorService=e,this.sessionService=r,this.commandsService=i,this.pii=n,this.sessionRenewer=o,this.urlService=s}return t.prototype.init=function(){var t=new N(this.configuration.getTrackerUri(),"transaction"),e=new N(this.configuration.getTrackerUri(),"addtocart"),r=new oi(this.pii,t,this.sessionRenewer),n=new ai(e,this.sessionRenewer);t.setRequestParametersProviders(this.configuration,this.visitorService,this.sessionService,this.urlService,r,i),t.after((function(){r.clear()})),e.setRequestParametersProviders(this.configuration,this.visitorService,this.sessionService,this.urlService,n,i),e.after((function(){n.clear()})),this.commandsService.register(ui,(function(t){r.addTransaction(t)})),this.commandsService.register(pi,(function(t){return r.addItem(t)})),this.commandsService.register(li,(function(){return r.sendTransaction()})),this.commandsService.register(ci,(function(t){n.addToCart(t)}))},t}(),di=function(){function t(t){this.windowPerformance=t.performance}return t.prototype.getRequestParameters=function(){if(this.areTimingsUnavailable())return{};var t=this.compute();return{str:t.startRender,di:t.domInteractive,dc:t.domComplete,fl:t.fullyLoaded}},t.prototype.compute=function(){var t=this.windowPerformance.timing;return{startRender:""+(t.domLoading-t.requestStart),domInteractive:""+(t.domInteractive-t.requestStart),domComplete:""+(t.domComplete-t.requestStart),fullyLoaded:""+(t.loadEventEnd-t.requestStart)}},t.prototype.areTimingsUnavailable=function(){return!(this.windowPerformance&&this.windowPerformance.timing&&this.windowPerformance.timing.loadEventEnd>0)},t}();function fi(t){return void 0!==t.tgt}!function(t){t[t.RESIZE=0]="RESIZE",t[t.SCROLL=1]="SCROLL",t[t.MOUSEMOVE=2]="MOUSEMOVE",t[t.MOUSEDOWN=3]="MOUSEDOWN",t[t.MOUSEUP=4]="MOUSEUP",t[t.CLICK=5]="CLICK",t[t.MOUSEOVER=6]="MOUSEOVER",t[t.MOUSEOUT=7]="MOUSEOUT",t[t.CHANGE=10]="CHANGE",t[t.FOCUSIN=11]="FOCUSIN",t[t.FOCUSOUT=12]="FOCUSOUT",t[t.TAP=14]="TAP",t[t.KEYDOWN=15]="KEYDOWN",t[t.KEYUP=16]="KEYUP",t[t.COMMAND=17]="COMMAND",t[t.SUBMIT=18]="SUBMIT",t[t.PERFORMANCE=19]="PERFORMANCE",t[t.DRAG=20]="DRAG",t[t.FLICK=21]="FLICK"}(Qr||(Qr={})),function(t){t.SUCCESS="success",t.FAILURE="failure",t.ATTEMPT="attempt"}(Zr||(Zr={}));var yi=function(){function t(){}return t.prototype.isEventTypeSupported=function(t){return-1!==csArray.prototype.indexOf.call(this.supportedEventTypes,t)},t.prototype.enhanceAnalysisEvent=function(t,e){return this.isEventTypeSupported(e.type)?this.baseEnhanceAnalysisEvent(t,e):e},t}(),vi=function(t){function e(e,r){var i=t.call(this)||this;return i.projectConfiguration=e,i.pathComputation=r,i.supportedEventTypes=[Qr.MOUSEDOWN,Qr.MOUSEUP,Qr.CLICK,Qr.MOUSEOVER,Qr.TAP],i}return f(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){if(this.projectConfiguration.eMerchandisingEnabled){var r=this.pathComputation.getEventTargetPathAndTargetLink(t),i=r.path,n=r.targetLink;e.tgt=i,e.tgtLk=n}return e},e}(yi),mi=function(){function t(){}return t.build=function(t,e,r){return csArray.prototype.reduce.call(r,(function(e,r){return r.enhanceAnalysisEvent(t,e)}),e)},t}(),gi=function(t){function e(e){var r=t.call(this)||this;return r.pathComputation=e,r.supportedEventTypes=[Qr.MOUSEDOWN,Qr.MOUSEUP,Qr.CLICK,Qr.MOUSEOVER,Qr.TAP,Qr.DRAG,Qr.FLICK],r}return f(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){return e.tgt||(e.tgt=this.pathComputation.getEventTargetPath(t)),e},e}(yi),Si=function(){function t(t,e,r){this.configuration=t,this.pathComputation=e,this.gestureTracker=r,this.analysisEventsEnhancers=[new vi(this.configuration,this.pathComputation),new gi(this.pathComputation)]}return t.prototype.processGesture=function(t,e){switch(t.type){case lr.TAP:this.processTap(e);break;case lr.FLICK:this.processFlick(t,e);break;case lr.DRAG:this.processDrag(t,e)}},t.prototype.processTap=function(t){var e={type:Qr.TAP,ts:0,x:0,y:0,tgt:""},r=mi.build(t,e,this.analysisEventsEnhancers);r.tgt!==Ie.INVALID_ELEMENT&&this.onEventCallback(r)},t.prototype.processDrag=function(t,e){var r={type:Qr.DRAG,ts:0,fd:t.direction,tgt:""},i=mi.build(e,r,this.analysisEventsEnhancers);i.tgt!==Ie.INVALID_ELEMENT&&this.onEventCallback(i)},t.prototype.processFlick=function(t,e){var r={type:Qr.FLICK,ts:0,fd:t.direction,tgt:""},i=mi.build(e,r,this.analysisEventsEnhancers);i.tgt!==Ie.INVALID_ELEMENT&&this.onEventCallback(i)},t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){var e=this;this.gestureTracker.subscribe(t.TRACKER_IDENTIFIER,(function(t,r){return e.processGesture(t,r)}))},t.prototype.stop=function(){this.gestureTracker.unsubscribe(t.TRACKER_IDENTIFIER)},t.TRACKER_IDENTIFIER="AnalysisGestureTracker",t}();function Ei(t,e){var r,i,n,o,s=function(){i=null;var e=V()-n;o=t.apply(void 0,S([e],r)),n=null},a=function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return n||(n=V()),i&&window.clearTimeout(i),r=S(t),i=window.setTimeout(s,e),o};return a.flushPending=function(){i&&(window.clearTimeout(i),s())},a}var Ci,Ti;(Ti=Ci||(Ci={})).isEventOnScrollContainer=function(t){return!!(ot(t)&&function(t){try{if(ot(csEventtarget.apply(t)))return!0}catch(t){}return!1}(t)&&at(csEventtarget.apply(t))&&null!==csEventtarget.apply(t).getAttribute("data-cs-scroll-container"))},Ti.getScrollContainer=function(){return document.querySelector("[data-cs-scroll-container]")};var Ri;(Ri||(Ri={})).getRelativePosition=function(t){var e=ie(t);if(!(e&&at(e)&&st(e.getBoundingClientRect)&&ot(t.pageX)&&ot(t.pageY)))return{xRel:-1,yRel:-1,valid:!1};var r=e.getBoundingClientRect(),i=t.pageX-r.left-Ue.windowOffsetX(),n=t.pageY-r.top-Ue.windowOffsetY();e!==document.documentElement&&(i+=e.scrollLeft,n+=e.scrollTop);var o=Math.max(e.scrollWidth,r.width),s=Math.max(e.scrollHeight,r.height);return{xRel:Math.round(i/o*65535),yRel:Math.round(n/s*65535),valid:!0}};var bi=function(t){function e(e,r){var i=t.call(this)||this;return i.projectConfiguration=e,i.pathComputation=r,i.supportedEventTypes=[Qr.MOUSEMOVE],i.currentMouseMovePath="",i}return f(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){if(!this.projectConfiguration.mouseMoveHeatmapEnabled)return e;var r=Ri.getRelativePosition(t),i=r.valid,n=r.xRel,o=r.yRel;if(i){var s=this.pathComputation.getEventTargetPath(t);s!==Ie.INVALID_ELEMENT&&(e.xRel=n,e.yRel=o,s!==this.currentMouseMovePath||this.projectConfiguration.iframesTracking?(this.currentMouseMovePath=s,e.tgtHM=s):e.tgtHM="")}else this.currentMouseMovePath="";return e},e}(yi),wi=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.supportedEventTypes=[Qr.CHANGE],e.validInputTypes=["text","email","number","search","tel","url","password"],e}return f(e,t),e.prototype.baseEnhanceAnalysisEvent=function(t,e){var r,i=ie(t);return Gt(r=i)&&"input"===r.localName&&csArray.prototype.indexOf.call(this.validInputTypes,i.type)>=0&&(e.isBlank=""===i.value),e},e}(yi),Ai=function(){function t(t,e,r){var i,n,o,s,a,c,u,p=this;this.projectConfiguration=t,this.pathComputation=e,this.selector=r,this.FOCUSABLE_ELEMENTS_SELECTOR="select, select *, input, textarea",this.CHANGEABLE_ELEMENTS_SELECTOR="select, select *, input, textarea",this.HOVERABLE_ELEMENTS_SELECTOR="a, a *, button, button *, select, select *, input, textarea",this.KEYSTROKE_ELEMENTS_SELECTOR="input, select, textarea",this.DEBOUNCE_DURATION=150,this.THROTTLE_DURATION=400,this.scrollContainerDimensionSent=!1,this.debouncedScrollEventCallback=Ei((function(t,e){return p.scrollListener(t,e)}),this.DEBOUNCE_DURATION),this.debouncedResizeEventCallback=Ei((function(t){return p.resizeListener(t)}),this.DEBOUNCE_DURATION),this.throttledMouseMoveCallback=(i=function(t){return p.mouseMoveListener(t)},n=this.THROTTLE_DURATION,s=[],a=null,c=0,u=function(){c=V(),a=null,o=i.apply(void 0,s)},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=V();c||(c=r);var p=n-(r-c);return s=S(t),p<=0||p>n?(c=r,o=i.apply(void 0,s),a?(window.clearTimeout(a),a=null):s=[]):a||(a=window.setTimeout(u,p)),o}),this.globalHandlers=[{boundElement:window,type:"resize",listener:function(){return p.debouncedResizeEventCallback()}},{boundElement:document,type:"scroll",listener:function(t){return p.debouncedScrollEventCallback(t)}},{boundElement:window,type:"mousemove",listener:function(t){p.throttledMouseMoveCallback(p.preserveEventForAsyncUse(t))}},{boundElement:document,type:"mousedown",listener:function(t){return p.mouseDownListener(t)}},{boundElement:document,type:"mouseup",listener:function(t){return p.mouseUpListener(t)}},{boundElement:document,type:"click",listener:function(t){return p.clickListener(t)}}],this.onSelectorHandlers=[{boundElement:document,type:"mouseover",listener:this.selector.on(this.HOVERABLE_ELEMENTS_SELECTOR,(function(t){return p.mouseOverListener(t)}))},{boundElement:document,type:"mouseout",listener:this.selector.on(this.HOVERABLE_ELEMENTS_SELECTOR,(function(t){return p.mouseOutListener(t)}))},{boundElement:document,type:"focusin",listener:this.selector.on(this.FOCUSABLE_ELEMENTS_SELECTOR,(function(t){return p.focusInListener(t)}))},{boundElement:document,type:"focusout",listener:this.selector.on(this.FOCUSABLE_ELEMENTS_SELECTOR,(function(t){return p.focusOutListener(t)}))},{boundElement:document,type:"change",listener:this.selector.on(this.CHANGEABLE_ELEMENTS_SELECTOR,(function(t){return p.changeListener(t)}))},{boundElement:document,type:"keyup",listener:this.selector.on(this.KEYSTROKE_ELEMENTS_SELECTOR,(function(t){return p.keyUpListener(t)}))},{boundElement:document,type:"keydown",listener:this.selector.on(this.KEYSTROKE_ELEMENTS_SELECTOR,(function(t){return p.keyDownListener(t)}))},{boundElement:document,type:"copy",listener:this.selector.on(this.KEYSTROKE_ELEMENTS_SELECTOR,(function(t){return p.copyListener(t)}))},{boundElement:document,type:"cut",listener:this.selector.on(this.KEYSTROKE_ELEMENTS_SELECTOR,(function(t){return p.cutListener(t)}))},{boundElement:document,type:"paste",listener:this.selector.on(this.KEYSTROKE_ELEMENTS_SELECTOR,(function(t){return p.pasteListener(t)}))}],this.analysisEventsEnhancers=[new vi(this.projectConfiguration,this.pathComputation),new bi(this.projectConfiguration,this.pathComputation),new wi,new gi(this.pathComputation)],this.keyStrokeMap={},this.initKeyStrokesMap()}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){var t=this.getSupportedHandlers();csArray.prototype.forEach.call(t,(function(t){return Ht(t)})),this.resizeListener()},t.prototype.stop=function(){var t=this.getSupportedHandlers();csArray.prototype.forEach.call(t,(function(t){return Ft(t)}))},t.prototype.flushPendingDebouncedListeners=function(){this.debouncedScrollEventCallback.flushPending(),this.debouncedResizeEventCallback.flushPending()},t.prototype.getSupportedHandlers=function(){return this.selector.isMatchesSelectorSupported()?S(this.globalHandlers,this.onSelectorHandlers):(ht.warn("Element.matches is not implemented yet"),this.globalHandlers)},t.prototype.resizeListener=function(t){var e=Ci.getScrollContainer(),r=at(e);r&&(this.scrollContainerDimensionSent=!0);var i={type:Qr.RESIZE,ts:0,x:r?e.clientWidth:Ue.windowWidth(),y:r?e.clientHeight:Ue.windowHeight()};void 0!==t&&(i.d=t),this.onEventCallback(i)},t.prototype.scrollListener=function(t,e){var r=Ci.isEventOnScrollContainer(e);!this.scrollContainerDimensionSent&&r&&this.resizeListener();var i={type:Qr.SCROLL,ts:0,x:r?csEventtarget.apply(e).scrollLeft:Ue.windowOffsetX(),y:r?csEventtarget.apply(e).scrollTop:Ue.windowOffsetY(),d:t},n=mi.build(e,i,this.analysisEventsEnhancers);this.onEventCallback(n)},t.prototype.mouseMoveListener=function(t){var e={type:Qr.MOUSEMOVE,ts:0,x:t.pageX,y:t.pageY},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallback(r)},t.prototype.mouseDownListener=function(t){var e={type:Qr.MOUSEDOWN,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.mouseUpListener=function(t){var e={type:Qr.MOUSEUP,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.clickListener=function(t){var e={type:Qr.CLICK,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.mouseOverListener=function(t){var e={type:Qr.MOUSEOVER,ts:0,x:t.pageX,y:t.pageY,tgt:""},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.mouseOutListener=function(t){var e={type:Qr.MOUSEOUT,ts:0,x:t.pageX,y:t.pageY,tgt:this.pathComputation.getEventTargetPath(t)},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.focusInListener=function(t){var e={type:Qr.FOCUSIN,ts:0,tgt:this.pathComputation.getEventTargetPath(t)},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.focusOutListener=function(t){var e={type:Qr.FOCUSOUT,ts:0,tgt:this.pathComputation.getEventTargetPath(t)},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.changeListener=function(t){var e={type:Qr.CHANGE,ts:0,tgt:this.pathComputation.getEventTargetPath(t)},r=mi.build(t,e,this.analysisEventsEnhancers);this.onEventCallbackIfValidTarget(r)},t.prototype.copyListener=function(t){var e={type:Qr.COMMAND,ts:0,tgt:this.pathComputation.getEventTargetPath(t),key:ee.COPY};this.onEventCallbackIfValidTarget(e)},t.prototype.cutListener=function(t){var e={type:Qr.COMMAND,ts:0,tgt:this.pathComputation.getEventTargetPath(t),key:ee.CUT};this.onEventCallbackIfValidTarget(e)},t.prototype.pasteListener=function(t){var e={type:Qr.COMMAND,ts:0,tgt:this.pathComputation.getEventTargetPath(t),key:ee.PASTE};this.onEventCallbackIfValidTarget(e)},t.prototype.keyUpListener=function(t){var e={type:Qr.KEYUP,ts:0,tgt:this.pathComputation.getEventTargetPath(t),key:this.computeKeystrokeKey(t)};this.onEventCallbackIfValidTarget(e)},t.prototype.keyDownListener=function(t){var e={type:Qr.KEYDOWN,ts:0,tgt:this.pathComputation.getEventTargetPath(t),key:this.computeKeystrokeKey(t)};this.onEventCallbackIfValidTarget(e)},t.prototype.computeKeystrokeKey=function(t){var e=this.keyStrokeMap[t.key];return void 0===e?te.ALPHANUMERICAL:e},t.prototype.onEventCallbackIfValidTarget=function(t){fi(t)&&t.tgt!==Ie.INVALID_ELEMENT&&this.onEventCallback(t)},t.prototype.preserveEventForAsyncUse=function(t){return t.composedPath&&Object.defineProperty(t,"__csOriginalTarget",{value:t.composedPath()[0],writable:!1,enumerable:!1}),t},t.prototype.initKeyStrokesMap=function(){this.keyStrokeMap[" "]=te.SPACE,this.keyStrokeMap.Spacebar=te.SPACE,this.keyStrokeMap.Enter=te.ENTER,this.keyStrokeMap.Backspace=te.BACKSPACE,this.keyStrokeMap.Delete=te.DELETE,this.keyStrokeMap.ArrowUp=te.ARROWUP,this.keyStrokeMap.ArrowDown=te.ARROWDOWN,this.keyStrokeMap.ArrowLeft=te.ARROWLEFT,this.keyStrokeMap.ArrowRight=te.ARROWRIGHT,this.keyStrokeMap.Up=te.ARROWUP,this.keyStrokeMap.Down=te.ARROWDOWN,this.keyStrokeMap.Left=te.ARROWLEFT,this.keyStrokeMap.Right=te.ARROWRIGHT,this.keyStrokeMap.CapsLock=te.CAPSLOCK,this.keyStrokeMap.Shift=te.SHIFT,this.keyStrokeMap.Tab=te.TAB},v([dt("Event handler type: resize")],t.prototype,"resizeListener",null),v([dt("Event handler type: scroll")],t.prototype,"scrollListener",null),v([dt("Event handler type: mouseMove")],t.prototype,"mouseMoveListener",null),v([dt("Event handler type: mouseDown")],t.prototype,"mouseDownListener",null),v([dt("Event handler type: mouseUp")],t.prototype,"mouseUpListener",null),v([dt("Event handler type: click")],t.prototype,"clickListener",null),v([dt("Event handler type: mouseOver")],t.prototype,"mouseOverListener",null),v([dt("Event handler type: mouseOut")],t.prototype,"mouseOutListener",null),v([dt("Event handler type: focusIn")],t.prototype,"focusInListener",null),v([dt("Event handler type: focusOut")],t.prototype,"focusOutListener",null),v([dt("Event handler type: change")],t.prototype,"changeListener",null),v([dt("Event handler type: copy")],t.prototype,"copyListener",null),v([dt("Event handler type: cut")],t.prototype,"cutListener",null),v([dt("Event handler type: paste")],t.prototype,"pasteListener",null),v([dt("Event handler type: keyup")],t.prototype,"keyUpListener",null),v([dt("Event handler type: keydown")],t.prototype,"keyDownListener",null),t}(),ki=function(){function t(){var t=this;this.MAX_SCROLL_RATE_THRESHOLD=100,this.maxScrollRate=0,this.maxDocumentHeight=Ue.documentHeight(),this.maxScrollRateHandler={boundElement:document,type:"scroll",listener:function(e){return t.maxScrollRateListener(e)}}}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){Ht(this.maxScrollRateHandler),this.reset()},t.prototype.stop=function(){Ft(this.maxScrollRateHandler)},t.prototype.reset=function(){this.maxDocumentHeight=Ue.documentHeight();var t=Ci.getScrollContainer();if(null===t)this.maxScrollRate=this.currentScrollRate(Ue.documentHeight());else{var e=this.computePaddingTop(t);this.maxScrollRate=this.currentScrollRateWithScrollContainer(t,e)}this.onEventCallback()},t.prototype.maxScrollRateListener=function(t){var e,r;if(Ci.isEventOnScrollContainer(t)){var i=csEventtarget.apply(t),n=this.computePaddingTop(i);e=this.documentHeightWithScrollContainer(i,n),r=this.currentScrollRateWithScrollContainer(i,n)}else e=Ue.documentHeight(),r=this.currentScrollRate(e);(r>this.maxScrollRate||e>this.maxDocumentHeight)&&(this.maxScrollRate=r,e>this.maxDocumentHeight&&(this.maxDocumentHeight=e),this.onEventCallback())},t.prototype.currentScrollRate=function(t){var e=Math.round(this.lastPixelLine()/t*100);return Math.min(e,this.MAX_SCROLL_RATE_THRESHOLD)},t.prototype.lastPixelLine=function(){var t=Ue.windowHeight();return Ue.windowOffsetY()+t},t.prototype.currentScrollRateWithScrollContainer=function(t,e){var r=t.scrollTop+t.clientHeight+t.getBoundingClientRect().top+e,i=this.documentHeightWithScrollContainer(t,e),n=Math.round(r/i*100);return Math.min(n,this.MAX_SCROLL_RATE_THRESHOLD)},t.prototype.computePaddingTop=function(t){var e=window.getComputedStyle(t).paddingTop||"0px";return parseInt(e,10)},t.prototype.documentHeightWithScrollContainer=function(t,e){return t.scrollHeight+t.getBoundingClientRect().top+e},t.prototype.getRequestParameters=function(){return{sr:""+this.maxScrollRate,mdh:""+this.maxDocumentHeight}},v([dt("MaxScrollRate handler")],t.prototype,"maxScrollRateListener",null),t}(),Ii=function(){function t(t,e,r,i,n,o,s,a,c,u,p,l,h,d){this.configuration=t,this.analysisEventsTracker=e,this.gestureTracker=r,this.maxScrollRateTracker=i,this.performanceTimingMetrics=n,this.analysisEventsBatch=o,this.analysisEventsRequest=s,this.analysisLastEventsRequest=a,this.analysisEventRequestParameters=c,this.sessionRenewer=u,this.recoveryStorage=p,this.projectPathComputation=l,this.performanceTracker=h,this.lastEventsTracker=d,this.eventEmitter=new ve}return t.prototype.init=function(){var t=this;this.analysisEventsTracker.onEvent((function(e){return t.processEvent(e)})),this.gestureTracker.onEvent((function(e){return t.processEvent(e)})),this.maxScrollRateTracker.onEvent((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.maxScrollRateTracker)})),this.performanceTracker.onEvent((function(e){return t.processEvent(e)})),this.lastEventsTracker.onEvent((function(){t.analysisEventsBatch.isEmpty()||t.analysisLastEventsRequest.send()})),this.bindRequests()},t.prototype.bindRequests=function(){var t=this;this.analysisEventsRequest.setRequestParametersProviders(this.analysisEventsBatch),this.analysisEventsRequest.before((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.performanceTimingMetrics),t.analysisEventsBatch.enableCompression()})),this.analysisEventsRequest.after((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.analysisEventRequestParameters)})),this.analysisEventsRequest.setRequestPayloadProvider(this.analysisEventsBatch),this.analysisEventsRequest.afterProvidersCalled((function(){return t.analysisEventsBatch.clearEvents()})),this.analysisLastEventsRequest.setRequestParametersProviders(this.analysisEventsBatch),this.analysisLastEventsRequest.setRequestPayloadProvider(this.analysisEventsBatch),this.analysisLastEventsRequest.before((function(){t.analysisEventsBatch.setRequestParametersFromProvider(t.performanceTimingMetrics),t.analysisEventsBatch.disableCompression()})),this.analysisLastEventsRequest.onBeaconSuccess((function(){t.analysisEventsBatch.clearEvents(),t.analysisEventsBatch.setRequestParametersFromProvider(t.analysisEventRequestParameters)})),this.analysisLastEventsRequest.onBeaconFailure((function(){t.saveLastEvents()}))},t.prototype.initStates=function(){this.analysisEventsBatch.setRequestParametersFromProvider(this.analysisEventRequestParameters),this.resetStartTime()},t.prototype.start=function(t){this.lastEventsTracker.start(),this.analysisEventsTracker.start(),this.maxScrollRateTracker.start(),this.gestureTracker.start(),t||this.performanceTracker.start()},t.prototype.onIframeAnalysisEvent=function(t){this.processEvent(t)},t.prototype.processEvent=function(t){this.sessionRenewer.isSessionValid()&&(this.analysisEventsBatch.addEvent(this.addTimestamp(t)),this.analysisEventsBatch.isFull()&&this.sendEvents(),this.configuration.emitDebugEvents&&this.eventEmitter.emit("analysisEvent",y(y({},t),{typeName:Qr[t.type]})))},t.prototype.addTimestamp=function(t){return t.ts=this.getRelativeTime(),t},t.prototype.sendEvents=function(){this.analysisEventsBatch.isEmpty()||this.analysisEventsRequest.send()},t.prototype.stop=function(){this.lastEventsTracker.stop(),this.analysisEventsTracker.stop(),this.maxScrollRateTracker.stop(),this.gestureTracker.stop(),this.performanceTracker.stop(),this.analysisEventsBatch.empty()},t.prototype.clearStates=function(){this.analysisEventsTracker.flushPendingDebouncedListeners(),this.sendEvents(),this.maxScrollRateTracker.reset(),this.performanceTracker.stop()},t.prototype.resetStartTime=function(){this.startTime=V()},t.prototype.getRelativeTime=function(){return V()-this.startTime},t.prototype.saveLastEvents=function(){try{this.analysisEventsBatch.isEmpty()||this.recoveryStorage.save({events:this.analysisEventsBatch.getEvents(),metadata:this.analysisEventsBatch.getMetadata()})}catch(t){}},t.prototype.pushSubmitEvent=function(t,e){if(function(t){return t===Zr.SUCCESS||t===Zr.FAILURE||t===Zr.ATTEMPT}(t))if(at(e)){var r={status:t,type:Qr.SUBMIT,ts:0,tgt:this.projectPathComputation.getElementPath(e)};r.tgt!==Ie.INVALID_ELEMENT&&this.processEvent(r)}else ht.warn("AnalysisEvents Service: invalid element: "+e);else ht.warn("AnalysisEvents Service: invalid submit status: "+t)},t}(),Pi=function(){function t(t){var e=t.events,r=void 0===e?[]:e,i=t.requestParameters,n=void 0===i?{}:i,o=t.stringCompression;this.compressed=!0,this.events=[],this.requestParameters={},this.events=r,this.requestParameters=n,this.stringCompression=o}return t.prototype.getRequestPayload=function(){return this.isCompressed()?this.stringCompression.compressSync(csJSON.stringify(this.events)):csJSON.stringify(this.events)},t.prototype.addEvent=function(t){csArray.prototype.push.call(this.events,t)},t.prototype.setRequestParametersFromProvider=function(t){var e=t.getRequestParameters();for(var r in e)e.hasOwnProperty(r)&&(this.requestParameters[r]=e[r])},t.prototype.eventsCount=function(){return this.events.length},t.prototype.clearEvents=function(){this.events=[]},t.prototype.empty=function(){this.clearEvents()},t.prototype.isFull=function(){return this.eventsCount()>=50},t.prototype.isEmpty=function(){return 0===this.events.length},t.prototype.getEvents=function(){return this.events},t.prototype.getMetadata=function(){return this.requestParameters},t.prototype.getRequestParameters=function(){var t,e;return y(y({},this.requestParameters),{ct:this.isCompressed()?oe.BASE64:oe.UNCOMPRESSED,enc:null!==(e=null===(t=this.stringCompression)||void 0===t?void 0:t.algorithm)&&void 0!==e?e:"raw"})},t.prototype.enableCompression=function(){this.compressed=!0},t.prototype.disableCompression=function(){this.compressed=!1},t.prototype.isCompressed=function(){return this.compressed},t}(),Ni=function(){function t(t,e,r){var i=this;this.analysisEventsRecoveryRequest=t,this.recoveryStorage=e,this.stringCompression=r,this.visibilityChangeHandler=function(){"visible"===document.visibilityState&&i.sendPersistedRecordings()}}return t.prototype.start=function(){this.sendPersistedRecordings(),this.addVisibilityChangeListener()},t.prototype.stop=function(){this.removeVisibilityChangeListener()},t.prototype.getRecoveryStorage=function(){return this.recoveryStorage},t.prototype.sendPersistedRecordings=function(){var t=this.recoveryStorage.recover();if(null!==t){var e=t,r=e.metadata,i=e.events,n=new Pi({events:i,requestParameters:r,stringCompression:this.stringCompression});this.analysisEventsRecoveryRequest.setRequestParametersProviders(n),this.analysisEventsRecoveryRequest.before((function(){n.enableCompression()})),this.analysisEventsRecoveryRequest.setRequestPayloadProvider(n),this.analysisEventsRecoveryRequest.afterProvidersCalled((function(){return n.clearEvents()})),this.analysisEventsRecoveryRequest.send()}},t.prototype.addVisibilityChangeListener=function(){document.addEventListener("visibilitychange",this.visibilityChangeHandler)},t.prototype.removeVisibilityChangeListener=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},t}();var Oi,Li,Mi,Di,xi=function(){function t(t){this.storageName=t}return t.prototype.save=function(t){localStorage.setItem(this.storageName,csJSON.stringify(t))},t.prototype.clear=function(){localStorage.removeItem(this.storageName)},t.prototype.recover=function(){var t=localStorage.getItem(this.storageName);if(null===t)return null;var e=null;try{e=csJSON.parse(t)}catch(e){ht.error("Invalid item in localStorage.\n         (key:"+this.storageName+"; value:"+t+")")}finally{this.clear()}return e},t}(),_i=function(){function t(t){var e=this;this.webVitalsProvider=t,this.metricHandler=function(t){return e.processMetric(t)},this.isStarted=!1}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){this.isStarted||(this.isStarted=!0,this.webVitalsProvider.onFCP(this.metricHandler),this.webVitalsProvider.onCLS(this.metricHandler),this.webVitalsProvider.onFID(this.metricHandler),this.webVitalsProvider.onLCP(this.metricHandler),this.webVitalsProvider.onTTFB(this.metricHandler))},t.prototype.stop=function(){this.isStarted=!1},t.prototype.processMetric=function(t){if(this.isStarted){var e={type:Qr.PERFORMANCE,name:t.name,val:t.value,ts:0};this.onEventCallback(e)}},v([dt("Performance metric handler")],t.prototype,"processMetric",null),t}(),Vi=function(t,e){return{name:t,value:void 0===e?-1:e,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},qi=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){if("first-input"===t&&!("PerformanceEventTiming"in self))return;var r=new PerformanceObserver((function(t){return t.getEntries().map(e)}));return r.observe({type:t,buffered:!0}),r}}catch(t){}},zi=function(t,e){var r=function r(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(t(i),e&&(removeEventListener("visibilitychange",r,!0),removeEventListener("pagehide",r,!0)))};addEventListener("visibilitychange",r,!0),addEventListener("pagehide",r,!0)},Ui=function(t){addEventListener("pageshow",(function(e){e.persisted&&t(e)}),!0)},Bi=function(t,e,r){var i;return function(n){e.value>=0&&(n||r)&&(e.delta=e.value-(i||0),(e.delta||void 0===i)&&(i=e.value,t(e)))}},Hi=-1,Fi=function(){return"hidden"===document.visibilityState?0:1/0},Gi=function(){zi((function(t){var e=t.timeStamp;Hi=e}),!0)},ji=function(){return Hi<0&&(Hi=Fi(),Gi(),Ui((function(){setTimeout((function(){Hi=Fi(),Gi()}),0)}))),{get firstHiddenTime(){return Hi}}},Ki=function(t,e){var r,i=ji(),n=Vi("FCP"),o=function(t){"first-contentful-paint"===t.name&&(a&&a.disconnect(),t.startTime<i.firstHiddenTime&&(n.value=t.startTime,n.entries.push(t),r(!0)))},s=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],a=s?null:qi("paint",o);(s||a)&&(r=Bi(t,n,e),s&&o(s),Ui((function(i){n=Vi("FCP"),r=Bi(t,n,e),requestAnimationFrame((function(){requestAnimationFrame((function(){n.value=performance.now()-i.timeStamp,r(!0)}))}))})))},Wi=!1,Yi=-1,Xi={passive:!0,capture:!0},Ji=new Date,Qi=function(t,e){Oi||(Oi=e,Li=t,Mi=new Date,tn(removeEventListener),Zi())},Zi=function(){if(Li>=0&&Li<Mi-Ji){var t={entryType:"first-input",name:Oi.type,target:Oi.target,cancelable:Oi.cancelable,startTime:Oi.timeStamp,processingStart:Oi.timeStamp+Li};Di.forEach((function(e){e(t)})),Di=[]}},$i=function(t){if(t.cancelable){var e=(t.timeStamp>1e12?new Date:performance.now())-t.timeStamp;"pointerdown"==t.type?function(t,e){var r=function(){Qi(t,e),n()},i=function(){n()},n=function(){removeEventListener("pointerup",r,Xi),removeEventListener("pointercancel",i,Xi)};addEventListener("pointerup",r,Xi),addEventListener("pointercancel",i,Xi)}(e,t):Qi(e,t)}},tn=function(t){["mousedown","keydown","touchstart","pointerdown"].forEach((function(e){return t(e,$i,Xi)}))},en={},rn=function(){function t(){}return t.prototype.onFCP=function(t){Ki(t,!0)},t.prototype.onCLS=function(t){!function(t,e){Wi||(Ki((function(t){Yi=t.value})),Wi=!0);var r,i=function(e){Yi>-1&&t(e)},n=Vi("CLS",0),o=0,s=[],a=function(t){if(!t.hadRecentInput){var e=s[0],i=s[s.length-1];o&&t.startTime-i.startTime<1e3&&t.startTime-e.startTime<5e3?(o+=t.value,s.push(t)):(o=t.value,s=[t]),o>n.value&&(n.value=o,n.entries=s,r())}},c=qi("layout-shift",a);c&&(r=Bi(i,n,e),zi((function(){c.takeRecords().map(a),r(!0)})),Ui((function(){o=0,Yi=-1,n=Vi("CLS",0),r=Bi(i,n,e)})))}(t,!0)},t.prototype.onFID=function(t){!function(t,e){var r,i=ji(),n=Vi("FID"),o=function(t){t.startTime<i.firstHiddenTime&&(n.value=t.processingStart-t.startTime,n.entries.push(t),r(!0))},s=qi("first-input",o);r=Bi(t,n,e),s&&zi((function(){s.takeRecords().map(o),s.disconnect()}),!0),s&&Ui((function(){var i;n=Vi("FID"),r=Bi(t,n,e),Di=[],Li=-1,Oi=null,tn(addEventListener),i=o,Di.push(i),Zi()}))}(t,!0)},t.prototype.onLCP=function(t){!function(t,e){var r,i=ji(),n=Vi("LCP"),o=function(t){var e=t.startTime;e<i.firstHiddenTime&&(n.value=e,n.entries.push(t),r())},s=qi("largest-contentful-paint",o);if(s){r=Bi(t,n,e);var a=function(){en[n.id]||(s.takeRecords().map(o),s.disconnect(),en[n.id]=!0,r(!0))};["keydown","click"].forEach((function(t){addEventListener(t,a,{once:!0,capture:!0})})),zi(a,!0),Ui((function(i){n=Vi("LCP"),r=Bi(t,n,e),requestAnimationFrame((function(){requestAnimationFrame((function(){n.value=performance.now()-i.timeStamp,en[n.id]=!0,r(!0)}))}))}))}}(t,!0)},t.prototype.onTTFB=function(t){!function(t){var e,r=Vi("TTFB");e=function(){try{var e=performance.getEntriesByType("navigation")[0]||function(){var t=performance.timing,e={entryType:"navigation",startTime:0};for(var r in t)"navigationStart"!==r&&"toJSON"!==r&&(e[r]=Math.max(t[r]-t.navigationStart,0));return e}();if(r.value=r.delta=e.responseStart,r.value<0||r.value>performance.now())return;r.entries=[e],t(r)}catch(t){}},"complete"===document.readyState?setTimeout(e,0):addEventListener("load",(function(){return setTimeout(e,0)}))}(t)},t}(),nn=function(){function t(){var t=this;this.isStarted=!1,this.sendLastEvents=function(e){try{if(("pagehide"===e.type||"visibilitychange"===e.type)&&"hidden"!==document.visibilityState)return;t.eventCallback()}catch(t){}}}return t.prototype.start=function(){this.isStarted||(this.isStarted=!0,this.addVisibilityChangeListener(),this.addPageHideListener(),this.addBlurListener())},t.prototype.stop=function(){this.isStarted&&(this.isStarted=!1,this.removeVisibilityChangeListener(),this.removePageHideListener(),this.removeBlurListener())},t.prototype.onEvent=function(t){this.eventCallback=t},t.prototype.addVisibilityChangeListener=function(){document.addEventListener("visibilitychange",this.sendLastEvents)},t.prototype.removeVisibilityChangeListener=function(){document.removeEventListener("visibilitychange",this.sendLastEvents)},t.prototype.addPageHideListener=function(){window.addEventListener("pagehide",this.sendLastEvents)},t.prototype.removePageHideListener=function(){window.removeEventListener("pagehide",this.sendLastEvents)},t.prototype.addBlurListener=function(){window.addEventListener("blur",this.sendLastEvents)},t.prototype.removeBlurListener=function(){window.removeEventListener("blur",this.sendLastEvents)},t}(),on=["submit"],sn=function(){function t(t,e,r,i,n,o,s,a,c,u){this.configuration=t,this.visitorService=e,this.sessionService=r,this.projectPathComputation=i,this.selector=n,this.commandsService=o,this.sessionRenewer=s,this.gestureTracker=a,this.iframeEventsEmitter=c,this.stringCompression=u}return t.prototype.init=function(){var t=this;!function(){localStorage.removeItem("csLegacyRecovered");for(var t=[],e=0;e<localStorage.length;e+=1){var r=localStorage.key(e);0===csString.prototype.indexOf.call(r,"CSStorageData")&&csArray.prototype.push.call(t,r)}csArray.prototype.forEach.call(t,(function(t){return localStorage.removeItem(t)}))}();var e=new Pi({stringCompression:this.stringCompression});this.analysisEventsRecovery=this.createRecovery(),this.analysisEventsService=this.createService(e,this.analysisEventsRecovery.getRecoveryStorage()),this.analysisEventsService.init(),this.iframeEventsEmitter.addListeners(this.analysisEventsService),this.commandsService.register(on,(function(e,r){t.analysisEventsService.pushSubmitEvent(e,r)}))},t.prototype.onStartTracking=function(t){this.analysisEventsRecovery.start(),this.analysisEventsService.start(t)},t.prototype.onAfterNaturalPageView=function(){this.analysisEventsService.initStates()},t.prototype.onAfterArtificialPageView=function(){this.analysisEventsService.initStates()},t.prototype.onBeforeArtificialPageView=function(){this.analysisEventsService.clearStates()},t.prototype.onBeforeSessionRenewal=function(){this.analysisEventsService.clearStates(),this.analysisEventsService.stop(),this.analysisEventsRecovery.stop()},t.prototype.onOptout=function(){this.analysisEventsService.stop(),this.analysisEventsRecovery.stop()},t.prototype.createService=function(t,e){var r=new di(window),n=new ki,o=new Ai(this.configuration,this.projectPathComputation,this.selector),s=new Si(this.configuration,this.projectPathComputation,this.gestureTracker),a=new _i(new rn),c=new nn,u=new Bt(this.configuration.getTrackerUri(),"v2/events"),p=new fr(this.configuration.getTrackerUri(),"v2/events"),l=new Ge(this.configuration,this.visitorService,this.sessionService,n,r,i);return new Ii(this.configuration,o,s,n,r,t,u,p,l,this.sessionRenewer,e,this.projectPathComputation,a,c)},t.prototype.createRecovery=function(){var t=new Bt(this.configuration.getTrackerUri(),"v2/events");return new Ni(t,new xi("csAnalysisEventsPersisted"),this.stringCompression)},t}(),an=function(t){function e(e,r,i){var n=t.call(this)||this;return n.lifeCycleEventsEmitter=e,n.pageViewRequest=r,n.urlService=i,n}return f(e,t),e.prototype.init=function(){this.addPageShowListener()},e.prototype.onStart=function(){this.sendNaturalPageView()},e.prototype.onStop=function(){},e.prototype.triggerArtificialPageView=function(t){this.isStarted?this.sendArtificialPageView(t):this.urlService.overridePath(t)},e.prototype.sendNaturalPageView=function(){this.lifeCycleEventsEmitter.emitBeforeNaturalPageView(),this.pageViewRequest.send(),this.lifeCycleEventsEmitter.emitAfterNaturalPageView()},e.prototype.sendArtificialPageView=function(t){this.lifeCycleEventsEmitter.emitArtificialPageViewEnd(),t&&this.urlService.overridePath(t),this.lifeCycleEventsEmitter.emitBeforeArtificialPageView(),this.pageViewRequest.send(),this.lifeCycleEventsEmitter.emitAfterArtificialPageView()},e.prototype.addPageShowListener=function(){var t=this;window.addEventListener("pageshow",(function(e){t.isStarted&&e.persisted&&t.sendArtificialPageView()}))},e}(me),cn=window.navigator.language||window.navigator.userLanguage||window.navigator.browserLanguage||window.navigator.systemLanguage||"unknown";function un(){return{la:cn}}var pn,ln=function(){function t(t){this.pii=t}return t.prototype.getRequestParameters=function(){return{dr:this.get()}},t.prototype.get=function(){return this.pii.anonymize(this.getReferrer())},t.prototype.getReferrer=function(){var t="";try{t=window.top.document.referrer}catch(e){if(window.parent)try{t=window.parent.document.referrer}catch(e){t=""}}return""===t&&(t=document.referrer),t},t}(),hn=["trackPageview"],dn=["setPath"],fn=["setQuery"],yn=function(){function t(t,e,r,i,n,o,s,a,c){this.configuration=t,this.commandsService=e,this.lifeCycleEventsEmitter=r,this.visitorService=i,this.sessionService=n,this.consentService=o,this.customVariablesService=s,this.pii=a,this.urlService=c}return t.prototype.init=function(){var t=this,e=new N(this.configuration.getTrackerUri(),"pageview");this.pageViewService=new an(this.lifeCycleEventsEmitter,e,this.urlService),this.pageViewService.init(),e.setRequestParametersProviders(this.configuration,this.visitorService,this.sessionService,Ue,new ln(this.pii),this.urlService,this.consentService,n,this.customVariablesService,i),this.commandsService.register(hn,(function(e){return t.pageViewService.triggerArtificialPageView(e)})),this.commandsService.register(dn,(function(e){return t.urlService.overridePath(e)})),this.commandsService.register(fn,(function(e){return t.urlService.overrideQuery(e)}))},t.prototype.start=function(){this.pageViewService.start()},t.prototype.onBeforeSessionRenewal=function(){this.pageViewService.stop()},t}(),vn=function(){function t(t,e){this.pathComputation=t,this.configuration=e}return t.prototype.getEventTargetPath=function(t){var e=ie(t);return this.pathComputation.getElementPath(e,y({dynamicIdRegex:this.configuration.dynamicIdRegex},this.configuration.pathComputationRules))},t.prototype.getEventTargetPathAndTargetLink=function(t){var e=ie(t),r=this.pathComputation.getElementPathAndFirstAnchorParent(e,y({dynamicIdRegex:this.configuration.dynamicIdRegex},this.configuration.pathComputationRules)),i=r.path,n=r.firstAnchorParent;return{path:i,targetLink:this.hasValidTargetLink(n)?n.href:""}},t.prototype.hasValidEventTarget=function(t){var e=ie(t);return this.pathComputation.isValidElement(e)},t.prototype.getElementPath=function(t){return this.pathComputation.getElementPath(t,y({dynamicIdRegex:this.configuration.dynamicIdRegex},this.configuration.pathComputationRules))},t.prototype.hasValidTargetLink=function(t){return null!==t&&t.hasAttribute("href")&&!T(t.getAttribute("href"),"#")},t}(),mn=function(){function t(t){this.pathComputation=t}return t.prototype.on=function(t,e){var r=this;return function(i){r.pathComputation.hasValidEventTarget(i)&&r.targetMatchesSelector(i,t)&&e(i)}},t.prototype.targetMatchesSelector=function(t,e){var r=ie(t);return De.call(r,e)},t.prototype.isMatchesSelectorSupported=function(){return!!De},t}(),gn=function(){function t(){}return t.prototype.onLoad=function(t){this.onLoadCallback=t},t.prototype.onLoadCallbackExecute=function(){this.onLoadCallback()},t.prototype.start=function(){var t=this.onLoadCallbackExecute.bind(this);this.onDocumentLoaded(t)},t.prototype.onDocumentLoaded=function(t){function e(){document.removeEventListener("DOMContentLoaded",e),window.removeEventListener("load",e),t()}"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?setTimeout(t):(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e))},v([dt("onLoad")],t.prototype,"onLoadCallbackExecute",null),t}(),Sn=["clearSession"],En=["extendSession"],Cn=function(){function t(t,e,r){this.visitorService=t,this.sessionService=e,this.commandsService=r}return t.prototype.init=function(){var t=this;this.commandsService.register(Sn,(function(){return t.sessionService.removeSession()})),this.commandsService.register(En,(function(){return t.sessionService.extendSessionPeriodically()}))},t.prototype.onBeforeNaturalPageView=function(){this.visitorService.createOrUpdateVisitor(),this.sessionService.createOrUpdateSession()},t.prototype.onBeforeArtificialPageView=function(){this.sessionService.abortQuotaServiceRequest(),this.visitorService.createOrUpdateVisitor(),this.sessionService.createOrUpdateSession()},t.prototype.onOptout=function(){this.visitorService.removeVisitor(),this.sessionService.removeSession()},t.prototype.onRecordingStateChange=function(t,e){this.sessionService.updateRecordingState(t,e)},t}(),Tn=function(){function t(t){this.sessionService=t}return t.prototype.onSessionExpired=function(t){this.onSessionExpiredCallback=t},t.prototype.isSessionValid=function(){var t=this.sessionService.hasValidSession();return!t&&this.canRenewSession()?(this.lastSessionRenewalTime=V(),this.onSessionExpiredCallback(),this.sessionService.hasValidSession()):t},t.prototype.canRenewSession=function(){return!nt(this.lastSessionRenewalTime)||V()-this.lastSessionRenewalTime>6e4},t}(),Rn=function(t){function e(e,r,i,n,o,s,a){var c=t.call(this)||this;return c.urlService=e,c.eMerchandisingLazyLoadedProductsTracker=r,c.lastEventsTracker=i,c.eMerchandisingRequest=n,c.eMerchandisingLazyLoadingRequest=o,c.eMerchandisingBeaconRequest=s,c.eMerchandisingProductsBatch=a,c.requestPayload={targetUrl:"",windowWidth:0,windowHeight:0,products:[]},c}return f(e,t),e.prototype.init=function(){this.initRequests(),this.initProductsTracker(),this.initLastEventsTracker()},e.prototype.collectInitialProducts=function(){var t=this.eMerchandisingLazyLoadedProductsTracker.collectProducts();this.requestPayload=this.buildEmerchandisingData(t),this.eMerchandisingRequest.send()},e.prototype.onIframeEmerchandisingMessage=function(t){this.requestPayload=t,this.eMerchandisingRequest.send()},e.prototype.clearState=function(){this.eMerchandisingLazyLoadedProductsTracker.flushEvents(),this.eMerchandisingProductsBatch.isEmpty()||this.eMerchandisingLazyLoadingRequest.send()},e.prototype.onStart=function(){this.lastEventsTracker.start(),this.eMerchandisingLazyLoadedProductsTracker.start()},e.prototype.onStop=function(){this.lastEventsTracker.stop(),this.eMerchandisingLazyLoadedProductsTracker.stop()},e.prototype.initRequests=function(){this.initEmerchandisingPostRequest(),this.initEmerchandisingBeaconRequest(),this.initLazyLoadingPostRequest()},e.prototype.initEmerchandisingPostRequest=function(){var t=this;this.eMerchandisingRequest.afterProvidersCalled((function(){t.requestPayload.products=[]})),this.eMerchandisingRequest.setRequestPayloadProvider({getRequestPayload:function(){return csJSON.stringify(t.requestPayload)}})},e.prototype.initEmerchandisingBeaconRequest=function(){var t=this;this.eMerchandisingBeaconRequest.setRequestPayloadProvider({getRequestPayload:function(){return t.getLazyLoadingRequestPayload()}}),this.eMerchandisingBeaconRequest.after((function(){t.eMerchandisingProductsBatch.reset()}))},e.prototype.initLazyLoadingPostRequest=function(){var t=this;this.eMerchandisingLazyLoadingRequest.afterProvidersCalled((function(){t.eMerchandisingProductsBatch.reset()})),this.eMerchandisingLazyLoadingRequest.setRequestPayloadProvider({getRequestPayload:function(){return t.getLazyLoadingRequestPayload()}})},e.prototype.getLazyLoadingRequestPayload=function(){var t=this.eMerchandisingProductsBatch.getProducts();return csJSON.stringify(this.buildEmerchandisingData(t))},e.prototype.buildEmerchandisingData=function(t){return{products:t,targetUrl:this.urlService.getUrl(),windowWidth:Ue.windowWidth(),windowHeight:Ue.windowHeight()}},e.prototype.initProductsTracker=function(){var t=this;this.eMerchandisingLazyLoadedProductsTracker.init(),this.eMerchandisingLazyLoadedProductsTracker.onProductsDetection((function(e){t.eMerchandisingProductsBatch.addProducts(e),t.eMerchandisingProductsBatch.isFull()&&t.eMerchandisingLazyLoadingRequest.send()}))},e.prototype.initLastEventsTracker=function(){var t=this;this.lastEventsTracker.onEvent((function(){t.sendLastProducts()}))},e.prototype.sendLastProducts=function(){this.eMerchandisingProductsBatch.isEmpty()||this.eMerchandisingBeaconRequest.send()},e}(me),bn=function(){function t(t){this.configuration=t}return t.prototype.collectProducts=function(t){void 0===t&&(t=document);for(var e=[],r=0,i=this.getAllValidAnchors(this.configuration.hostnames,t);r<i.length;r++){var n=i[r];csArray.prototype.push.call(e,this.buildProductFromAnchor(n))}return e},t.prototype.getAllValidAnchors=function(t,e){var r=this;return void 0===e&&(e=document),csArray.prototype.filter.call(cr.findAllElements("a",e),(function(e){return r.isAnchorValid(e,t)}))},t.prototype.isAnchorValid=function(t,e){return("https:"===t.protocol||"http:"===t.protocol)&&t.offsetHeight>0&&t.offsetWidth>0&&""!==t.hostname&&K(t.hostname,e)},t.prototype.buildProductFromAnchor=function(t){return{targetPath:Ie.getElementPath(t,{dynamicIdRegex:this.configuration.dynamicIdRegex}),href:t.href}},t}(),wn=function(t){function e(e,r){var i=t.call(this,e)||this;return i.mutationObserver=r,i.mutationObserverOptions={subtree:!0,childList:!0},i}return f(e,t),e.prototype.init=function(){this.initMutationObserver()},e.prototype.start=function(){this.mutationObserver.start(),this.observeDom()},e.prototype.stop=function(){this.mutationObserver.stop()},e.prototype.flushEvents=function(){this.mutationObserver.flushPendingMutations()},e.prototype.onProductsDetection=function(t){this.productsDetectionCallback=t},e.prototype.initMutationObserver=function(){this.mutationObserver.init(),this.initMutationCallbacks()},e.prototype.initMutationCallbacks=function(){var t=this;this.mutationObserver.onChildListMutation((function(e){return t.handleChildListMutation(e)})),this.mutationObserver.onAttachShadowMutation((function(e){return t.handleAttachShadowMutation(e)}))},e.prototype.handleChildListMutation=function(t){for(var e=0;e<t.addedNodes.length;e+=1){var r=t.addedNodes[e];if(Kt(r)&&this.isAnchorValid(r,this.configuration.hostnames)){var i=this.buildProductFromAnchor(r);this.emitProductsEvent([i])}else if(at(r)){var n=this.collectProducts(r);this.emitProductsEvent(n)}}},e.prototype.handleAttachShadowMutation=function(t){var e=t.shadowRoot;this.emitProductsEvent(this.collectProducts(e)),this.mutationObserver.observe(e,this.mutationObserverOptions)},e.prototype.emitProductsEvent=function(t){t.length>0&&this.productsDetectionCallback(t)},e.prototype.observeDom=function(){this.mutationObserver.observe(document,this.mutationObserverOptions),this.observeShadowRoots(document)},e.prototype.observeShadowRoots=function(t){var e=this,r=sr.getAllShadowHosts(t);csArray.prototype.forEach.call(r,(function(t){t.shadowRoot&&e.mutationObserver.observe(t.shadowRoot,e.mutationObserverOptions)}))},e}(bn),An=function(){function t(e){void 0===e&&(e=t.DEFAULT_BATCH_SIZE),this.products=[],this.bytesCounter=new ce(e)}return t.prototype.addProducts=function(t){var e;this.bytesCounter.add(csJSON.stringify(t)),(e=csArray.prototype.push).call.apply(e,S([this.products],t))},t.prototype.reset=function(){this.bytesCounter.reset(),this.products=[]},t.prototype.isEmpty=function(){return 0===this.products.length},t.prototype.isFull=function(){return this.bytesCounter.isThresholdReached()},t.prototype.getProducts=function(){return this.products},t.DEFAULT_BATCH_SIZE=5120,t}(),kn=function(){function t(t,e,r,i,n,o,s){this.configuration=t,this.compressor=e,this.basicRequestParameters=r,this.customVariablesService=i,this.urlService=n,this.iframeEventsEmitter=o,this.commandsService=s}return t.prototype.init=function(){var t=new rr(new ur),e=new wn(this.configuration,t),r=new nn,i=this.createEMerchandisingPostRequest(this.compressor),n=this.createEMerchandisingPostRequest(this.compressor),o=this.createEMerchandisingBeaconRequest(),s=new An;this.eMerchandisingService=new Rn(this.urlService,e,r,i,n,o,s),this.eMerchandisingService.init(),this.iframeEventsEmitter.addListeners(this.eMerchandisingService)},t.prototype.onStartTracking=function(){this.eMerchandisingService.collectInitialProducts(),this.eMerchandisingService.start()},t.prototype.onArtificialPageViewEnd=function(){this.eMerchandisingService.clearState()},t.prototype.onAfterArtificialPageView=function(){this.eMerchandisingService.collectInitialProducts()},t.prototype.onBeforeSessionRenewal=function(){this.eMerchandisingService.clearState(),this.eMerchandisingService.stop()},t.prototype.onOptout=function(){this.eMerchandisingService.stop()},t.prototype.createEMerchandisingPostRequest=function(t){var e=new Bt(this.configuration.getTrackerUri(),"display");return e.setCompressionOptions(t,"base64"),e.setRequestParametersProviders(this.basicRequestParameters,this.customVariablesService,{getRequestParameters:function(){return{ct:oe.BASE64}}}),e.setRequestHeader({name:"Access-Control-Expose-Headers",value:"Content-compression"}),e.setRequestHeader({name:"Content-type",value:"text/plain; charset=UTF-8"}),e.setRequestHeader({name:"Content-compression",value:"LZString"}),e},t.prototype.createEMerchandisingBeaconRequest=function(){var t=new fr(this.configuration.getTrackerUri(),"display");return t.setRequestParametersProviders(this.basicRequestParameters,this.customVariablesService,{getRequestParameters:function(){return{ct:oe.UNCOMPRESSED}}}),t},t}();function In(t){return t.tagDeploymentMode===pn.DualCollectionReview||t.tagDeploymentMode===pn.DualCollection}!function(t){t.ContentSquare="CONTENTSQUARE",t.LoadedByClicktale="LOADED_BY_CLICKTALE",t.LoadClicktalePtc="LOAD_CLICKTALE_PTC",t.DualCollectionReview="DUAL_COLLECTION_REVIEW",t.DualCollection="DUAL_COLLECTION"}(pn||(pn={}));var Pn,Nn=function(){function t(t,e,r,i){this.configuration=t,this.visitorService=e,this.sessionService=r,this.sensitiveContentService=i}return t.prototype.init=function(){this.isClicktalePtcLoaded=!1,this.isContentSquareDataCollectionStarted=!1},t.prototype.loadClicktalePtc=function(){!this.isClicktalePtcLoaded&&this.configuration.ptcDomain&&this.configuration.ptcGuid&&this.doLoadClicktalePtc()},t.prototype.getSessionData=function(){var t=this.configuration.projectId,e=this.visitorService.getVisitor();return{projectId:t,userId:e.id,sessionNumber:e.visitsCount,pageNumber:this.sessionService.getSession().pageNumber}},t.prototype.startDataCollection=function(t){this.isContentSquareDataCollectionStarted||(this.configuration.tagDeploymentMode===pn.LoadClicktalePtc&&this.isReplayRecordedInMalka()&&this.sensitiveContentService.initCTPII(),In(this.configuration)&&(this.sensitiveContentService.initCTPII(),t(),this.isContentSquareDataCollectionStarted=!0))},t.prototype.isReplayRecordedInMalka=function(){return this.configuration.useMalkaPipeline&&this.sessionService.isReplayRecorded()},t.prototype.doLoadClicktalePtc=function(){this.isClicktalePtcLoaded=!0;var t=this.buildScriptElement();document.getElementsByTagName("head")[0].appendChild(t)},t.prototype.buildScriptElement=function(){var t=document.createElementNS("http://www.w3.org/1999/xhtml","script");return t.async=!0,t.crossOrigin="anonymous",t.type="text/javascript",this.configuration.ptcSha512&&this.configuration.ptcSnapshotPath?(t.integrity="sha512-"+this.configuration.ptcSha512,t.src="https://"+this.configuration.ptcDomain+"/"+this.configuration.ptcSnapshotPath+"/ptc.js"):t.src="https://"+this.configuration.ptcDomain+"/ptc/"+this.configuration.ptcGuid+".js",t},t}();!function(t){t.isRecording=function(){return window.ClickTaleIsRecording&&window.ClickTaleIsRecording()},t.stopRecording=function(){window.ClickTaleStop&&window.ClickTaleStop()},t.triggerLogicalPageView=function(t){window.ClickTaleLogicalWithUploadPage&&window.ClickTaleLogicalWithUploadPage(t)},t.sendPageEvent=function(t){window.ClickTaleEvent&&window.ClickTaleEvent(t)},t.sendEventTriggerRecording=function(t){window.ClickTaleEventTrigger&&window.ClickTaleEventTrigger(t)}}(Pn||(Pn={}));var On,Ln=function(){function t(t,e,r,i,n,o,s){this.configuration=t,this.visitorService=e,this.sessionService=r,this.urlService=i,this.commandsService=n,this.startDataCollectionCallback=o,this.sensitiveContentService=s}return t.prototype.init=function(){var t=this;this.clicktaleIntegrationService=new Nn(this.configuration,this.visitorService,this.sessionService,this.sensitiveContentService),this.clicktaleIntegrationService.init(),this.loadPtcForDualCollection(),this.commandsService.register(["getSessionData"],(function(){return t.clicktaleIntegrationService.getSessionData()})),this.commandsService.register(["startDataCollection"],(function(){t.clicktaleIntegrationService.startDataCollection(t.startDataCollectionCallback)}))},t.prototype.loadPtcForDualCollection=function(){In(this.configuration)&&this.clicktaleIntegrationService.loadClicktalePtc()},t.prototype.onAfterNaturalPageView=function(){this.configuration.tagDeploymentMode===pn.LoadClicktalePtc&&(!this.configuration.useMalkaPipeline&&this.sessionService.isReplayRecorded()||this.clicktaleIntegrationService.loadClicktalePtc())},t.prototype.onAfterArtificialPageView=function(){!this.sessionService.isReplayRecorded()&&Pn.isRecording()&&this.configuration.tagDeploymentMode===pn.LoadClicktalePtc&&Pn.triggerLogicalPageView(this.urlService.getUrl())},t.prototype.onAfterSessionRenewal=function(){!this.sessionService.isReplayRecorded()&&Pn.isRecording()&&Pn.triggerLogicalPageView(this.urlService.getUrl())},t.prototype.onOptout=function(){Pn.isRecording()&&Pn.stopRecording()},t}(),Mn=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;return s.configuration=e,s.pageEventRequest=r,s.compressor=i,s.customEventsEmitter=n,s.hashHelper=o,s.pageEventsQueue=[],s.etrQueue=[],s}return f(e,t),e.prototype.onStart=function(){var t=this;csArray.prototype.forEach.call(this.pageEventsQueue,(function(e){return t.trackPageEvent(e)})),this.pageEventsQueue=[],csArray.prototype.forEach.call(this.etrQueue,(function(e){return t.trackEventTriggerRecording(e)})),this.etrQueue=[]},e.prototype.onStop=function(){},e.prototype.trackPageEvent=function(t){this.isStarted?e.isValidEventName(t)&&(this.isUserIdentifierEvent(t)?this.hashHelper.isSupported()&&this.trackEventWithUserIdentifier(t):this.trackEvent(t)):csArray.prototype.push.call(this.pageEventsQueue,t)},e.prototype.isUserIdentifierEvent=function(t){return T(t,"@user-identifier@")},e.prototype.trackEventWithUserIdentifier=function(t){return m(this,void 0,void 0,(function(){var e,r;return g(this,(function(i){switch(i.label){case 0:return this.configuration.customHashIdEnabled?(e=csString.prototype.slice.call(t,"@user-identifier@".length),this.hashHelper.isValidInput(e)?[4,this.hashHelper.digest(e,this.configuration.projectId)]:(ht.warn("UserIdentifier event: invalid user identifier"),[2])):[2];case 1:return(r=i.sent())?(this.pageEventRequestParameter={eventName:r,isETR:!1,isCustomHashId:!0},this.sendPageEvent()):ht.warn("Page event: unable to compute customHashId"),this.configuration.encryptionEnabled?(this.customEventsEmitter.emitUserIdentifierEvent(e),[2]):[2]}}))}))},e.prototype.trackEvent=function(t){this.customEventsEmitter.emitPageEvent(t),this.pageEventRequestParameter={eventName:t,isETR:!1,isCustomHashId:!1},this.sendPageEvent(),this.configuration.tagDeploymentMode===pn.LoadClicktalePtc&&Pn.sendPageEvent(t)},e.prototype.trackEventTriggerRecording=function(t){this.isStarted?e.isValidEventName(t)&&(this.configuration.useMalkaPipeline&&this.configuration.malkaEtrEnabled?this.trackMalkaEventTriggerRecording(t):this.trackLegacyEventTriggerRecording(t)):csArray.prototype.push.call(this.etrQueue,t)},e.prototype.trackMalkaEventTriggerRecording=function(t){T(t,"@ETP@")?this.customEventsEmitter.emitEventTriggerRecording(t,Ct.ETR_PAGE):this.customEventsEmitter.emitEventTriggerRecording(t,Ct.ETR_SESSION),this.pageEventRequestParameter={eventName:t,isETR:!0,isCustomHashId:!1},this.sendPageEvent()},e.prototype.trackLegacyEventTriggerRecording=function(t){var e;(In(e=this.configuration)||e.tagDeploymentMode===pn.LoadClicktalePtc)&&(this.customEventsEmitter.emitEventTriggerRecording(t,Ct.ETR_LEGACY),this.pageEventRequestParameter={eventName:t,isETR:!0,isCustomHashId:!1},this.sendPageEvent(),this.configuration.tagDeploymentMode===pn.LoadClicktalePtc&&Pn.sendEventTriggerRecording(t))},e.prototype.getRequestParameters=function(){return{value:this.compressor.compressSync(this.pageEventRequestParameter.eventName),enc:this.compressor.algorithm,isETR:""+this.pageEventRequestParameter.isETR,isCustomHashId:""+this.pageEventRequestParameter.isCustomHashId}},e.prototype.sendPageEvent=function(){this.pageEventRequest.send()},e.isValidEventName=function(t){return rt(t)&&!!csString.prototype.trim.call(t)},e}(me),Dn=["trackPageEvent"],xn=["trackEventTriggerRecording"],_n=function(){function t(t,e,r,i,n){this.configuration=t,this.commandsService=e,this.compressor=r,this.basicParameters=i,this.customEventsEmitter=n}return t.prototype.init=function(){var t=this,e=new N(this.configuration.getTrackerUri(),"pageEvent"),r=new Tr(window.crypto);r.init(),this.pageEventService=new Mn(this.configuration,e,this.compressor,this.customEventsEmitter,r),e.setRequestParametersProviders(this.pageEventService,this.basicParameters),this.commandsService.register(Dn,(function(e){t.pageEventService.trackPageEvent(e)})),this.commandsService.register(xn,(function(e){t.pageEventService.trackEventTriggerRecording(e)}))},t.prototype.onStartTracking=function(){this.pageEventService.start()},t}();!function(t){t[t.Sensitive=1]="Sensitive",t[t.SensitiveChild=2]="SensitiveChild"}(On||(On={}));var Vn,qn=["value","checked","src","data","alt"],zn=["[data-cs-mask]","img[src^='data:']","script"],Un=[{selector:"input:not([type=button])",attrName:"value"}],Bn=[".ctHidden, textarea"],Hn=function(){function t(t){var e;this.configuration=t,this.sensitiveAttributeSelector=[],this.sensitiveElementSelector="",In(this.configuration)||(this.sensitiveElementSelector=this.appendSelectors(this.sensitiveElementSelector,zn),(e=csArray.prototype.push).call.apply(e,S([this.sensitiveAttributeSelector],Un)))}return t.prototype.setPIISelectors=function(t){var e,r=this;if(!In(this.configuration)&&t){if(null===(e=t.PIISelectors)||void 0===e?void 0:e.length){var i=this.sanitizeSelectors(t.PIISelectors);this.sensitiveElementSelector=this.appendSelectors(this.sensitiveElementSelector,i)}t.Attributes instanceof Array&&csArray.prototype.forEach.call(t.Attributes,(function(t){t.selector&&t.attrName&&csArray.prototype.push.call(r.sensitiveAttributeSelector,t)}))}},t.prototype.initCTPII=function(){var t,e,r=this;if(null===(e=null===(t=null===window||void 0===window?void 0:window.ClickTaleSettings)||void 0===t?void 0:t.DOM)||void 0===e?void 0:e.PII){this.sensitiveElementSelector=this.appendSelectors(this.sensitiveElementSelector,Bn);var i=this.sanitizeSelectors(window.ClickTaleSettings.DOM.PII.Text);this.sensitiveElementSelector=this.appendSelectors(this.sensitiveElementSelector,i),csArray.prototype.map.call(window.ClickTaleSettings.DOM.PII.Attributes,(function(t){t.rule&&csArray.prototype.push.call(r.sensitiveAttributeSelector,{selector:t.rule,attrName:t.attr})}))}},t.prototype.isSensitiveAttribute=function(t,e){return this.isSensitive(t)&&-1!==csArray.prototype.indexOf.call(qn,e)||this.isElementMatchingAttributes(t,e,this.sensitiveAttributeSelector)},t.prototype.isSensitive=function(t){return t.__contentsquare_sensitive===On.Sensitive},t.prototype.isSensitiveChild=function(t){return t.__contentsquare_sensitive===On.SensitiveChild},t.prototype.identifySensitiveNodes=function(t){var e=this;if(Gt(t)||Qt(t)){this.findAndMarkSensitiveNodes(t);var r=sr.getAllShadowHosts(t);csArray.prototype.forEach.call(r,(function(t){return t.shadowRoot&&e.findAndMarkSensitiveNodes(t.shadowRoot)}))}},t.prototype.unidentifySensitiveNodes=function(t){var e=this;if(Gt(t)||Qt(t)){this.findAndUnmarkSensitiveNodes(t);var r=sr.getAllShadowHosts(t);csArray.prototype.forEach.call(r,(function(t){return t.shadowRoot&&e.findAndUnmarkSensitiveNodes(t.shadowRoot)}))}},t.prototype.findAndUnmarkSensitiveNodes=function(t){for(var e,r=document.createNodeIterator(t,NodeFilter.SHOW_ELEMENT,null,!1);e=r.nextNode();)"__contentsquare_sensitive"in e&&delete e.__contentsquare_sensitive},t.prototype.findAndMarkSensitiveNodes=function(t){var e=this;if(this.hasSensitiveParent(t))return this.markAsSensitiveChild(t),void this.markSubtreeAsSensitiveChild(t);if(this.isMatchingSelectors(t,this.sensitiveElementSelector))this.markAsSensitive(t),this.markSubtreeAsSensitiveChild(t);else{var r=t.querySelectorAll(this.sensitiveElementSelector);csArray.prototype.forEach.call(r,(function(t){e.isAllowedBase64Image(t)||(e.markAsSensitive(t),e.markSubtreeAsSensitiveChild(t))}))}},t.prototype.isAllowedBase64Image=function(t){return Yt(t)&&T(t.src,"data:image/svg+xml")&&t.src.length<=1024},t.prototype.markAsSensitive=function(t){t.__contentsquare_sensitive=On.Sensitive},t.prototype.markAsSensitiveChild=function(t){t.__contentsquare_sensitive=On.SensitiveChild},t.prototype.markSubtreeAsSensitiveChild=function(t){var e=document.createNodeIterator(t,NodeFilter.SHOW_ELEMENT,null,!1),r=e.nextNode();for(t===r&&(r=e.nextNode());r;)this.markAsSensitiveChild(r),r=e.nextNode()},t.prototype.hasSensitiveParent=function(t){return!(!csNodeparentNode.apply(t)||!Gt(csNodeparentNode.apply(t))&&!Qt(csNodeparentNode.apply(t))||!this.isSensitive(csNodeparentNode.apply(t))&&!this.isSensitiveChild(csNodeparentNode.apply(t)))||Zt(t)&&(this.isSensitive(t.host)||this.isSensitiveChild(t.host))},t.prototype.isMatchingSelectors=function(t,e){return Gt(t)&&De.call(t,e)},t.prototype.isElementMatchingAttributes=function(t,e,r){return csArray.prototype.some.call(r,(function(r){return t.hasAttribute(e)&&csString.prototype.indexOf.call(r.attrName,e)>-1&&De.call(t,r.selector)}))},t.prototype.sanitizeSelectors=function(t){return csArray.prototype.filter.call(t,(function(t){return t&&rt(t)}))},t.prototype.appendSelectors=function(t,e){return 0===e.length?t:0===t.length?csArray.prototype.join.call(e,","):t+","+csArray.prototype.join.call(e,",")},t}(),Fn=function(){function t(t){this.commandsService=t}return t.prototype.init=function(){this.registerSnippetErrorCommand(t.IMPLEMENTATION_SNIPPETS_LOG_COMMAND,"implementation-snippet-"),this.registerSnippetErrorCommand(t.DYNAMIC_SNIPPETS_LOG_COMMAND,"snippet-")},t.prototype.registerSnippetErrorCommand=function(t,e){this.commandsService.register([t],(function(t,r){rt(t)&&rt(r)&&ht.error(r,""+e+t)}))},t.DYNAMIC_SNIPPETS_LOG_COMMAND="logSnippetError",t.IMPLEMENTATION_SNIPPETS_LOG_COMMAND="logImplementationSnippetError",t}(),Gn=function(){function t(t,e,r){this.configuration=t,this.iframeParentToChildrenCommunicationService=e,this.iframeEventsEmitter=r}return t.prototype.init=function(){var t=this;this.iframeParentToChildrenCommunicationService.onChildMessage((function(e,r,i,n){return t.iframeEventsEmitter.emitIframeEvent(e,r,i,n)}))},t.prototype.onStartTracking=function(){this.configuration.iframesTracking&&this.iframeParentToChildrenCommunicationService.start()},t.prototype.onOptout=function(){this.configuration.iframesTracking&&this.iframeParentToChildrenCommunicationService.stop()},t}(),jn=function(t){function e(e){var r=t.call(this)||this;return r.configuration=e,r.iframes=[],r.messageHandler={boundElement:window,type:"message",listener:function(t){return r.messagesListener(t)}},r}return f(e,t),e.prototype.onChildMessage=function(t){this.onChildMessageCallback=t},e.prototype.sendToChildren=function(t,e){var r=J.buildBaseMessage(t,Y.Parent,this.configuration.projectId);r.content=e,this.sendMessageToChildren(r)},e.prototype.onStart=function(){Ht(this.messageHandler,!1),this.discoverValidIframes()},e.prototype.onStop=function(){this.sendStopMessages(),Ft(this.messageHandler,!1)},e.prototype.discoverValidIframes=function(){this.iframes=this.getAllValidIframes(),this.sendDiscoveryMessages()},e.prototype.getAllValidIframes=function(){var t=this;return csArray.prototype.filter.call(cr.findAllElements("iframe"),(function(e){return t.isIframeValid(e)}))},e.prototype.isIframeValid=function(t){return"cs-native-frame"!==t.id&&(!t.src||K(j(t.src),this.configuration.hostnames))},e.prototype.sendMessageToChildren=function(t){csArray.prototype.forEach.call(this.iframes,(function(e){e.contentWindow&&J.sendMessage(e.contentWindow,"*",t)}))},e.prototype.sendDiscoveryMessages=function(){var t=this;csArray.prototype.forEach.call(this.iframes,(function(e,r){e.contentWindow&&J.sendMessage(e.contentWindow,"*",t.buildDiscoveryMessage(r))}))},e.prototype.sendStopMessages=function(){this.sendMessageToChildren(this.buildStopMessage())},e.prototype.buildDiscoveryMessage=function(t){return J.buildBaseMessage(X.Discovery,Y.Parent,this.configuration.projectId,t)},e.prototype.buildStopMessage=function(){return J.buildBaseMessage(X.Stop,Y.Parent,this.configuration.projectId)},e.prototype.messagesListener=function(t){if(J.isMessageValid(t,Y.Child,this.configuration.projectId,this.configuration.hostnames))if(void 0!==t.data.id||t.data.type!==X.Discovery)if(et(t.data.id)&&void 0!==this.iframes[t.data.id]||t.data.type===X.ChildLogMessage){var e=this.iframes[t.data.id],r=Ie.getElementPath(e,{dynamicIdRegex:this.configuration.dynamicIdRegex}),i=t.data.type,n=t.data.content;this.onChildMessageCallback(e,r,i,n)}else ht.error("Parent received data from unknown iframe : "+csJSON.stringify(t.data));else this.discoverValidIframes()},e}(me),Kn=function(){function t(){}return t.prototype.compute=function(t,e){var r=this.convertPixelsToDPs(e.x)-this.convertPixelsToDPs(t.x),i=this.convertPixelsToDPs(e.y)-this.convertPixelsToDPs(t.y),n=e.time-t.time;return{duration:n,distance:this.computeGestureDistance(r,i),direction:this.computeGestureDirection(r,i),velocity:this.computeGestureVelocity(r,i,n)}},t.prototype.convertPixelsToDPs=function(t){return t/window.devicePixelRatio},t.prototype.computeGestureDistance=function(t,e){return Math.round(Math.sqrt(t*t+e*e))},t.prototype.computeGestureVelocity=function(t,e,r){var i=r/1e3,n=t/i,o=e/i;return Math.round(Math.abs(n)+Math.abs(o))},t.prototype.computeGestureDirection=function(t,e){return Math.abs(t)>Math.abs(e)?t>0?hr.RIGHT:hr.LEFT:e>0?hr.DOWN:hr.UP},t}(),Wn=function(){function t(){this.metricsComputer=new Kn,this.reset()}return t.prototype.onGesture=function(t){this.onGestureCallback=t},t.prototype.isValidTouchEvent=function(t){return"touches"in t&&"changedTouches"in t},t.prototype.processActionDown=function(t){this.isValidTouchStart(t)&&(this.isGestureStart(t)&&this.reset(),csArray.prototype.push.call(this.pendingInputs,{x:t.touches[0].pageX,y:t.touches[0].pageY,time:V()}),this.target=ie(t))},t.prototype.processActionMove=function(){this.hasMove=!0},t.prototype.processActionUp=function(t){this.isValidTouchEnd(t)&&(csArray.prototype.push.call(this.pendingInputs,{x:t.changedTouches[0].pageX,y:t.changedTouches[0].pageY,time:V()}),this.isValidSingleTouchGesture()&&this.runDetection(t))},t.prototype.reset=function(){this.pendingInputs=[],this.target=null,this.hasMove=!1},t.prototype.runDetection=function(t){var e=this.metricsComputer.compute(this.pendingInputs[0],this.pendingInputs[1]),r=this.hasMove?this.computeSwipeGesture(e):this.computePressGesture(e);this.onGestureCallback(r,t)},t.prototype.computeSwipeGesture=function(t){return{type:t.velocity<100?lr.DRAG:lr.FLICK,target:this.target,velocity:t.velocity,distance:t.distance,direction:t.direction}},t.prototype.computePressGesture=function(t){return{type:t.duration<1e3?lr.TAP:lr.LONG_PRESS,target:this.target}},t.prototype.isGestureStart=function(t){return 1===t.touches.length},t.prototype.isValidSingleTouchGesture=function(){return 2===this.pendingInputs.length},t.prototype.isValidTouchStart=function(t){return t.touches.length>0},t.prototype.isValidTouchEnd=function(t){return t.changedTouches.length>0},t}(),Yn=function(){function t(){this.subscriptions={}}return t.prototype.subscribe=function(t,e){this.subscriptions[t]=e,1===Object.keys(this.subscriptions).length&&this.onStartTracking()},t.prototype.unsubscribe=function(t){delete this.subscriptions[t],0===Object.keys(this.subscriptions).length&&this.onStopTracking()},t}(),Xn=function(t){function e(e){var r=t.call(this)||this;return r.logger=e,r.eventHandlers=[{boundElement:document,type:"touchstart",listener:function(t){return r.processEvent(t)}},{boundElement:document,type:"touchmove",listener:function(t){return r.processEvent(t)}},{boundElement:document,type:"touchend",listener:function(t){return r.processEvent(t)}}],r.detector=new Wn,r.detector.onGesture((function(t,e){return r.processGesture(t,e)})),r}return f(e,t),e.prototype.processGesture=function(t,e){for(var r in this.subscriptions){(0,this.subscriptions[r])(t,e)}},e.prototype.onStartTracking=function(){this.canDetectGesture()&&csArray.prototype.forEach.call(this.eventHandlers,(function(t){return Ht(t)}))},e.prototype.onStopTracking=function(){this.canDetectGesture()&&csArray.prototype.forEach.call(this.eventHandlers,(function(t){return Ft(t)}))},e.prototype.canDetectGesture=function(){return void 0!==window.devicePixelRatio},e.prototype.processEvent=function(t){var e=this;this.logger.tryToExecute("process gesture event",(function(){if(e.detector.isValidTouchEvent(t))switch(t.type){case"touchstart":e.detector.processActionDown(t);break;case"touchmove":e.detector.processActionMove();break;case"touchend":e.detector.processActionUp(t)}}))()},e.isSwipe=function(t){return t.type===lr.FLICK||t.type===lr.DRAG},e}(Yn),Jn=function(){function t(t,e,r,i,n,o,s,a,c,u,p,l,h,d,f,y,v,m,g,S,E,C,T){var R=this;this.basicRequestParameters=t,this.compressor=e,this.visitorService=r,this.sessionService=i,this.lifeCycleEventsEmitter=n,this.commandsService=o,this.commandsModule=s,this.configuration=a,this.optoutModule=c,this.optoutService=u,this.consentModule=p,this.consentService=l,this.pii=h,this.urlService=d,this.projectConfigurationModule=f,this.customEventsEmitter=y,this.javaScriptErrorsTracker=v,this.javaScriptErrorsAnonymizer=m,this.apiErrorsTracker=g,this.apiErrorsAnonymizer=S,this.iframeEventsEmitter=E,this.customVariablesService=C,this.customVariablesModule=T,this.startDataCollection=function(){R.pageViewModule.start(),R.loadTracker.start()}}return t.prototype.start=function(){var t=this;if(this.optoutModule.init(),this.optoutService.init(),!this.optoutService.isActive()){var e=new Tn(this.sessionService),r=new vn(Ie,this.configuration),i=new mn(r),n=new Xn(ht),o=new sn(this.configuration,this.visitorService,this.sessionService,r,i,this.commandsService,e,n,this.iframeEventsEmitter,this.compressor),s=new ri(this.commandsService,this.sessionService,this.configuration,this.basicRequestParameters,this.compressor,this.pii),a=new jn(this.configuration),c=new Gn(this.configuration,a,this.iframeEventsEmitter);c.init();var u=new Yr(this.visitorService,this.sessionService,this.commandsService,this.iframeEventsEmitter,a,this.configuration),p=new hi(this.configuration,this.visitorService,this.sessionService,this.commandsService,this.pii,e,this.urlService);this.pageViewModule=new yn(this.configuration,this.commandsService,this.lifeCycleEventsEmitter,this.visitorService,this.sessionService,this.consentService,this.customVariablesService,this.pii,this.urlService);var l=new Cn(this.visitorService,this.sessionService,this.commandsService),h=new Hn(this.configuration),d=new Ln(this.configuration,this.visitorService,this.sessionService,this.urlService,this.commandsService,this.startDataCollection,h),f=new _n(this.configuration,this.commandsService,this.compressor,this.basicRequestParameters,this.customEventsEmitter),y=new Fn(this.commandsService);if(this.loadTracker=new gn,this.consentModule.init(),u.init(),s.init(),p.init(),this.customVariablesModule.init(),this.pageViewModule.init(),l.init(),d.init(),f.init(),this.projectConfigurationModule.init(),y.init(),this.lifeCycleEventsEmitter.addListeners(l,this.commandsModule,o,this.consentModule,u,this.customVariablesModule,this.pageViewModule,d,f,s,c),Br.isSupported()&&this.compressor.isSupported()){var v=new Br(this.sessionService,this.configuration,this.compressor,i,this.consentService,this.basicRequestParameters,this.commandsService,this.pii,e,this.urlService,h,this.javaScriptErrorsTracker,this.javaScriptErrorsAnonymizer,this.apiErrorsTracker,n,this.apiErrorsAnonymizer,this.lifeCycleEventsEmitter,this.customEventsEmitter);v.init(),this.lifeCycleEventsEmitter.addListeners(v)}if(this.configuration.eMerchandisingEnabled){var m=new kn(this.configuration,this.compressor,this.basicRequestParameters,this.customVariablesService,this.urlService,this.iframeEventsEmitter,this.commandsService);m.init(),this.lifeCycleEventsEmitter.addListeners(m)}o.init(),e.onSessionExpired((function(){t.lifeCycleEventsEmitter.emitBeforeSessionRenewal(),t.doStart(!0),t.lifeCycleEventsEmitter.emitAfterSessionRenewal()})),this.doStart()}},t.prototype.doStart=function(t){var e=this;void 0===t&&(t=!1),this.commandsService.start(),this.loadTracker.onLoad((function(){e.lifeCycleEventsEmitter.emitStartTracking(t)})),In(this.configuration)&&!t||this.startDataCollection()},t}(),Qn=function(){function t(t,e,r,i,n,o,s,a){this.configuration=t,this.visitorService=e,this.exclusionService=r,this.outdatedState=i,this.allowSubdomainsChange=n,this.crossDomainService=o,this.crossDomainSingleIframeService=s,this.forceInclusionService=a}return t.prototype.compute=function(t){var e=this;this.configuration.crossDomainTracking&&!this.configuration.cookielessTrackingEnabled?this.configuration.crossDomainSingleIframeTracking?this.crossDomainSingleIframeService.start((function(){return e.computeState(t)})):this.crossDomainService.applyUpToDate((function(){return e.computeState(t)})):this.computeState(t)},t.prototype.computeState=function(t){this.allowSubdomainsChange.handle(),this.outdatedState.clear(),this.isIncluded()?(this.outdatedState.restoreClearedVisitor(),t(!0)):(this.exclusionService.exclude(this.configuration),t(!1))},t.prototype.isIncluded=function(){var t=A.boolean(this.configuration.sampleRate);return this.forceInclusionService.isForceIncluded()||!this.exclusionService.isExcluded()&&this.visitorService.doesVisitorExist()||!this.exclusionService.isExcluded()&&t},t}();!function(t){t.generate=function(){var t=navigator.userAgent+navigator.language+navigator.platform,e=csString.prototype.slice.call(function(t){for(var e=0,r=0;r<t.length;r+=1)e=csString.prototype.charCodeAt.call(t,r)+(e<<6)+(e<<16)-e;return Math.abs(e)}(t).toString(16),-4),r=(new csDate).getTime(),i=csString.prototype.replace.call("xxxxxxxx-hhhh-axxx-yxxx-xxxxxxxxxxxx",/[xy]/g,(function(t){var e=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===t?e:7&e|8).toString(16)}));return csString.prototype.replace.call(i,"hhhh",e)}}(Vn||(Vn={}));var Zn,$n=function(){function t(t,e,r){this.configuration=t,this.storage=e,this.sessionService=r}return t.prototype.createOrUpdateVisitor=function(){var t=this.getVisitor();null===t&&(t=this.createVisitor(),this.sessionService.removeSession()),this.updateVisitor(t),this.setVisitor(t)},t.prototype.createVisitor=function(){return{id:Vn.generate(),visitsCount:0,appliedTrackingDraw:this.configuration.lastTrackingDraw,creationTimestamp:q(),lastVisitTimestamp:0,hitTimestamp:0,expires:V()+this.configuration.visitorCookieTimeout}},t.prototype.updateVisitor=function(t){var e=q();this.sessionService.doesSessionExist()||(t.visitsCount+=1,t.lastVisitTimestamp=e),t.hitTimestamp=e,t.appliedTrackingDraw=this.configuration.lastTrackingDraw},t.prototype.getRequestParameters=function(){var t=this.getVisitor();return t?{uu:t.id,sn:""+t.visitsCount,lv:""+t.lastVisitTimestamp,lhd:""+t.lastVisitTimestamp,hd:""+t.hitTimestamp}:{}},t.prototype.getVisitor=function(){return this.storage.get()},t.prototype.setVisitor=function(t){this.storage.set(t)},t.prototype.doesVisitorExist=function(){return null!==this.storage.get()},t.prototype.removeVisitor=function(){this.storage.remove()},t.prototype.handleSubdomainChange=function(){this.storage.handleSubdomainChange()},t}(),to=function(){function t(t,e){this.configuration=t,this.compressor=e}return t.prototype.isCompressionSupported=function(){return this.compressor.isSupported()},t}(),eo=function(t){function e(e,r,i,n){var o=t.call(this,e,r)||this;return o.configuration=e,o.compressor=r,o.forceInclusionService=i,o.urlService=n,o}return f(e,t),e.prototype.sanitizeSessionRecordingState=function(t){return t},e.prototype.computeInitialRecordingState=function(t){return this.isCompressionSupported()&&(this.forceInclusionService.isForceLegacyReplayRecorded()||A.percentage()<this.configuration.replayRecordingRate&&Br.isSupported())?gt.REPLAY_RECORDING_ENABLED:gt.REPLAY_RECORDING_DISABLED},e.prototype.updateRecordingState=function(t){return t.recordingState},e.prototype.isReplayRecorded=function(t){return t.recordingState===gt.REPLAY_RECORDING_ENABLED||this.computeTriggerSessionReplayStatus(t)},e.prototype.computeTriggerSessionReplayStatus=function(t){if(this.configuration.triggerSessionReplayEnabled&&this.configuration.triggerSessionReplayRegex&&t.recordingState!==gt.REPLAY_RECORDING_ENABLED){var e=this.urlService.getUrl();return this.configuration.triggerSessionReplayRegex.test(e)}return!1},e.prototype.getDisabledRecordingState=function(){return gt.REPLAY_RECORDING_DISABLED},e.prototype.setVisitorService=function(t){},e}(to),ro=function(t){function e(e,r,i,n,o,s){var a=t.call(this,e,r)||this;return a.configuration=e,a.compressor=r,a.quotaServiceRequest=i,a.lifeCycleEventsEmitter=n,a.forceInclusionService=o,a.urlService=s,a.requestedRecordingTypes=[],a}return f(e,t),e.prototype.init=function(){this.bindQuotaServiceRequest()},e.prototype.sanitizeSessionRecordingState=function(t){return t.recordingState===St.TEMPORARILY_RECORDED&&(t.recordingState=St.NOT_RECORDED),t},e.prototype.computeInitialRecordingState=function(t){return this.isCompressionSupported()&&Br.isSupported()?(this.requestedRecordingTypes=[],A.percentage()<this.configuration.replayRecordingRate||this.forceInclusionService.isForceMalkaReplayRecorded()?csArray.prototype.push.call(this.requestedRecordingTypes,St.GLOBAL_SAMPLING):this.configuration.malkaUrlEnabled&&csArray.prototype.push.call(this.requestedRecordingTypes,St.URL_SAMPLING),this.configuration.malkaEtrEnabled&&csArray.prototype.push.call(this.requestedRecordingTypes,St.ETR_SAMPLING),this.requestedRecordingTypes.length>0?(this.sendSamplingRequest(t),St.TEMPORARILY_RECORDED):St.NOT_RECORDED):St.NOT_RECORDED},e.prototype.updateRecordingState=function(t){return this.isCompressionSupported()&&Br.isSupported()?t.recordingState===St.GLOBAL_SAMPLING?St.GLOBAL_SAMPLING:(this.requestedRecordingTypes=[],this.configuration.malkaUrlEnabled&&(csArray.prototype.push.call(this.requestedRecordingTypes,St.URL_SAMPLING),this.configuration.malkaEtrEnabled&&csArray.prototype.push.call(this.requestedRecordingTypes,St.ETR_SAMPLING)),this.requestedRecordingTypes.length>0?(this.sendSamplingRequest(t),St.TEMPORARILY_RECORDED):St.NOT_RECORDED):St.NOT_RECORDED},e.prototype.sendSamplingRequest=function(t){var e,r=this,i=null===(e=this.visitorService)||void 0===e?void 0:e.getVisitor();this.quotaServiceRequest.setRequestPayloadProvider({getRequestPayload:function(){return csJSON.stringify({recordingTypes:csArray.prototype.map.call(r.requestedRecordingTypes,Number),url:r.urlService.getUrl(),projectId:r.configuration.projectId,uu:(null==i?void 0:i.id)||"",sn:(null==i?void 0:i.visitsCount)||"",pn:(null==t?void 0:t.pageNumber)||""})}}),this.quotaServiceRequest.send()},e.prototype.abortQuotaServiceRequest=function(){this.quotaServiceRequest.abort()},e.prototype.isReplayRecorded=function(t){return t.recordingState===St.TEMPORARILY_RECORDED||t.recordingState===St.GLOBAL_SAMPLING||t.recordingState===St.URL_SAMPLING||t.etrState===Et.ETR_ON},e.prototype.bindQuotaServiceRequest=function(){var t=this;this.quotaServiceRequest.setRequestHeader({name:"Content-Type",value:"application/json"}),this.quotaServiceRequest.onError((function(){return t.quotaServiceErrorHandler("NetworkError")})),this.quotaServiceRequest.onTimeout(3e3,(function(){return t.quotaServiceTimeoutHandler()})),this.quotaServiceRequest.onLoad((function(e){return t.quotaServiceLoadHandler(e)}))},e.prototype.quotaServiceErrorHandler=function(t){this.emitRecordingStateOnError(),ht.warn("Quota Service: request error - "+t)},e.prototype.quotaServiceTimeoutHandler=function(){this.emitRecordingStateOnError(),ht.warn("Quota Service: request timeout")},e.prototype.emitRecordingStateOnError=function(){var t=St.NOT_RECORDED;this.isGlobalSamplingAllowed(this.requestedRecordingTypes)&&(t=St.GLOBAL_SAMPLING),this.lifeCycleEventsEmitter.emitRecordingStateChange(t,Et.ETR_OFF)},e.prototype.quotaServiceLoadHandler=function(t){if(200===t.status){var e;try{e=csJSON.parse(t.responseText)}catch(e){return void this.quotaServiceErrorHandler("Unable to parse the quota service response: "+t.responseText)}var r=csArray.prototype.map.call(e.allowedRecordingTypes,csString);if(r){var i=Et.ETR_OFF,n=St.NOT_RECORDED;this.isGlobalSamplingAllowed(r)?n=St.GLOBAL_SAMPLING:this.isUrlSamplingAllowed(r)&&(n=St.URL_SAMPLING),this.isEtrSamplingAllowed(r)&&(i=Et.ETR_ON),this.lifeCycleEventsEmitter.emitRecordingStateChange(n,i)}else this.quotaServiceErrorHandler("recording types missing from quota service response")}else this.quotaServiceErrorHandler("Status code: "+t.status)},e.prototype.isGlobalSamplingAllowed=function(t){return csArray.prototype.some.call(t,(function(t){return t===St.GLOBAL_SAMPLING}))},e.prototype.isUrlSamplingAllowed=function(t){return csArray.prototype.some.call(t,(function(t){return t===St.URL_SAMPLING}))},e.prototype.isEtrSamplingAllowed=function(t){return csArray.prototype.some.call(t,(function(t){return t===St.ETR_SAMPLING}))},e.prototype.setVisitorService=function(t){this.visitorService=t},e.prototype.getDisabledRecordingState=function(){return St.NOT_RECORDED},v([dt("Quota Service: onerror")],e.prototype,"quotaServiceErrorHandler",null),v([dt("Quota Service: ontimeout")],e.prototype,"quotaServiceTimeoutHandler",null),v([dt("Quota Service: onload")],e.prototype,"quotaServiceLoadHandler",null),e}(to),io=function(){function t(t,e){this.sessionStorage=t,this.recordingStateStrategy=e,this.triggerSessionReplayOngoing=!1,this.extendedSessionTimeoutId=null,this.sessionExtensionCount=0}return t.prototype.setDynamicVariablesService=function(t){this.dynamicVariablesService=t},t.prototype.createOrUpdateSession=function(){this.stopSessionExtension(),this.beginSession=V(),this.sessionExtensionCount=0;var t=this.getSessionWithoutCache();null===t?(t=this.buildSessionObject(),this.incrementSessionPageNumber(t),t.recordingState=this.recordingStateStrategy.computeInitialRecordingState(t)):(t=this.recordingStateStrategy.sanitizeSessionRecordingState(t),this.incrementSessionPageNumber(t),t.recordingState=this.recordingStateStrategy.updateRecordingState(t)),this.setSession(t),this.setTriggerSessionReplayStatus(t)},t.prototype.buildSessionObject=function(){return{pageNumber:0,recordingState:this.recordingStateStrategy.getDisabledRecordingState(),etrState:Et.ETR_OFF}},t.prototype.setTriggerSessionReplayStatus=function(t){this.recordingStateStrategy instanceof eo?this.triggerSessionReplayOngoing=this.recordingStateStrategy.computeTriggerSessionReplayStatus(t):this.triggerSessionReplayOngoing=!1},t.prototype.createExtendedSession=function(){var t=this.buildSessionObject();return this.incrementSessionPageNumber(t),t.recordingState=this.recordingStateStrategy.computeInitialRecordingState(t),this.setTriggerSessionReplayStatus(t),t},t.prototype.incrementSessionPageNumber=function(t){t.pageNumber+=1},t.prototype.isReplayRecorded=function(){var t=this.getSession();return!!t&&this.recordingStateStrategy.isReplayRecorded(t)},t.prototype.isTemporarilyRecorded=function(){var t=this.getSession();return(null==t?void 0:t.recordingState)===St.TEMPORARILY_RECORDED},t.prototype.abortQuotaServiceRequest=function(){this.recordingStateStrategy instanceof ro&&this.recordingStateStrategy.abortQuotaServiceRequest()},t.prototype.getRequestParameters=function(){var t={},e=this.getSession();return null!==e&&(t.pn=""+e.pageNumber,this.recordingStateStrategy instanceof eo&&(t.re=this.triggerSessionReplayOngoing?gt.TRIGGER_REPLAY_RECORDING_ENABLED:e.recordingState)),t},t.prototype.getSession=function(){return this.sessionStorage.get()},t.prototype.getSessionWithoutCache=function(){return this.sessionStorage.get(!0)},t.prototype.doesSessionExist=function(){return null!==this.sessionStorage.get()},t.prototype.setSession=function(t){this.sessionStorage.set(t)},t.prototype.removeSession=function(){this.sessionStorage.remove()},t.prototype.getRecordingStates=function(){var t=this.getSession(),e=[];return t&&(t.recordingState!==St.NOT_RECORDED&&csArray.prototype.push.call(e,t.recordingState),t.etrState===Et.ETR_ON&&csArray.prototype.push.call(e,St.ETR_SAMPLING)),e},t.prototype.updateRecordingState=function(t,e){var r=this.getSession();null!==r&&(r.recordingState=t,r.etrState=e,this.setSession(r))},t.prototype.hasValidSession=function(){var t=this.sessionStorage.getRawSession();return this.sessionStorage.isValid(t)},t.prototype.handleSubdomainChange=function(){this.sessionStorage.handleSubdomainChange()},t.prototype.extendSessionPeriodically=function(){this.extendedSessionTimeoutId||this.extendSession()},t.prototype.extendSession=function(){if(this.hasReachedMaxDuration())this.stopSessionExtension();else{var t=this.getSession();null===t&&(t=this.createExtendedSession()),this.sessionStorage.set(t,174e4),this.sendDynamicVar(),this.scheduleNextSessionUpdate()}},t.prototype.scheduleNextSessionUpdate=function(){var t=this;this.extendedSessionTimeoutId=window.setTimeout((function(){t.extendSession()}),174e4)},t.prototype.hasReachedMaxDuration=function(){return 1434e4-(V()+18e5-this.beginSession)<0},t.prototype.stopSessionExtension=function(){this.extendedSessionTimeoutId&&(window.clearTimeout(this.extendedSessionTimeoutId),this.extendedSessionTimeoutId=null)},t.prototype.sendDynamicVar=function(){this.sessionExtensionCount+=1,this.dynamicVariablesService.trackDynamicVariable("session_expiry_update",this.sessionExtensionCount)},t}(),no=function(){function t(t,e,r){this.configuration=t,this.visitorService=e,this.exclusionService=r}return t.prototype.clear=function(){this.isVisitorOutdated()&&(this.savedVisitor=this.visitorService.getVisitor(),this.visitorService.removeVisitor()),this.isExclusionOutdated()&&this.exclusionService.removeExclusion()},t.prototype.isVisitorOutdated=function(){return this.visitorService.doesVisitorExist()&&this.visitorService.getVisitor().appliedTrackingDraw!==this.configuration.lastTrackingDraw},t.prototype.isExclusionOutdated=function(){return this.exclusionService.getAppliedTrackingDraw()!==this.configuration.lastTrackingDraw},t.prototype.restoreClearedVisitor=function(){this.savedVisitor&&this.visitorService.setVisitor(this.savedVisitor)},t}(),oo=function(){function t(t,e){this.visitorService=t,this.sessionService=e}return t.prototype.handle=function(){this.handleVisitor(),this.handleSession()},t.prototype.handleVisitor=function(){this.visitorService.handleSubdomainChange()},t.prototype.handleSession=function(){this.sessionService.handleSubdomainChange()},t}(),so=function(){function t(){this.listeners=[]}return t.prototype.addListeners=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=csArray.prototype.push).call.apply(t,S([this.listeners],e))},t}(),ao=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.emitBeforeNaturalPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onBeforeNaturalPageView&&r.onBeforeNaturalPageView()}},e.prototype.emitAfterNaturalPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onAfterNaturalPageView&&r.onAfterNaturalPageView()}},e.prototype.emitInitTracking=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onInitTracking&&r.onInitTracking()}},e.prototype.emitStartTracking=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onStartTracking&&i.onStartTracking(t)}},e.prototype.emitArtificialPageViewEnd=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onArtificialPageViewEnd&&r.onArtificialPageViewEnd()}},e.prototype.emitBeforeArtificialPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onBeforeArtificialPageView&&r.onBeforeArtificialPageView()}},e.prototype.emitAfterArtificialPageView=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onAfterArtificialPageView&&r.onAfterArtificialPageView()}},e.prototype.emitBeforeSessionRenewal=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onBeforeSessionRenewal&&r.onBeforeSessionRenewal()}},e.prototype.emitAfterSessionRenewal=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onAfterSessionRenewal&&r.onAfterSessionRenewal()}},e.prototype.emitOptout=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onOptout&&r.onOptout()}},e.prototype.emitConsentGranted=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onConsentGranted&&r.onConsentGranted()}},e.prototype.emitConsentWithdrawn=function(){for(var t=0,e=this.listeners;t<e.length;t++){var r=e[t];r.onConsentWithdrawn&&r.onConsentWithdrawn()}},e.prototype.emitRecordingStateChange=function(t,e){for(var r=0,i=this.listeners;r<i.length;r++){var n=i[r];n.onRecordingStateChange&&n.onRecordingStateChange(t,e)}},e.prototype.emitInitialDomDone=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onInitialDomDone&&i.onInitialDomDone(t)}},e}(so);!function(t){t[t.NOT_REQUIRED=0]="NOT_REQUIRED",t[t.NOT_EXPRESSED=1]="NOT_EXPRESSED",t[t.GRANTED=2]="GRANTED",t[t.WITHDRAWN=3]="WITHDRAWN"}(Zn||(Zn={}));var co,uo=function(){function t(t,e,r){this.configuration=t,this.cookieService=e,this.browserLocalStorage=r}return t.prototype.get=function(){var t;return null===(t=this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.getItem("_cs_c"):this.cookieService.get("_cs_c"))?t:Number(t)},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.setItem("_cs_c",csString(t)):this.cookieService.set("_cs_c",csString(t),34164e6)},t.prototype.remove=function(){this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.removeItem("_cs_c"):this.cookieService.delete("_cs_c")},t.prototype.handleSubdomainChange=function(){this.configuration.cookielessTrackingEnabled||(this.configuration.allowSubdomains?this.cookieService.delete("_cs_c",ft.CURRENT_DOMAIN):this.cookieService.delete("_cs_c",this.cookieService.getRootDomain()))},t}(),po=["trackConsentGranted"],lo=["trackConsentWithdrawn"],ho=function(){function t(t,e){this.commandsService=t,this.service=e}return t.prototype.init=function(){this.service.handleSubdomainChange(),this.service.setInitialConsent(),this.registerCommands()},t.prototype.registerCommands=function(){var t=this;this.commandsService.register(po,(function(){t.service.grantConsent()})),this.commandsService.register(lo,(function(){t.service.withdrawConsent()}))},t.prototype.onOptout=function(){this.service.removeConsent()},t}(),fo=function(){function t(t,e,r){this.configuration=t,this.storage=e,this.lifeCycleEventsEmitter=r}return t.prototype.setInitialConsent=function(){var t=this.storage.get();(null===t||this.hasConsentRequiredChanged(t))&&this.setDefault()},t.prototype.hasConsentRequiredChanged=function(t){var e=this.configuration.consentRequired;return e&&t===Zn.NOT_REQUIRED||!e&&t!==Zn.NOT_REQUIRED},t.prototype.handleSubdomainChange=function(){this.storage.handleSubdomainChange()},t.prototype.setDefault=function(){var t=this.configuration.consentRequired?Zn.NOT_EXPRESSED:Zn.NOT_REQUIRED;this.storage.set(t)},t.prototype.grantConsent=function(){this.configuration.consentRequired&&(this.storage.set(Zn.GRANTED),this.lifeCycleEventsEmitter.emitConsentGranted())},t.prototype.withdrawConsent=function(){this.configuration.consentRequired&&(this.storage.set(Zn.WITHDRAWN),this.lifeCycleEventsEmitter.emitConsentWithdrawn())},t.prototype.removeConsent=function(){this.storage.remove()},t.prototype.isAllowedByConsent=function(){return!this.configuration.consentRequired||this.storage.get()===Zn.GRANTED},t.prototype.getRequestParameters=function(){return{uc:""+this.storage.get()}},t}(),yo=function(){function t(t,e,r,i,n,o,s){this.lifeCycleEventsEmitter=t,this.commandsService=e,this.commandsModule=r,this.optoutModule=i,this.optoutService=n,this.exclusionModule=o,this.consentModule=s}return t.prototype.start=function(){this.lifeCycleEventsEmitter.addListeners(this.exclusionModule,this.consentModule,this.commandsModule),this.consentModule.init(),this.optoutModule.init(),this.optoutService.init(),this.optoutService.isActive()||this.commandsService.start()},t}(),vo=function(){function t(t,e){this.location=t,this.storage=e}return t.prototype.exclude=function(t){this.storage.set(csString(t.lastTrackingDraw))},t.prototype.removeExclusion=function(){this.storage.remove()},t.prototype.isExcluded=function(){return this.hasExclusionInStorage()||this.hasExclusionInURL()},t.prototype.hasExclusionInStorage=function(){return 0!==this.getAppliedTrackingDraw()},t.prototype.getAppliedTrackingDraw=function(){return this.storage.get()},t.prototype.hasExclusionInURL=function(){return csString.prototype.indexOf.call(this.location.href,"_cs_ex")>0},t}(),mo=function(){function t(t){this.service=t}return t.prototype.onOptout=function(){this.service.removeExclusion()},t}(),go=function(){function t(t,e){this.location=t,this.cookieService=e}return t.prototype.isForceIncluded=function(){return this.hasForceInclusionCookie()||this.hasForceInclusionInURL()},t.prototype.isForceLegacyReplayRecorded=function(){return this.hasForceInclusionCookieValue(gt.REPLAY_RECORDING_ENABLED)||this.hasForceInclusionValueInURL(gt.REPLAY_RECORDING_ENABLED)},t.prototype.isForceMalkaReplayRecorded=function(){return this.hasForceInclusionCookieValue(St.GLOBAL_SAMPLING)},t.prototype.hasForceInclusionCookie=function(){return null!==this.cookieService.get("_cs_inc")},t.prototype.hasForceInclusionCookieValue=function(t){return this.cookieService.get("_cs_inc")===t},t.prototype.hasForceInclusionInURL=function(){return csString.prototype.indexOf.call(this.location.href,"_cs_inc")>0},t.prototype.hasForceInclusionValueInURL=function(t){return csString.prototype.indexOf.call(this.location.href,"_cs_inc="+t)>0},t}(),So=function(){function t(){this.metrics={}}return t.prototype.start=function(t,e){void 0===e&&(e=V());var r=this.metrics[t];this.metrics[t]=r&&r.startedAt?r:y(y({},r),{startedAt:e})},t.prototype.stop=function(t,e){void 0===e&&(e=V());var r=this.metrics[t];this.metrics[t]=r&&r.stoppedAt?r:y(y({},r),{stoppedAt:e}),this.onStopCallback(t,this.metrics[t])},t.prototype.onStop=function(t){this.onStopCallback=t},t}(),Eo=function(){function t(){}return t.prototype.getRequestParameters=function(){var t=window.location;return{pr:t.protocol,ho:t.hostname,pa:t.pathname,qu:t.search,ha:t.hash}},t}(),Co=function(){function t(t,e){this.configuration=t,this.request=e,this.isLoggingActive=!1}return t.prototype.init=function(){this.isLoggingActive=A.boolean(this.configuration.metricRate)},t.prototype.getRequestParameters=function(){return{a:"uxam",mk:this.metricKey,mv:""+this.metricValue}},t.prototype.logMetric=function(t,e){this.metricKey=t,this.metricValue=e.stoppedAt-e.startedAt,this.sendLog()},t.prototype.sendLog=function(){this.isLoggingActive&&this.request.send()},t}();!function(t){t.TIME_BEFORE_EXECUTION="TimeBeforeExecution",t.PAGE_LOAD="PageLoad"}(co||(co={}));var To,Ro=function(){function t(t,e,r){this.service=e,this.pii=r,this.locationRequestParameters=new Eo,this.basicLogRequestParameters=new B(t,this.pii),this.request=new N(t.getLoggerUri()),this.logger=new Co(t,this.request)}return t.prototype.init=function(){var t=this;this.request.setRequestParametersProviders(this.basicLogRequestParameters,this.locationRequestParameters),this.logger.init(),this.service.onStop((function(e,r){t.logger.logMetric(e,r)})),this.recordInitialMetrics()},t.prototype.recordInitialMetrics=function(){this.isSupported()&&(this.service.start(co.PAGE_LOAD,window.performance.timing.navigationStart),this.service.stop(co.PAGE_LOAD,window.performance.timing.domContentLoadedEventEnd),this.service.start(co.TIME_BEFORE_EXECUTION,window.performance.timing.domContentLoadedEventEnd),this.service.stop(co.TIME_BEFORE_EXECUTION))},t.prototype.isSupported=function(){return window.performance&&window.performance.timing},t}(),bo=function(){function t(t,e,r){this.configuration=t,this.cookieService=e,this.browserLocalStorage=r}return t.prototype.get=function(){return this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.getItem("_cs_optout"):this.cookieService.get("_cs_optout")},t.prototype.set=function(t){this.configuration.cookielessTrackingEnabled?this.browserLocalStorage.setItem("_cs_optout",t):this.cookieService.set("_cs_optout",t,34164e6)},t}(),wo=function(){function t(t,e,r){this.lifeCycleEventsEmitter=t,this.location=e,this.storage=r}return t.prototype.init=function(){!this.isActive()&&this.hasOptoutInURL()&&this.activate()},t.prototype.isActive=function(){return"1"===this.storage.get()},t.prototype.activate=function(){this.lifeCycleEventsEmitter.emitOptout(),this.storage.set("1")},t.prototype.hasOptoutInURL=function(){return csString.prototype.indexOf.call(this.location.href,"_cs_optout")>0},t}(),Ao=["optout"],ko=function(){function t(t,e){this.commandsService=t,this.optoutService=e}return t.prototype.init=function(){var t=this;this.commandsService.register(Ao,(function(){t.optoutService.activate()}))},t}();function Io(t,e){return e.visitor.visitsCount!==t.visitor.visitsCount?e.visitor.visitsCount-t.visitor.visitsCount:t.session?e.session?e.session.pageNumber-t.session.pageNumber:-1:1}!function(t){t.select=function(t,e){var r=function(t,e){return csArray.prototype.filter.call(t,(function(t){return t.exclusion===e}))[0]}(t,e),i=function(t,e){return csArray.prototype.sort.call(csArray.prototype.filter.call(t,(function(t){return function(t,e){return t.visitor&&t.visitor.appliedTrackingDraw===e}(t,e)})),Io)[0]}(t,e);return r||i}}(To||(To={}));var Po=function(){function t(t,e,r){this.configuration=t,this.currentDomainState=e,this.otherDomainStates=r}return t.prototype.applyUpToDate=function(t){var e=this;this.otherDomainStates.retrieve(this.configuration.hostnames,(function(r){var i=S([e.currentDomainState.get()],r),n=To.select(i,e.configuration.lastTrackingDraw);e.currentDomainState.apply(n),t()}))},t}(),No=function(){function t(t,e){this.commandsService=t,this.iframeEventsEmitter=e}return t.prototype.init=function(){this.iframeEventsEmitter.addListeners(this.commandsService)},t.prototype.onOptout=function(){this.commandsService.stop()},t.prototype.onBeforeSessionRenewal=function(){this.commandsService.stop()},t}();var Oo,Lo=function(t){function e(){var e=t.call(this)||this;return e.registry={},e}return f(e,t),e.prototype.register=function(t,e){for(var r=0,i=t;r<i.length;r++){var n=i[r];this.registry[n]=e,this.registry}},e.prototype.onStart=function(){this.applyPending(),this.enableImmediateApplication()},e.prototype.onStop=function(){window._uxa=[]},e.prototype.onIframeCommands=function(t){for(var e=0,r=t.commands;e<r.length;e++){var i=r[e];this.applyFromIframe(i.name,i.params,t.iframePath)}},e.prototype.applyFromIframe=function(t,e,r){var i=this;ht.tryToExecute("Commands.apply.from.iframe: "+r,(function(){var r;if(i.registry[t])return(r=i.registry)[t].apply(r,e)}))()},e.prototype.applyPending=function(){var t=this;window._uxa.forEach((function(e){var r=e[0],i=e.slice(1);return t.apply(r,i)}))},e.prototype.enableImmediateApplication=function(){var t=this;window._uxa={push:function(e){var r=e[0],i=e.slice(1);return t.apply(r,i)}}},e.prototype.apply=function(t,e){var r;if(this.registry[t])return(r=this.registry)[t].apply(r,e)},v([dt("Commands.apply")],e.prototype,"apply",null),e}(me),Mo=function(){function t(){var t=this;this.eventHandler={boundElement:document,type:"securitypolicyviolation",listener:function(e){return t.securityPolicyViolationListener(e)}}}return t.prototype.onEvent=function(t){this.onEventCallback=t},t.prototype.start=function(){Ht(this.eventHandler)},t.prototype.stop=function(){Ft(this.eventHandler)},t.prototype.isSecurityErrorRelevant=function(e){if(!e)return!1;var r=e.disposition;return rt(e.sourceFile)&&csArray.prototype.some.call(t.whilelistDomains,(function(t){return csString.prototype.indexOf.call(e.sourceFile,t)>0}))&&"report"!==r},t.prototype.securityPolicyViolationListener=function(t){this.isSecurityErrorRelevant(t)&&this.onEventCallback({violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})},t.whilelistDomains=["contentsquare","cdnssl.clicktale.net","localhost","website.com/build/e2e"],v([dt("Event handler type: securitypolicyviolation")],t.prototype,"securityPolicyViolationListener",null),t}(),Do=function(){function t(t){this.contentSecurityPolicyErrorsTracker=t}return t.prototype.init=function(){var t=this;this.contentSecurityPolicyErrorsTracker.onEvent((function(e){return t.processEvent(e)}))},t.prototype.start=function(){this.contentSecurityPolicyErrorsTracker.start()},t.prototype.stop=function(){this.contentSecurityPolicyErrorsTracker.stop()},t.prototype.processEvent=function(t){var e="Content Security Policy error. Violated directive: "+t.violatedDirective+" - Source file: "+t.sourceFile;ht.warn(e)},t}(),xo=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;return s.javaScriptErrorsTracker=e,s.javaScriptErrorsRequest=r,s.basicRequestParameters=i,s.javaScriptErrorsAnonymizer=n,s.customEventEmitter=o,s.javaScriptErrorsBatch=[],s.javaScriptErrorsCount=0,s.customErrorsBuffer=[],s}return f(e,t),e.prototype.init=function(){this.bindRequest()},e.prototype.initStates=function(){this.startTime=V(),this.javaScriptErrorsBatch=[],this.javaScriptErrorsCount=0},e.prototype.onStart=function(){var t=this;this.javaScriptErrorsTracker.subscribe(e.SERVICE_IDENTIFIER,(function(e){return t.processEvent(e)})),this.processCustomErrorsInBuffer()},e.prototype.onStop=function(){this.javaScriptErrorsTracker.unsubscribe(e.SERVICE_IDENTIFIER)},e.prototype.getRequestPayload=function(){return csJSON.stringify({errors:this.javaScriptErrorsBatch})},e.prototype.onIframeJavascriptError=function(t){this.processEvent(t)},e.prototype.trackCustomError=function(t){var e={errorType:"jsError",message:"Custom Error: "+t,lineno:1,colno:1,filename:"https://cserror.com/texterror.js"};this.processCustomErrorEvent(e)},e.prototype.processCustomErrorEvent=function(t){this.isStarted?(this.processEvent(t),this.customEventEmitter.emitCustomJavaScriptErrorEvent(t)):csArray.prototype.push.call(this.customErrorsBuffer,t)},e.prototype.processCustomErrorsInBuffer=function(){var t=this;this.isStarted&&(csArray.prototype.forEach.call(this.customErrorsBuffer,(function(e){return t.processCustomErrorEvent(e)})),this.customErrorsBuffer=[])},e.prototype.processEvent=function(t){this.isStarted&&this.javaScriptErrorsCount<20&&(this.javaScriptErrorsAnonymizer.anonymize(t),t.rt=this.getRelativeTime(),csArray.prototype.push.call(this.javaScriptErrorsBatch,t),this.sendErrors())},e.prototype.bindRequest=function(){var t=this;this.javaScriptErrorsRequest.setRequestParametersProviders(this.basicRequestParameters),this.javaScriptErrorsRequest.setRequestPayloadProvider(this),this.javaScriptErrorsRequest.after((function(){t.javaScriptErrorsBatch=[],t.javaScriptErrorsCount+=1}))},e.prototype.getRelativeTime=function(){return V()-this.startTime},e.prototype.sendErrors=function(){this.javaScriptErrorsRequest.send()},e.SERVICE_IDENTIFIER="JavaScriptErrorsService",e}(me),_o=function(t){function e(e,r,i,n){var o=t.call(this)||this;return o.apiErrorsTracker=e,o.apiErrorsRequest=r,o.basicRequestParameters=i,o.apiErrorsAnonymizer=n,o.apiErrorsBatch=[],o.apiErrorsCount=0,o}return f(e,t),e.prototype.init=function(){this.apiErrorsTracker.init(),this.bindRequest()},e.prototype.initStates=function(){this.apiErrorsBatch=[],this.apiErrorsCount=0,this.resetStartTime()},e.prototype.resetStartTime=function(){this.startTime=V()},e.prototype.getRelativeTime=function(){return V()-this.startTime},e.prototype.onStart=function(){var t=this;this.apiErrorsTracker.subscribe(e.SERVICE_IDENTIFIER,(function(e){return t.processEvent(e)}))},e.prototype.onStop=function(){this.apiErrorsTracker.unsubscribe(e.SERVICE_IDENTIFIER)},e.prototype.getRequestPayload=function(){return csJSON.stringify({errors:this.apiErrorsBatch})},e.prototype.onIframeApiError=function(t){this.processEvent(t)},e.prototype.processEvent=function(t){this.isStarted&&this.apiErrorsCount<e.MAX_ERRORS&&(t.relativeTime=this.getRelativeTime(),csArray.prototype.push.call(this.apiErrorsBatch,this.apiErrorsAnonymizer.anonymize(t)),this.sendErrors())},e.prototype.bindRequest=function(){var t=this;this.apiErrorsRequest.setRequestParametersProviders(this.basicRequestParameters),this.apiErrorsRequest.setRequestPayloadProvider(this),this.apiErrorsRequest.after((function(){t.apiErrorsBatch=[],t.apiErrorsCount+=1}))},e.prototype.sendErrors=function(){this.apiErrorsRequest.send()},e.SERVICE_IDENTIFIER="ApiErrorsService",e.MAX_ERRORS=20,e}(me),Vo=function(t){function e(e,r,i,n){var o=t.call(this)||this;return o.customErrorsRequest=e,o.basicRequestParameters=r,o.piiAnonymizer=i,o.customEventsEmitter=n,o.customErrorsBatch=[],o.customErrorsCount=0,o.customErrorsBuffer=[],o}return f(e,t),e.prototype.init=function(){this.bindRequest()},e.prototype.initStates=function(){this.startTime=V(),this.customErrorsBatch=[],this.customErrorsCount=0},e.prototype.trackCustomError=function(t,e){if(void 0===e&&(e={}),rt(t)&&it(e)){var r={message:csString.prototype.slice.call(t,0,300),errorType:"customError"};this.isAttributesValid(e)&&(r.attributes=e),this.processCustomErrorEvent(r)}},e.prototype.isAttributesValid=function(t){var e=Object.keys(t).length;if(0===e||e>5)return!1;for(var r in t)if(r.length>30||t[r].length>30)return!1;return!0},e.prototype.onStart=function(){this.processCustomErrorsInBuffer()},e.prototype.onStop=function(){},e.prototype.processCustomErrorsInBuffer=function(){var t=this;this.isStarted&&(csArray.prototype.forEach.call(this.customErrorsBuffer,(function(e){return t.processCustomErrorEvent(e)})),this.customErrorsBuffer=[])},e.prototype.processCustomErrorEvent=function(t){if(this.isStarted){var e=this.buildCustomError(t);this.processEvent(e),this.customEventsEmitter.emitCustomErrorEvent(e)}else csArray.prototype.push.call(this.customErrorsBuffer,t)},e.prototype.processEvent=function(t){this.isStarted&&this.customErrorsCount<20&&(csArray.prototype.push.call(this.customErrorsBatch,t),this.sendErrors())},e.prototype.buildCustomError=function(t){var e=y(y({},t),{rt:this.getRelativeTime()});return e.message=this.piiAnonymizer.anonymize(t.message),e},e.prototype.bindRequest=function(){var t=this;this.customErrorsRequest.setRequestParametersProviders(this.basicRequestParameters),this.customErrorsRequest.setRequestPayloadProvider(this),this.customErrorsRequest.after((function(){t.customErrorsBatch=[],t.customErrorsCount+=1}))},e.prototype.getRequestPayload=function(){return csJSON.stringify({errors:this.customErrorsBatch})},e.prototype.getRelativeTime=function(){return V()-this.startTime},e.prototype.sendErrors=function(){this.customErrorsRequest.send()},e}(me);!function(t){t.CONTENTSQUARE="contentsquare.net",t.CLICKTALE="clicktale.net",t.FAKE_TRACKER="fake-tracker.content-square.fr"}(Oo||(Oo={}));var qo,zo=["trackError"],Uo=["api-errors:maskUrl"],Bo=function(){function t(t,e,r,i,n,o,s,a,c,u){this.javaScriptErrorsTracker=t,this.javaScriptErrorsAnonymizer=e,this.apiErrorsTracker=r,this.apiErrorsAnonymizer=i,this.piiAnonymizer=n,this.configuration=o,this.basicRequestParameters=s,this.iframeEventsEmitter=a,this.commandsService=c,this.customEventEmitter=u}return t.prototype.init=function(){this.contentSecurityPolicyErrorsService=new Do(new Mo),this.contentSecurityPolicyErrorsService.init();var t=new Bt(this.configuration.getTrackerUri(),"errors");this.javaScriptErrorsService=new xo(this.javaScriptErrorsTracker,t,this.basicRequestParameters,this.javaScriptErrorsAnonymizer,this.customEventEmitter),this.javaScriptErrorsService.init(),this.iframeEventsEmitter.addListeners(this.javaScriptErrorsService);var e=new Bt(this.configuration.getTrackerUri(),"api-errors");this.apiErrorsTracker.excludeDomains([Oo.CONTENTSQUARE,Oo.CLICKTALE,Oo.FAKE_TRACKER]),this.apiErrorsService=new _o(this.apiErrorsTracker,e,this.basicRequestParameters,this.apiErrorsAnonymizer),this.apiErrorsService.init(),this.iframeEventsEmitter.addListeners(this.apiErrorsService);var r=new Bt(this.configuration.getTrackerUri(),"custom-errors");this.customErrorsService=new Vo(r,this.basicRequestParameters,this.piiAnonymizer,this.customEventEmitter),this.customErrorsService.init(),this.registerCommands()},t.prototype.registerCommands=function(){var t=this;this.commandsService.register(Uo,(function(e){return t.apiErrorsAnonymizer.addUrlMaskingPattern(e)})),this.commandsService.register(zo,(function(e,r){t.configuration.customErrorsEnabled?t.customErrorsService.trackCustomError(e,r):t.javaScriptErrorsService.trackCustomError(e)}))},t.prototype.onInitTracking=function(){this.contentSecurityPolicyErrorsService.start()},t.prototype.onStartTracking=function(){this.configuration.jsErrorsEnabled&&this.javaScriptErrorsService.start(),this.configuration.apiErrors.enabled&&this.apiErrorsService.start(),this.configuration.customErrorsEnabled&&this.customErrorsService.start()},t.prototype.onAfterNaturalPageView=function(){this.javaScriptErrorsService.initStates(),this.apiErrorsService.initStates(),this.customErrorsService.initStates()},t.prototype.onAfterArtificialPageView=function(){this.javaScriptErrorsService.initStates(),this.apiErrorsService.initStates(),this.customErrorsService.initStates()},t.prototype.onBeforeSessionRenewal=function(){this.javaScriptErrorsService.stop(),this.apiErrorsService.stop(),this.customErrorsService.stop()},t.prototype.onOptout=function(){this.contentSecurityPolicyErrorsService.stop(),this.javaScriptErrorsService.stop(),this.apiErrorsService.stop(),this.customErrorsService.stop()},t}();!function(t){t.Set="set",t.Remove="remove"}(qo||(qo={}));var Ho=function(){function t(t,e){this.configuration=t,this.cookieService=e,this.sameSite=pt.None,this.isActivated=!1,this.setCookieBatch=[],this.removeCookieBatch=[]}return t.prototype.init=function(){this.sameSite=this.cookieService.isSameSiteSupported()?pt.None:pt.NotSet},t.prototype.setStates=function(t,e){this.currentDomainState=t,this.iframeDomainState=e},t.prototype.start=function(t){var e=this;this.iframeDomainState.init(this.getIframeDomain(),(function(r,i){var n=[e.currentDomainState.get()];i&&csArray.prototype.push.call(n,r);var o=To.select(n,e.configuration.lastTrackingDraw);e.isActivated=!0,e.currentDomainState.apply(o),t()})),this.iframe=this.iframeDomainState.openIframe()},t.prototype.setCookie=function(t,e,r){if(this.isActivated){var i={name:t,value:e,samesite:this.sameSite,secure:lt.Yes};r&&(i.expires=ct.toExpireDate(r).getTime()),this.addToSetCookieBatch(i)}},t.prototype.removeCookie=function(t){this.isActivated&&this.addToRemoveCookieBatch(t)},t.prototype.addToRemoveCookieBatch=function(t){this.removeCookieBatch=csArray.prototype.filter.call(this.removeCookieBatch,(function(e){return e!==t})),this.setCookieBatch=csArray.prototype.filter.call(this.setCookieBatch,(function(e){return e.name!==t})),csArray.prototype.push.call(this.removeCookieBatch,t),this.setBatchReadyCall()},t.prototype.addToSetCookieBatch=function(t){this.removeCookieBatch=csArray.prototype.filter.call(this.removeCookieBatch,(function(e){return e!==t.name})),this.setCookieBatch=csArray.prototype.filter.call(this.setCookieBatch,(function(e){return e.name!==t.name})),csArray.prototype.push.call(this.setCookieBatch,t),this.setBatchReadyCall()},t.prototype.setBatchReadyCall=function(){this.sendMessagesBatchs()},t.prototype.sendMessagesBatchs=function(){if(this.setCookieBatch.length>0){var t=this.buildMessage(qo.Set,this.setCookieBatch);this.sendMessage(t),this.setCookieBatch=[]}if(this.removeCookieBatch.length>0){var e=this.buildMessage(qo.Remove,this.removeCookieBatch);this.sendMessage(e),this.removeCookieBatch=[]}},t.prototype.buildMessage=function(t,e){return{command:t,cookies:e,domain:null,pid:this.configuration.projectId}},t.prototype.sendMessage=function(t){var e="https://"+this.getIframeDomain();this.iframe.contentWindow&&this.iframe.contentWindow.postMessage(t,e)},t.prototype.getIframeDomain=function(){return this.configuration.dualCollectionTagDomain&&"contentsquare.net"!==this.configuration.dualCollectionTagDomain?"cdnssl."+this.configuration.dualCollectionTagDomain:"csxd.contentsquare.net"},v([$r(),dt("send xdframe-single-iframe batch")],t.prototype,"setBatchReadyCall",null),t}(),Fo=function(){function t(t,e){this.configuration=t,this.xdframeOpener=e}return t.prototype.init=function(t,e){this.xdframeOrigin="https://"+t,this.callback=e},t.prototype.openIframe=function(){var t=this;this.xdframeOpener.onMessage((function(e){t.handleXdframeMessage(e)})),this.xdframeOpener.onTimeout((function(){t.handleTimeout()})),this.xdframeOpener.start();var e=this.getXdframeUrl(this.xdframeOrigin);return this.xdframeOpener.open(e)},t.prototype.handleXdframeMessage=function(t){if(this.isXdframeMessage(t)){var e=t.data,r=!0;if(this.isXdframeErrorMessage(t))return void ht.warn("Error xdframe single domain: "+csJSON.stringify(t.data)+" from "+t.origin);if(!Nt.isRawDomainState(e))return void ht.warn("Unknown message format from xdframe single domain: "+csJSON.stringify(t.data)+" from "+t.origin);Nt.isValid(e)||(ht.warn("Invalid xdframe single domain state: "+csJSON.stringify(t.data)+" from "+t.origin),r=!1),this.xdframeOpener.stop(),this.callback(r?It.fromRaw(e):{},r)}},t.prototype.handleTimeout=function(){ht.warn("xdframe single domain: all messages not received")},t.prototype.isXdframeMessage=function(t){return t.origin===this.xdframeOrigin&&it(t.data)},t.prototype.isXdframeErrorMessage=function(t){return!!t.data.error},t.prototype.getXdframeUrl=function(t){return t+"/uxa/xdframe-single-domain-1.1.1.html?pid="+this.configuration.projectId},t}(),Go=function(){function t(t,e,r){this.configuration=t,this.visitorService=e,this.sessionService=r}return t.prototype.getRequestParameters=function(){if(!this.visitorService.doesVisitorExist()||!this.sessionService.doesSessionExist())return{};var t=this.visitorService.getVisitor();return y(y(y({},{v:"11.39.0"}),this.configuration.getRequestParameters()),{uu:t.id,sn:""+t.visitsCount,pn:""+this.sessionService.getSession().pageNumber})},t}(),jo=function(t){function e(){var e=t.call(this)||this;return e.useCapture=!1,e.eventHandler={boundElement:window,type:"error",listener:function(t){return e.errorListener(t)}},e}return f(e,t),e.prototype.onStartTracking=function(){Ht(this.eventHandler,this.useCapture)},e.prototype.onStopTracking=function(){Ft(this.eventHandler,this.useCapture)},e.prototype.errorListener=function(t){var e=this.buildJavaScriptError(t);for(var r in this.subscriptions){(0,this.subscriptions[r])(e)}},e.prototype.decorateErrorMessage=function(t){return t.length<=e.MAX_ERROR_MESSAGE_LENGTH?t:csString.prototype.slice.call(t,0,e.MAX_ERROR_MESSAGE_LENGTH-e.truncatedErrorMessageMarker.length)+e.truncatedErrorMessageMarker},e.prototype.buildJavaScriptError=function(t){return{errorType:"jsError",message:this.decorateErrorMessage(t.message),filename:t.filename,lineno:t.lineno,colno:t.colno}},e.truncatedErrorMessageMarker="…",e.MAX_ERROR_MESSAGE_LENGTH=1024,v([dt("Event handler type: error")],e.prototype,"errorListener",null),e}(Yn),Ko=function(){function t(t,e){this.commandsService=t,this.projectConfiguration=e}return t.prototype.init=function(){var t=this;this.commandsService.register(["debugEvents"],(function(e){"boolean"==typeof e&&t.projectConfiguration.updateDynamicFields("emitDebugEvents",e)}))},t}();function Wo(t,e,r){if(!nt(e)&&!nt(r))return t.href;var i=nt(e)?function(t){return T(t,"/")?t:"/"+t}(e):t.pathname,n=nt(r)?function(t){return T(t,"?")||""===t?t:"?"+t}(r):t.search;return t.protocol+"//"+t.host+i+n}var Yo,Xo,Jo,Qo=function(){function t(t,e){this.location=t,this.pii=e}return t.prototype.overridePath=function(t){nt(t)&&rt(t)&&(this.path=""===t?void 0:t)},t.prototype.overrideQuery=function(t){nt(t)&&rt(t)&&(this.query=t)},t.prototype.computeOverriddenUrl=function(t){return this.isCurrentPageUrl(t)?this.getUrl():t},t.prototype.isCurrentPageUrl=function(t){var e=this.normalizeUrl(this.location.href);return this.normalizeUrl(t)===e},t.prototype.normalizeUrl=function(t){return R(t,"/")?csString.prototype.slice.call(t,0,-1):t},t.prototype.getUrl=function(){return Wo(this.location,this.path,this.query)},t.prototype.getUrlProtocol=function(){return this.location.protocol},t.prototype.getRequestParameters=function(){var t=this.getUrl();return{url:this.pii.anonymize(t)}},t}(),Zo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.emitPageEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onPageEvent&&i.onPageEvent(t)}},e.prototype.emitEventTriggerRecording=function(t,e){for(var r=0,i=this.listeners;r<i.length;r++){var n=i[r];n.onEventTriggerRecording&&n.onEventTriggerRecording(t,e)}},e.prototype.emitCustomJavaScriptErrorEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onCustomJavaScriptErrorEvent&&i.onCustomJavaScriptErrorEvent(t)}},e.prototype.emitCustomErrorEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onCustomErrorEvent&&i.onCustomErrorEvent(t)}},e.prototype.emitUserIdentifierEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onUserIdentifierEvent&&i.onUserIdentifierEvent(t)}},e}(so),$o=function(t){function e(e,r){var i=t.call(this)||this;return i.xhrRequestTracker=e,i.fetchRequestTracker=r,i.excludedDomains=[],i}return f(e,t),e.prototype.subscribe=function(e,r,i){(null==i?void 0:i.detailedEvent)&&Object.defineProperty(r,"detailedEvent",{value:i.detailedEvent}),t.prototype.subscribe.call(this,e,r)},e.prototype.init=function(){var t=this;this.xhrRequestTracker.onEvent((function(e){return t.apiErrorListener(e)})),this.fetchRequestTracker.onEvent((function(e){return t.apiErrorListener(e)}))},e.prototype.onStartTracking=function(){this.xhrRequestTracker.start(),this.fetchRequestTracker.start()},e.prototype.onStopTracking=function(){this.xhrRequestTracker.stop(),this.fetchRequestTracker.stop()},e.prototype.apiErrorListener=function(t){if(t.url&&t.statusCode){if(this.isExcludedDomain(t.url))return;if(t.statusCode>=400)for(var e in this.subscriptions){var r=this.subscriptions[e];if(r.hasOwnProperty("detailedEvent"))r(this.buildDetailedApiError(t));else r(this.buildApiError(t))}}},e.prototype.buildApiError=function(t){return{errorType:"apiError",url:t.url,method:t.method,requestTime:t.requestTime,responseTime:t.responseTime,statusCode:t.statusCode,library:t.library}},e.prototype.buildDetailedApiError=function(t){var e=this.buildApiError(t);return Object.keys(t.standardRequestHeaders).length>0&&(e.standardRequestHeaders=t.standardRequestHeaders),Object.keys(t.standardResponseHeaders).length>0&&(e.standardResponseHeaders=t.standardResponseHeaders),Object.keys(t.customRequestHeaders).length>0&&(e.customRequestHeaders=csJSON.stringify(t.customRequestHeaders)),Object.keys(t.customResponseHeaders).length>0&&(e.customResponseHeaders=csJSON.stringify(t.customResponseHeaders)),t.queryParameters&&(e.queryParameters=t.queryParameters),t.requestBody&&(e.requestBody=t.requestBody),t.responseBody&&(e.responseBody=t.responseBody),e},e.prototype.isExcludedDomain=function(t){return csArray.prototype.some.call(this.excludedDomains,(function(e){return-1!==csString.prototype.indexOf.call(t,e)}))},e.prototype.excludeDomains=function(t){var e;(e=csArray.prototype.push).call.apply(e,S([this.excludedDomains],t))},e.truncatedErrorMessageMarker="…",e}(Yn),ts=function(){function t(){this.validContentTypes=["application/json","application/graphql","application/xml","text/plain","text/csv","text/html","text/xml"]}return t.prototype.isValidUrl=function(t,e){return!!e&&csArray.prototype.some.call(e,(function(e){return-1!==csString.prototype.indexOf.call(t,e)}))},t.prototype.isValidBodyType=function(t){var e=t["content-type"];if(!e)return!1;var r=csString.prototype.toLocaleLowerCase.call(e);return csArray.prototype.some.call(this.validContentTypes,(function(t){return T(r,t)}))},t}(),es=function(t){function e(e,r,i){var n=t.call(this)||this;return n.monkeyPatcher=e,n.validHeaders=r,n.configuration=i,n.isStarted=!1,n.openInterceptor=null,n.setRequestHeaderInterceptor=null,n.sendInterceptor=null,n.callbacks=[],n.openHook=function(t){var e=t.context,r=t.args,i=t.callerName;return n.interceptOpen(e,r,i)},n.setRequestHeaderHook=function(t){var e=t.context,r=t.args;return n.interceptSetRequestHeader(e,r)},n.sendHook=function(t){var e=t.context,r=t.args;return n.interceptSend(e,r)},n}return f(e,t),e.prototype.onEvent=function(t){csArray.prototype.push.call(this.callbacks,t)},e.prototype.start=function(){this.isStarted||(this.createInterceptors(),this.openInterceptor&&this.openInterceptor.activate(),this.setRequestHeaderInterceptor&&this.setRequestHeaderInterceptor.activate(),this.sendInterceptor&&this.sendInterceptor.activate(),this.isStarted=!0)},e.prototype.stop=function(){this.isStarted&&(this.openInterceptor&&this.openInterceptor.deactivate(),this.setRequestHeaderInterceptor&&this.setRequestHeaderInterceptor.deactivate(),this.isStarted=!1)},e.prototype.createInterceptors=function(){this.openInterceptor||(this.openInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:XMLHttpRequest.prototype,methodName:"open",hook:this.openHook,options:{withCallerName:!0}})),this.setRequestHeaderInterceptor||(this.setRequestHeaderInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:XMLHttpRequest.prototype,methodName:"setRequestHeader",hook:this.setRequestHeaderHook})),this.sendInterceptor||(this.sendInterceptor=this.monkeyPatcher.createSyncFunctionInterceptor({target:XMLHttpRequest.prototype,methodName:"send",hook:this.sendHook}))},e.prototype.interceptOpen=function(t,e,r){var i=this;if(e[1]&&rt(e[1])){var n=csString.prototype.split.call(e[1],"?"),o=n[0],s=n[1],a=G(o);t.apiCall={url:a,method:e[0],standardRequestHeaders:{},standardResponseHeaders:{},customRequestHeaders:{},customResponseHeaders:{},requestTime:V(),responseTime:0,statusCode:0,library:r},s&&this.isValidUrl(a,this.configuration.apiErrors.validUrls)&&this.configuration.apiErrors.collectQueryParam&&(t.apiCall.queryParameters=s),t.addEventListener("readystatechange",(function(){return i.readyStateChangeListener(t)}))}},e.prototype.readyStateChangeListener=function(t){var e=this;t.readyState===XMLHttpRequest.DONE&&(t.apiCall.responseTime=V(),t.apiCall.statusCode=t.status,this.isHeaderCollectionActive()&&csArray.prototype.forEach.call(csString.prototype.split.call(t.getAllResponseHeaders(),/[\r\n]+/),(function(r){var i=csString.prototype.split.call(r,/:(.*)/),n=i[0],o=i[1];e.configuration.apiErrors.collectStandardHeaders&&e.validHeaders.isValidStandardHeader(n)?t.apiCall.standardResponseHeaders[n]=csString.prototype.trim.call(o):e.validHeaders.isValidCustomHeader(n)&&(t.apiCall.customResponseHeaders[n]=csString.prototype.trim.call(o))})),this.isValidUrl(t.apiCall.url,this.configuration.apiErrors.validUrls)&&this.configuration.apiErrors.collectResponseBody&&this.isValidBodyType(t.apiCall.standardResponseHeaders)&&(t.apiCall.responseBody=t.responseText),csArray.prototype.forEach.call(this.callbacks,(function(e){return e(t.apiCall)})))},e.prototype.interceptSetRequestHeader=function(t,e){if(t.apiCall&&this.isHeaderCollectionActive()){var r=e[0],i=e[1];this.configuration.apiErrors.collectStandardHeaders&&this.validHeaders.isValidStandardHeader(r)&&i?t.apiCall.standardRequestHeaders[r]=i.trim():this.validHeaders.isValidCustomHeader(r)&&i&&(t.apiCall.customRequestHeaders[r]=i.trim())}},e.prototype.interceptSend=function(t,e){var r=e[0];t.apiCall&&this.isValidUrl(t.apiCall.url,this.configuration.apiErrors.validUrls)&&this.configuration.apiErrors.collectRequestBody&&this.isValidBodyType(t.apiCall.standardRequestHeaders)&&"string"==typeof r&&(t.apiCall.requestBody=r)},e.prototype.isHeaderCollectionActive=function(){return this.configuration.apiErrors.collectStandardHeaders||this.configuration.apiErrors.validCustomHeaders&&0!==this.configuration.apiErrors.validCustomHeaders.length},v([dt("XhrRequestTracker.interceptOpen")],e.prototype,"interceptOpen",null),v([dt("XhrRequestTracker.readyStateChangeListener")],e.prototype,"readyStateChangeListener",null),v([dt("XhrRequestTracker.interceptSetRequestHeader")],e.prototype,"interceptSetRequestHeader",null),v([dt("XhrRequestTracker.interceptSend")],e.prototype,"interceptSend",null),e}(ts),rs=function(t){function e(e,r,i){var n=t.call(this)||this;return n.monkeyPatcher=e,n.validHeaders=r,n.configuration=i,n.isStarted=!1,n.fetchInterceptor=null,n.callbacks=[],n.hook=function(t){var e=t.result,r=t.args,i=t.callerName;n.interceptFetch(e,r,i)},n}return f(e,t),e.prototype.onEvent=function(t){csArray.prototype.push.call(this.callbacks,t)},e.prototype.start=function(){this.isStarted||this.canTrackFetch()&&(this.createFetchInterceptor(),this.fetchInterceptor&&this.fetchInterceptor.activate(),this.isStarted=!0)},e.prototype.stop=function(){this.isStarted&&(this.fetchInterceptor&&this.fetchInterceptor.deactivate(),this.isStarted=!1)},e.prototype.canTrackFetch=function(){return!!window.fetch&&"function"==typeof window.fetch},e.prototype.prepareArgs=function(t,e){var r=S(e);return r[0]&&"function"==typeof r[0].clone&&(r[0]=e[0].clone()),{context:t,args:r}},e.prototype.createFetchInterceptor=function(){this.fetchInterceptor||(this.fetchInterceptor=this.monkeyPatcher.createAsyncFunctionInterceptor({target:window,methodName:"fetch",hook:this.hook,hookPrepareArgs:this.prepareArgs,options:{withCallerName:!0}}))},e.prototype.interceptFetch=function(t,e,r){return m(this,void 0,void 0,(function(){var i,n,o,s,a,c,u,p,l,h,d,f;return g(this,(function(y){switch(y.label){case 0:if(i=e[0],n=e[1],!(o=new Request(i,n)).url||!rt(o.url))return[2];s=csString.prototype.split.call(o.url,"?"),a=s[0],c=s[1],u=G(a),p={url:u,method:o.method,requestTime:V(),responseTime:0,statusCode:0,standardRequestHeaders:{},standardResponseHeaders:{},customRequestHeaders:{},customResponseHeaders:{},library:r},y.label=1;case 1:return y.trys.push([1,3,,4]),[4,t];case 2:return l=y.sent(),[3,4];case 3:if(h=y.sent(),this.isNetworkError(h)||this.isAbortedRequestError(h)||this.isTrustTokenOperationError(h))return[2];throw h;case 4:return p.responseTime=V(),l.type.indexOf("opaque")>-1?p.statusCode=-1:p.statusCode=l.status,this.configuration.apiErrors.collectStandardHeaders&&(p.standardRequestHeaders=this.extractStandardHeaders(o.headers),p.standardResponseHeaders=this.extractStandardHeaders(l.headers)),this.configuration.apiErrors.validCustomHeaders&&0!==this.configuration.apiErrors.validCustomHeaders.length&&(p.customRequestHeaders=this.extractCustomHeaders(o.headers),p.customResponseHeaders=this.extractCustomHeaders(l.headers)),this.isValidUrl(a,this.configuration.apiErrors.validUrls)?(this.configuration.apiErrors.collectQueryParam&&c&&(p.queryParameters=c),this.configuration.apiErrors.collectRequestBody&&this.isValidBodyType(p.standardRequestHeaders)?(d=p,[4,o.text()]):[3,6]):[3,8];case 5:d.requestBody=y.sent(),y.label=6;case 6:return this.configuration.apiErrors.collectResponseBody&&this.isValidBodyType(p.standardResponseHeaders)?(f=p,[4,l.text()]):[3,8];case 7:f.responseBody=y.sent(),y.label=8;case 8:return csArray.prototype.forEach.call(this.callbacks,(function(t){return t(p)})),[2]}}))}))},e.prototype.extractStandardHeaders=function(t){var e=this,r={};return t.forEach((function(t,i){e.validHeaders.isValidStandardHeader(i)&&t&&(r[i]=csString.prototype.trim.call(t))})),r},e.prototype.extractCustomHeaders=function(t){var e=this,r={};return t.forEach((function(t,i){e.validHeaders.isValidCustomHeader(i)&&t&&(r[i]=csString.prototype.trim.call(t))})),r},e.prototype.isNetworkError=function(t){return t instanceof TypeError},e.prototype.isAbortedRequestError=function(t){return t instanceof DOMException&&"AbortError"===t.name},e.prototype.isTrustTokenOperationError=function(t){return t instanceof DOMException&&csArray.prototype.some.call(e.TRUST_TOKEN_OPERATION_ERROR_NAMES,(function(e){return e===t.name}))},e.TRUST_TOKEN_OPERATION_ERROR_NAMES=["NoModificationAllowedError","InvalidStateError","OperationError"],v([dt("FetchRequestTracker.interceptFetch")],e.prototype,"interceptFetch",null),e}(ts);(Yo||(Yo={})).transformEvent=function(t,e,r){return function(t,e){return fi(e)&&(e.tgt=""+t+ns+e.tgt),void 0!==e.tgtHM&&(e.tgtHM=""+t+ns+e.tgtHM),function(t){return void 0!==t.tgtLk}(e)&&(e.tgtLk=""+t+ns+e.tgtLk),e}(e,function(t,e){if(void 0!==(i=e).x&&void 0!==i.y){var r=t.getBoundingClientRect();e.x=Math.round(r.left+e.x+Ue.windowOffsetX()),e.y=Math.round(r.top+e.y+Ue.windowOffsetY())}var i;return e}(t,r))},(Xo||(Xo={})).transformCommandsBatch=function(t,e){return{iframePath:e.iframePath?""+t+ns+e.iframePath:t,commands:e.commands}},(Jo||(Jo={})).transformEmerchandisingMessage=function(t,e){if(0===e.products.length)return e;var r=csArray.prototype.map.call(e.products,(function(e){return y(y({},e),{targetPath:""+t+ns+e.targetPath})}));return y(y({},e),{products:r})};var is,ns="|iframe|",os=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.emitIframeEvent=function(t,e,r,i){switch(r){case X.ChildLogMessage:this.logMessage(i);break;case X.AnalysisEvent:var n=Yo.transformEvent(t,e,i);this.emitIframeAnalysisEvent(n);break;case X.JavascriptError:this.emitIframeJavascriptError(i);break;case X.ApiError:this.emitIframeApiError(i);break;case X.EmerchandisingMessage:var o=Jo.transformEmerchandisingMessage(e,i);this.emitIframeEmerchandisingMessage(o);break;case X.Commands:var s=Xo.transformCommandsBatch(e,i);this.emitIframeCommands(s);break;case X.IntegrationCallback:this.emitIframeIntegrationCallback(i);break;default:ht.error("Parent received unknown data type from iframe : "+csJSON.stringify(i))}},e.prototype.logMessage=function(t){var e=t.message,r=t.errorCode;switch(t.level){case b.debug:ht.debug(e,r);break;case b.warn:ht.warn(e,r);break;case b.error:ht.error(e,r);break;case b.critical:ht.critical(e,r)}},e.prototype.emitIframeAnalysisEvent=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIframeAnalysisEvent&&i.onIframeAnalysisEvent(t)}},e.prototype.emitIframeJavascriptError=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIframeJavascriptError&&i.onIframeJavascriptError(t)}},e.prototype.emitIframeApiError=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIframeApiError&&i.onIframeApiError(t)}},e.prototype.emitIframeEmerchandisingMessage=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIframeEmerchandisingMessage&&i.onIframeEmerchandisingMessage(t)}},e.prototype.emitIframeCommands=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIframeCommands&&i.onIframeCommands(t)}},e.prototype.emitIframeIntegrationCallback=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIframeIntegrationCallback&&i.onIframeIntegrationCallback(t)}},e}(so);!function(t){t.COMPRESSION_DISABLED="compressionDisabled"}(is||(is={}));var ss=function(){function t(){}return t.init=function(e,r,i){var n=e.cookielessTrackingEnabled?i.getItem("_cs_debug"):r.get("_cs_debug");n&&(t.debugFlags=csString.prototype.split.call(n,"."))},t.isCompressionDisabled=function(){return-1!==csArray.prototype.indexOf.call(t.debugFlags,is.COMPRESSION_DISABLED)},t.debugFlags=[],t}(),as=function(t){function e(e,r){var i=t.call(this,r)||this;return i.compressionFactory=e,i.worker=i.tryCreateCompressionWorker(),i.callbacks={},i.callbackId=0,i._compressSync=e(),i}return f(e,t),e.prototype.isSupported=function(){return!!this.worker},e.prototype.compress=function(t,e,r){if(this.isSupported()){var i=this.getNewCallbackId();this.callbacks[i]=r,this.worker.postMessage(["CS_WORKER_SIGNATURE",t,e,i])}},e.prototype.compressSync=function(t){return this._compressSync("base64",t)},e.prototype.handleWorkerMessage=function(t){var e=t.data,r=e[0],i=e[1],n=e[2];"CS_WORKER_SIGNATURE"===r&&(this.callbacks[i](n),delete this.callbacks[i])},e.prototype.getNewCallbackId=function(){return this.callbackId+=1},e.prototype.tryCreateCompressionWorker=function(){try{var t=csArray.prototype.join.call(["\nvar WORKER_SIGNATURE = "+csJSON.stringify("CS_WORKER_SIGNATURE")+";","var compress = ("+this.compressionFactory.toString()+")();","("+cs.toString()+")()\n\n//compression algo"],"\n");return this.createWorker(t)}catch(t){return null}},e.prototype.createWorker=function(t){var e=this,r=window.csURL||window.webkitURL,i=window.Blob,n=window.Worker;if(!r||!i||!n)return null;var o=new i([t],{type:"application/javascript"}),s=new n(r.createObjectURL(o));return s.onerror=function(t){return e.handleWorkerError(t)},s.onmessage=function(t){return e.handleWorkerMessage(t)},s},e.prototype.handleWorkerError=function(t){var e="WorkerError: "+(t.message?t.message:"No message");return this.onError(e)},v([dt("Worker message handler")],e.prototype,"handleWorkerMessage",null),e}(fe),cs=function(){self.addEventListener("message",(function(t){var e=t.data,r=e[0],i=e[1],n=e[2],o=e[3];if("CS_WORKER_SIGNATURE"===r){var s=compress(i,n);self.postMessage(["CS_WORKER_SIGNATURE",o,s])}}))};function us(t){void 0===t&&(t=!1);var e=String.fromCharCode,r={compressToBase64:function(t){if(null==t)return"";return n(o(t))},toBase64:n,compressToUint8Array:function(t){for(var e=o(t),r=new Uint8Array(2*e.length),i=0,n=e.length;i<n;i++){var s=e.charCodeAt(i);r[2*i]=s>>>8,r[2*i+1]=s%256}return r},compress:o};if(t)return r;var i="".charAt.bind("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");function n(t){for(var e,r,n,o,s,a,c,u="",p=t.charCodeAt.bind(t),l=0,h=t.length;l<2*h;)l%2==0?(e=p(l/2)>>8,r=255&p(l/2),n=l/2+1<h?p(l/2+1)>>8:NaN):(e=255&p((l-1)/2),(l+1)/2<h?(r=p((l+1)/2)>>8,n=255&p((l+1)/2)):r=n=NaN),l+=3,o=e>>2,s=(3&e)<<4|r>>4,a=(15&r)<<2|n>>6,c=63&n,isNaN(r)?a=c=64:isNaN(n)&&(c=64),u=u+i(o)+i(s)+i(a)+i(c);return u}function o(t){if(null==t)return"";var r,i,n,o={},s={},a="",c="",u="",p=2,l=3,h=2,d="",f=0,y=0,v=Object.prototype.hasOwnProperty,m=function(){if(v.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<h;r++)f<<=1,15==y?(y=0,d+=e(f),f=0):y++;for(i=u.charCodeAt(0),r=0;r<8;r++)f=f<<1|1&i,15==y?(y=0,d+=e(f),f=0):y++,i>>=1}else{for(i=1,r=0;r<h;r++)f=f<<1|i,15==y?(y=0,d+=e(f),f=0):y++,i=0;for(i=u.charCodeAt(0),r=0;r<16;r++)f=f<<1|1&i,15==y?(y=0,d+=e(f),f=0):y++,i>>=1}0==--p&&(p=Math.pow(2,h),h++),delete s[u]}else for(i=o[u],r=0;r<h;r++)f=f<<1|1&i,15==y?(y=0,d+=e(f),f=0):y++,i>>=1;0==--p&&(p=Math.pow(2,h),h++)};for(n=0;n<t.length;n+=1)a=t.charAt(n),v.call(o,a)||(o[a]=l++,s[a]=!0),c=u+a,v.call(o,c)?u=c:(m(),o[c]=l++,u=String(a));for(""!==u&&m(),i=2,r=0;r<h;r++)f=f<<1|1&i,15==y?(y=0,d+=e(f),f=0):y++,i>>=1;for(;;){if(f<<=1,15==y){d+=e(f);break}y++}return d}return function(t,e){return"base64"===t?r.compressToBase64(e):r.compressToUint8Array(e)}}var ps,ls,hs=function(t){function e(e){var r=t.call(this,us,e)||this;return r.algorithm="lzstring",r}return f(e,t),e}(as),ds=function(){function t(){}return t.create=function(t){return this.instance?this.instance:ss.isCompressionDisabled()?new ye(t):this.instance=new hs(t)},t}(),fs=function(){function t(t){this.pii=t,this.urlMaskingPatterns=[]}return t.prototype.addUrlMaskingPattern=function(e){for(var r=[],i=0,n=csString.prototype.split.call(e,"/");i<n.length;i++){var o=n[i];T(o,t.ROUTE_PARAMETER_START)?csArray.prototype.push.call(r,{key:o,value:"CS_ANONYMIZED_"+csString.prototype.toUpperCase.call(csString.prototype.slice.call(o,1))}):csArray.prototype.push.call(r,{key:o,value:null})}csArray.prototype.push.call(this.urlMaskingPatterns,r)},t.prototype.anonymize=function(t){return y(y({},t),{url:this.anonymizeUrl(t.url)})},t.prototype.anonymizeUrl=function(t){return this.maskUrl(this.pii.anonymize(this.removeQueryString(t)))},t.prototype.maskUrl=function(t){for(var e=csString.prototype.split.call(t,"/"),r=0,i=this.urlMaskingPatterns;r<i.length;r++){var n=i[r],o=this.getAnonymizedUrl(e,n);if(null!==o)return o}return t},t.prototype.getAnonymizedUrl=function(e,r){if(e.length<r.length)return null;for(var i="",n=0;n<e.length;n+=1)if(n>=r.length)i+=e[n]+"/";else if(T(r[n].key,t.ROUTE_PARAMETER_START))i+=r[n].value+"/";else{if(e[n]!==r[n].key)return null;i+=e[n]+"/"}return csString.prototype.slice.call(i,0,-1)},t.prototype.removeQueryString=function(t){var e=csString.prototype.indexOf.call(t,"?");return-1!==e?csString.prototype.slice.call(t,0,e+1):t},t.ROUTE_PARAMETER_START=":",t}(),ys=function(){function t(t,e){this.pii=t,this.urlService=e}return t.prototype.anonymize=function(t){return nt(t.message)&&(t.message=this.pii.anonymize(t.message)),nt(t.filename)&&(t.filename=this.pii.anonymize(this.urlService.computeOverriddenUrl(t.filename))),t},t}(),vs=function(){function t(){}return t.prototype.setItem=function(t,e){window.sessionStorage.setItem(t,e)},t.prototype.getItem=function(t){return window.sessionStorage.getItem(t)},t.prototype.removeItem=function(t){window.sessionStorage.removeItem(t)},t}(),ms=function(){function t(){}return t.prototype.setItem=function(t,e){window.localStorage.setItem(t,e)},t.prototype.getItem=function(t){return window.localStorage.getItem(t)},t.prototype.removeItem=function(t){window.localStorage.removeItem(t)},t}(),gs=["visit",2],Ss=["page",3],Es=["nextPageOnly",4],Cs=function(){function t(t,e){this.pii=t,this.storage=e,this.customVariablesPage={},this.customVariablesNextPageOnly={}}return t.prototype.set=function(t,e,r,i){var n,o;if(t>0&&ot(e)&&ot(r)){var s=this.pii.anonymize(""+(rt(e)?e:csString(e))),a=this.pii.anonymize(""+(rt(r)?r:csString(r)));if(n=[s.slice(0,512),a.slice(0,255)],o=""!==r,!nt(i)||csArray.prototype.indexOf.call(gs,i)>=0){var c=this.getCustomVariablesSession();o?c[t]=n:delete c[t],this.setCustomVariableSession(c)}(!nt(i)||csArray.prototype.indexOf.call(Ss,i)>=0)&&(o?this.customVariablesPage[t]=n:delete this.customVariablesPage[t]),nt(i)&&csArray.prototype.indexOf.call(Es,i)>=0&&(o?this.customVariablesNextPageOnly[t]=n:delete this.customVariablesNextPageOnly[t])}},t.prototype.getCustomVariablesSession=function(){var t=this.storage.get();if(!t)return{};var e=window.JSON.parse(t);return null!==e&&it(e)?e:{}},t.prototype.setCustomVariableSession=function(t){this.storage.set(window.JSON.stringify(t))},t.prototype.removeCustomVariablesSession=function(){this.storage.remove()},t.prototype.getRequestParameters=function(){var t=this.getCustomVariablesSession();for(var e in this.customVariablesNextPageOnly)this.customVariablesNextPageOnly.hasOwnProperty(e)&&(this.customVariablesPage[e]=this.customVariablesNextPageOnly[e]);for(var e in this.customVariablesPage)this.customVariablesPage.hasOwnProperty(e)&&(t[e]=this.customVariablesPage[e]);if(window.JSON.stringify(t).length<=2)return{};var r={cvars:this.getValidCustomVars(t)};return this.customVariablesPage&&window.JSON.stringify(this.customVariablesPage).length>2&&(r.cvarp=this.getValidCustomVars(this.customVariablesPage)),r},t.prototype.deleteNextPageOnlyCustomVariables=function(){if(Object.keys(this.customVariablesNextPageOnly).length>0)for(var t in this.customVariablesNextPageOnly)this.customVariablesNextPageOnly[t]===this.customVariablesPage[t]&&(delete this.customVariablesPage[t],delete this.customVariablesNextPageOnly[t])},t.prototype.getValidCustomVars=function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=parseInt(e,10),i=t[e],n=i[0],o=i[1];a=1,c=20,(!(et(s=r)&&s>=a&&s<=c)||n.length>512||o.length>255)&&delete t[e]}var s,a,c,u=function(t){var e;for(e in t)return!1;return!0}(t)?[]:t;return window.JSON.stringify(u)},t}(),Ts=["setCustomVariable"],Rs=function(){function t(t,e){this.commandsService=t,this.customVariablesService=e}return t.prototype.init=function(){var t=this;this.commandsService.register(Ts,(function(e,r,i,n){t.customVariablesService.set(e,r,i,n)}))},t.prototype.onAfterArtificialPageView=function(){this.customVariablesService.deleteNextPageOnlyCustomVariables()},t.prototype.onAfterNaturalPageView=function(){this.customVariablesService.deleteNextPageOnlyCustomVariables()},t.prototype.onOptout=function(){this.customVariablesService.removeCustomVariablesSession()},t}(),bs=function(){function t(t){this.configuration=t,this.validStandardHeadersToLower=["age","cache-control","clear-site-data","expires","pragma","warning","downlink","ect","rtt","last-modified","connection","keep-alive","accept","accept-encoding","accept-language","expect","access-control-allow-origin","access-control-allow-credentials","access-control-allow-headers","access-control-allow-methods","access-control-expose-headers","access-control-max-age","access-control-request-headers","access-control-request-method","origin","timing-allow-origin","content-length","content-type","content-encoding","content-language","via","host","referrer-policy","user-agent","allow","server","accept-ranges","range","if-range","content-range","cross-origin-embedder-policy","cross-origin-opener-policy","cross-origin-resource-policy","content-security-policy","content-security-policy-report-only","expect-ct","feature-policy","strict-transport-security","upgrade-insecure-requests","x-content-type-options","x-download-options","x-frame-options","x-permitted-cross-domain-policies","x-powered-by","x-xss-protection","sec-fetch-site","sec-fetch-mode","sec-fetch-user","sec-fetch-dest"]}return t.prototype.isValidStandardHeader=function(t){return-1!==csArray.prototype.indexOf.call(this.validStandardHeadersToLower,csString.prototype.toLowerCase.call(t))},t.prototype.isValidCustomHeader=function(t){if(!this.configuration.apiErrors.validCustomHeaders)return!1;var e=csString.prototype.toLowerCase.call(t);return csArray.prototype.some.call(this.configuration.apiErrors.validCustomHeaders,(function(t){return csString.prototype.toLowerCase.call(t)===e}))},t}(),ws=function(){function t(t,e,r){this.configuration=t,this.cookieChecker=e,this.parentLogContext=r}return t.prototype.init=function(){var t=this;performance.mark("cs-start-boot");var e=new ao,r=new D,i=new So,n=new Ro(this.configuration,i,r),o=new Qo(window.location,r),s=new ft(this.configuration,o,this.cookieChecker);s.init();var a=new vs,c=new ms,u=new go(window.location,s);ss.init(this.configuration,s,a);var p=new Ho(this.configuration,s);p.init();var l,h=ds.create(ht.warn);if(this.configuration.useMalkaPipeline){var d=new Bt(this.configuration.getQuotaServiceUri(),"quota");(l=new ro(this.configuration,h,d,e,u,o)).init()}else l=new eo(this.configuration,h,u,o);var f=new Pt(this.configuration,s,p,a),y=new io(f,l),v=new wt(this.configuration,s,p,a),m=new $n(this.configuration,v,y);this.parentLogContext.setContext(m,y),l.setVisitorService(m);var g=new oo(m,y),S=new Lt(this.configuration,s,p,a),E=new vo(window.location,S),C=new mo(E),T=new no(this.configuration,m,E),R=new os,b=new Lo,w=new No(b,R),A=new Mt(this.configuration,s,p,a),k=new Cs(r,A),I=new Rs(b,k),P=new Rt(m,y,E,k,this.configuration),N=new Vt,O=new _t(N,window.location),L=new Po(this.configuration,P,O),M=new Fo(this.configuration,N);p.setStates(P,M);var x=new Qn(this.configuration,m,E,T,g,L,p,u);n.init(),x.compute((function(i){w.init();var n=new Zo,a=new uo(t.configuration,s,c),u=new fo(t.configuration,a,e),p=new ho(b,u),l=new bo(t.configuration,s,c),d=new wo(e,window.location,l),f=new ko(b,d),v=new Ko(b,t.configuration),g=new Go(t.configuration,m,y),S=new jo,E=new ur,T=new bs(t.configuration),A=new es(E,T,t.configuration),P=new rs(E,T,t.configuration),N=new $o(A,P),O=new fs(r),L=new ys(r,o),M=new Bo(S,L,N,O,r,t.configuration,g,R,b,n);(M.init(),performance.mark("cs-step2-boot"),e.addListeners(M),i)?(e.emitInitTracking(),new Jn(g,h,m,y,e,b,w,t.configuration,f,d,p,u,r,o,v,n,S,L,N,O,R,k,I).start()):new yo(e,b,w,f,d,C,p).start()})),performance.mark("cs-end-boot"),performance.measure("cs-measure-boot","cs-start-boot","cs-end-boot")},t}();!function(t){var e,r={loadBundle:function(t){var s=t.source,a=t.data;if(n(a)){var p=function(){var e,r,n,o=i("{domain}/tag/tag.bundle.js?v={version}",a);e=o,r=function(){return s.postMessage("csBundleLoaded",t.origin)},(n=document.createElement("script")).type="text/javascript",n.async=!0,n.src=e,n.onload=r,n.charset="utf-8",document.head.appendChild(n)};e=a.token,u(r.loadBundle),o(t.origin)?p():function(t,e){var r=function(t){var e=document.createElement("iframe");return e.src=t,e.id="content-square-bridge",e.setAttribute("style","display: none !important; visibility: hidden !important;"),e}(i("{domain}/tag/bridge.html?v={version}#{token}",t)),n=function(t){t.source===r.contentWindow&&"TOKEN_VALID"===t.data&&(u(n),r.remove(),e())};c(n),document.head.appendChild(r)}(a,p)}}};function i(t,e){return csString.prototype.replace.call(csString.prototype.replace.call(csString.prototype.replace.call(t,"{version}",e.version),"{token}",e.token),"{domain}",e.domain)}function n(t){return t&&"csBundleInjection"===t.type&&o(t.domain)&&a(t.version)&&s(t.token)}function o(t){return/^https?:\/\/[a-zA-Z0-9\.\-]+\.(content-square\.fr|contentsquare\.com)$/.test(t)}function s(t){return/^[a-zA-Z0-9]+$/.test(t)}function a(t){return/^[a-zA-Z0-9\.]+$/.test(t)}function c(t){window.addEventListener("message",t,!1)}function u(t){window.removeEventListener("message",t,!1)}t.getToken=function(){return e},t.isAuthorizedIncomingMessage=n,t.isAuthorizedDomain=o,t.isAuthorizedToken=s,t.isAuthorizedTagVersion=a,t.isActivable=function(){var t=window.opener||window.parent;return window!==t&&window.addEventListener},t.waitForBundleInjection=function(){c(r.loadBundle)},t.listen=c,t.removeListener=u}(ps||(ps={})),function(t){var e,r=window.opener||window.parent,i=[/^https:\/\/app\.contentsquare\.com$/,/^https:\/\/dev-app\.contentsquare\.com$/,/^https:\/\/staging-app\.contentsquare\.com$/,/^https:\/\/.*\.test\.contentsquare\.com$/],n={ping:function(t){"ping"===t.data&&o(t.origin)&&(e=t.origin,c(n.ping),a(n.insertMessageScript),s("utils.js"+"?cb="+(new csDate).getTime()))},insertMessageScript:u((function(t){var e=t.data;"string"==typeof e&&"ping"!==e&&(c(n.insertMessageScript),s(e))}))};function o(t){return csArray.prototype.some.call(i,(function(e){return e.test(t)}))}function s(t,r){var i=document.createElement("script");i.type="text/javascript",i.async=!0;var n=csString.prototype.replace.call(e,/^https?:/,"");i.src=n+"/tag/"+t,i.onload=r,i.charset="utf-8",document.getElementsByTagName("head")[0].appendChild(i)}function a(t){window.addEventListener("message",t,!1)}function c(t){window.removeEventListener("message",t,!1)}function u(t){return function(r){r.origin===e&&t(r)}}t.getToken=function(){return ps.getToken()},t.isActivable=function(){return window!==r&&window.addEventListener},t.isAuthorizedDomain=o,t.waitForConnection=function(){a(n.ping),ps.waitForBundleInjection()},t.listen=a,t.removeListener=c,t.secureListener=u,t.post=function(t){e&&r.postMessage(t,e)}}(ls||(ls={}));var As=window.CSFrameCommunication||ls,ks=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e.prototype.emitAfterPageViewCallback=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onAfterPageViewCallback&&i.onAfterPageViewCallback(t)}},e.prototype.emitIntegrationSessionKeyCallback=function(t){for(var e=0,r=this.listeners;e<r.length;e++){var i=r[e];i.onIntegrationSessionKeyCallback&&i.onIntegrationSessionKeyCallback(t)}},e}(so),Is=function(){function t(t){this.iframeCommandsSenderService=t}return t.prototype.init=function(){this.iframeCommandsSenderService.register(ei),this.iframeCommandsSenderService.register(Ts),this.iframeCommandsSenderService.register(dn),this.iframeCommandsSenderService.register(fn),this.iframeCommandsSenderService.register(hn),this.iframeCommandsSenderService.register(ci),this.iframeCommandsSenderService.register(ui),this.iframeCommandsSenderService.register(pi),this.iframeCommandsSenderService.register(li),this.iframeCommandsSenderService.register(Sn),this.iframeCommandsSenderService.register(En),this.iframeCommandsSenderService.register(Ao),this.iframeCommandsSenderService.register(Dn),this.iframeCommandsSenderService.register(xn),this.iframeCommandsSenderService.register(po),this.iframeCommandsSenderService.register(lo),this.iframeCommandsSenderService.register(Uo),this.iframeCommandsSenderService.register(zo)},t.prototype.onStartTracking=function(){this.iframeCommandsSenderService.start()},t.prototype.onOptout=function(){this.iframeCommandsSenderService.stop()},t}(),Ps=function(t){function e(e,r){var i=t.call(this)||this;return i.commandsService=e,i.iframeChildToParentCommunicationService=r,i.batch=[],i}return f(e,t),e.prototype.onStart=function(){this.commandsBatchReady()},e.prototype.onStop=function(){this.batch=[]},e.prototype.register=function(t){for(var e=this,r=function(t){i.commandsService.register([t],(function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return e.send(t,r)}))},i=this,n=0,o=t;n<o.length;n++){r(o[n])}},e.prototype.send=function(t,e){csArray.prototype.push.call(this.batch,{name:t,params:e}),this.isStarted&&this.commandsBatchReady()},e.prototype.commandsBatchReady=function(){if(0!==this.batch.length){var t={commands:this.batch};this.iframeChildToParentCommunicationService.sendToParent(X.Commands,t),this.batch=[]}},v([dt("Commands.iframe.commandsBatch.send")],e.prototype,"send",null),v([$r(),dt("send iframe commands batch")],e.prototype,"commandsBatchReady",null),e}(me),Ns=function(t){function e(e,r,i){var n=t.call(this)||this;return n.configuration=e,n.lifeCycleEventsEmitter=r,n.childLifeCycleEventEmitter=i,n.id=-1,n.parentOrigin="",n.maxMessagesBuffer=25,n.messageBuffer=[],n.messageHandler={boundElement:window,type:"message",listener:function(t){return n.messagesListener(t)}},n}return f(e,t),e.prototype.onStart=function(){Ht(this.messageHandler,!1),this.sendDiscovery()},e.prototype.onStop=function(){Ft(this.messageHandler,!1)},e.prototype.sendToParent=function(t,e){var r=this.buildChildBaseMessage(t,e);this.sendMessage(r)},e.prototype.sendDiscovery=function(){var t=this.buildChildBaseMessage(X.Discovery);J.sendMessage(window.parent,"*",t)},e.prototype.buildChildBaseMessage=function(t,e){var r=J.buildBaseMessage(t,Y.Child,this.configuration.projectId,this.id);return e&&(r.content=e),r},e.prototype.sendMessage=function(t){void 0!==t.id?J.sendMessage(window.parent,this.parentOrigin,t):this.addMessageToBuffer(t)},e.prototype.messagesListener=function(t){if(J.isMessageValid(t,Y.Parent,this.configuration.projectId,this.configuration.hostnames))switch(t.data.type){case X.IntegrationCallback:var e=t.data.content;e.initiator===W.AfterPageView?this.childLifeCycleEventEmitter.emitAfterPageViewCallback(e):e.initiator===W.GetSessionKey?this.childLifeCycleEventEmitter.emitIntegrationSessionKeyCallback(e):ht.warn("Iframe child ("+this.id+") received unknown IntegrationCallback type from parent ("+t.origin+") : "+csJSON.stringify(t.data));break;case X.Stop:this.lifeCycleEventsEmitter.emitOptout();break;case X.Discovery:if(!et(t.data.id)||t.data.id<0)return void ht.warn("Iframe child ("+this.id+") received discovery without valid id from parent ("+t.origin+") : "+csJSON.stringify(t.data));this.id=t.data.id,this.parentOrigin=t.origin,this.sendAllBufferedMessages();break;default:ht.warn("Iframe child ("+this.id+") received unknown data type from parent ("+t.origin+") : "+csJSON.stringify(t.data))}},e.prototype.addMessageToBuffer=function(t){this.messageBuffer.length<this.maxMessagesBuffer&&csArray.prototype.push.call(this.messageBuffer,t)},e.prototype.sendAllBufferedMessages=function(){for(var t=0,e=this.messageBuffer;t<e.length;t++){var r=e[t];r.id=this.id,J.sendMessage(window.parent,this.parentOrigin,r)}this.messageBuffer=[]},e}(me),Os=function(t){function e(e,r){var i=t.call(this)||this;return i.apiErrorsTracker=e,i.iframeChildToParentCommunicationService=r,i}return f(e,t),e.prototype.init=function(){this.apiErrorsTracker.init()},e.prototype.onStart=function(){var t=this;this.apiErrorsTracker.subscribe(e.SERVICE_IDENTIFIER,(function(e){return t.processEvent(e)}))},e.prototype.onStop=function(){this.apiErrorsTracker.unsubscribe(e.SERVICE_IDENTIFIER)},e.prototype.processEvent=function(t){this.isStarted&&this.iframeChildToParentCommunicationService.sendToParent(X.ApiError,t)},e.SERVICE_IDENTIFIER="IframeApiErrorsService",e}(me),Ls=function(t){function e(e,r){var i=t.call(this)||this;return i.javaScriptErrorsTracker=e,i.iframeChildToParentCommunicationService=r,i}return f(e,t),e.prototype.onStart=function(){var t=this;this.javaScriptErrorsTracker.subscribe(e.SERVICE_IDENTIFIER,(function(e){return t.processEvent(e)}))},e.prototype.onStop=function(){this.javaScriptErrorsTracker.unsubscribe(e.SERVICE_IDENTIFIER)},e.prototype.processEvent=function(t){this.isStarted&&this.iframeChildToParentCommunicationService.sendToParent(X.JavascriptError,t)},e.SERVICE_IDENTIFIER="IframeJavaScriptErrorsService",e}(me),Ms=function(){function t(t,e,r,i){this.javaScriptErrorsTracker=t,this.apiErrorsTracker=e,this.configuration=r,this.iframeChildToParentCommunicationService=i}return t.prototype.init=function(){this.iframeJavaScriptErrorsService=new Ls(this.javaScriptErrorsTracker,this.iframeChildToParentCommunicationService),this.apiErrorsTracker.excludeDomains([Oo.CONTENTSQUARE,Oo.CLICKTALE,Oo.FAKE_TRACKER]),this.iframeApiErrorsService=new Os(this.apiErrorsTracker,this.iframeChildToParentCommunicationService),this.iframeApiErrorsService.init()},t.prototype.onStartTracking=function(){this.configuration.jsErrorsEnabled&&this.iframeJavaScriptErrorsService.start(),this.configuration.apiErrors.enabled&&this.iframeApiErrorsService.start()},t.prototype.onOptout=function(){this.iframeJavaScriptErrorsService.stop(),this.iframeApiErrorsService.stop()},t}(),Ds=function(){function t(t){this.iframeChildToParentCommunicationService=t}return t.prototype.onStartTracking=function(){this.iframeChildToParentCommunicationService.start()},t.prototype.onOptout=function(){this.iframeChildToParentCommunicationService.stop()},t}(),xs=function(){function t(t,e,r){this.iframeParentToChildrenCommunicationService=t,this.iframeEventsEmitter=e,this.iframeChildToParentCommunicationService=r}return t.prototype.init=function(){var t=this;this.iframeParentToChildrenCommunicationService.onChildMessage((function(e,r,i,n){return t.iframeEventsEmitter.emitIframeEvent(e,r,i,n)}))},t.prototype.onStartTracking=function(){this.iframeParentToChildrenCommunicationService.start()},t.prototype.onOptout=function(){this.iframeParentToChildrenCommunicationService.stop()},t.prototype.onIframeAnalysisEvent=function(t){this.iframeChildToParentCommunicationService.sendToParent(X.AnalysisEvent,t)},t.prototype.onIframeJavascriptError=function(t){this.iframeChildToParentCommunicationService.sendToParent(X.JavascriptError,t)},t.prototype.onIframeApiError=function(t){this.iframeChildToParentCommunicationService.sendToParent(X.ApiError,t)},t.prototype.onIframeEmerchandisingMessage=function(t){this.iframeChildToParentCommunicationService.sendToParent(X.EmerchandisingMessage,t)},t.prototype.onIframeCommands=function(t){this.iframeChildToParentCommunicationService.sendToParent(X.Commands,t)},t.prototype.onIframeIntegrationCallback=function(t){this.iframeChildToParentCommunicationService.sendToParent(X.IntegrationCallback,t)},t.prototype.onAfterPageViewCallback=function(t){this.iframeParentToChildrenCommunicationService.sendToChildren(X.IntegrationCallback,t)},t.prototype.onIntegrationSessionKeyCallback=function(t){this.iframeParentToChildrenCommunicationService.sendToChildren(X.IntegrationCallback,t)},t}(),_s=function(t){function e(e,r,i){var n=t.call(this)||this;return n.analysisEventsTracker=e,n.gestureTracker=r,n.iframeChildToParentCommunicationService=i,n}return f(e,t),e.prototype.init=function(){var t=this;this.analysisEventsTracker.onEvent((function(e){return t.processEvent(e)})),this.gestureTracker.onEvent((function(e){return t.processEvent(e)}))},e.prototype.onStart=function(){this.analysisEventsTracker.start(),this.gestureTracker.start()},e.prototype.onStop=function(){this.analysisEventsTracker.stop(),this.gestureTracker.stop()},e.prototype.processEvent=function(t){this.isStarted&&t.type!==Qr.RESIZE&&this.iframeChildToParentCommunicationService.sendToParent(X.AnalysisEvent,t)},e}(me),Vs=function(){function t(t,e,r,i){this.configuration=t,this.projectPathComputation=e,this.selector=r,this.iframeChildToParentCommunicationService=i}return t.prototype.init=function(){var t=new Ai(this.configuration,this.projectPathComputation,this.selector),e=new Si(this.configuration,this.projectPathComputation,new Xn(ht));this.iframeAnalysisEventsService=new _s(t,e,this.iframeChildToParentCommunicationService),this.iframeAnalysisEventsService.init()},t.prototype.onStartTracking=function(){this.iframeAnalysisEventsService.start()},t.prototype.onOptout=function(){this.iframeAnalysisEventsService.stop()},t}(),qs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return f(e,t),e}(bn),zs=function(){function t(t,e,r){this.urlService=t,this.eMerchandisingTracker=e,this.iframeChildToParentCommunicationService=r,this.products=[]}return t.prototype.collect=function(){this.products=this.eMerchandisingTracker.collectProducts(),this.targetUrl=this.urlService.getUrl(),this.sendEMerchandisingData()},t.prototype.clearProducts=function(){this.products=[]},t.prototype.sendEMerchandisingData=function(){var t={targetUrl:this.targetUrl,windowWidth:Ue.windowWidth(),windowHeight:Ue.windowHeight(),products:this.products};this.iframeChildToParentCommunicationService.sendToParent(X.EmerchandisingMessage,t)},t}(),Us=function(){function t(t,e,r){this.configuration=t,this.urlService=e,this.iframeChildToParentCommunicationService=r}return t.prototype.init=function(){var t=new qs(this.configuration);this.iframeEmerchandisingService=new zs(this.urlService,t,this.iframeChildToParentCommunicationService)},t.prototype.onStartTracking=function(){this.iframeEmerchandisingService.clearProducts(),this.iframeEmerchandisingService.collect()},t}(),Bs=function(){function t(t){this.iframeChildToParentCommunicationService=t,this.registeredCallbacks={}}return t.prototype.handleCommand=function(t){st(t)&&this.registerCallback(t)},t.prototype.executeRegisteredCallbacks=function(t){var e=t.trackingContext;if(e)if(t.callbackId){var r=this.registeredCallbacks[t.callbackId];r&&this.executeAsync(r,e)}else for(var i in this.registeredCallbacks)this.executeAsync(this.registeredCallbacks[i],e)},t.prototype.registerCallback=function(t){var e=A.integer(),r={callbackId:e,initiator:W.AfterPageView};this.registeredCallbacks[e]=t,this.iframeChildToParentCommunicationService.sendToParent(X.IntegrationCallback,r)},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),Hs=function(){function t(t){this.iframeChildToParentCommunicationService=t,this.pendingCallbacks={}}return t.prototype.handleCommand=function(t){it(t)&&st(t.callback)&&this.addPendingCallback(t.callback)},t.prototype.executePendingCallbacks=function(t){var e=t.trackingContext,r=t.callbackId;if(r&&e){var i=this.pendingCallbacks[r];i&&(delete this.pendingCallbacks[r],this.executeAsync(i,e.sessionKey))}},t.prototype.addPendingCallback=function(t){var e=A.integer(),r={callbackId:e,initiator:W.GetSessionKey};this.pendingCallbacks[e]=t,this.iframeChildToParentCommunicationService.sendToParent(X.IntegrationCallback,r)},t.prototype.executeAsync=function(t,e){setTimeout((function(){t(e)}))},t}(),Fs=function(){function t(t,e){this.commandsService=t,this.iframeChildToParentCommunicationService=e}return t.prototype.init=function(){var t=this;this.iframeAfterPageViewService=new Bs(this.iframeChildToParentCommunicationService),this.iframeGetSessionKeyService=new Hs(this.iframeChildToParentCommunicationService),this.commandsService.register(Kr,(function(e){t.iframeAfterPageViewService.handleCommand(e)})),this.commandsService.register(Wr,(function(e){return t.iframeGetSessionKeyService.handleCommand(e)}))},t.prototype.onAfterPageViewCallback=function(t){this.iframeAfterPageViewService.executeRegisteredCallbacks(t)},t.prototype.onIntegrationSessionKeyCallback=function(t){this.iframeGetSessionKeyService.executePendingCallbacks(t)},t}(),Gs=function(){function t(t,e,r,i,n){var o=this;this.childLifeCycleEventsEmitter=t,this.lifeCycleEventsEmitter=e,this.configuration=r,this.iframeChildToParentCommunicationService=i,this.commandsService=n,this.startDataCollection=function(){o.commandsService.start(),o.loadTracker.start()}}return t.prototype.start=function(){var t=this,e=new vn(Ie,this.configuration),r=new mn(e),i=new Vs(this.configuration,e,r,this.iframeChildToParentCommunicationService),n=new Ds(this.iframeChildToParentCommunicationService);if(this.configuration.eMerchandisingEnabled){var o=new D,s=new Qo(window.location,o),a=new Us(this.configuration,s,this.iframeChildToParentCommunicationService);this.lifeCycleEventsEmitter.addListeners(a),a.init()}var c=new Fs(this.commandsService,this.iframeChildToParentCommunicationService);this.childLifeCycleEventsEmitter.addListeners(c),c.init();var u=new jn(this.configuration),p=new os,l=new xs(u,p,this.iframeChildToParentCommunicationService);p.addListeners(l),this.childLifeCycleEventsEmitter.addListeners(l),this.lifeCycleEventsEmitter.addListeners(n,l,i),l.init(),i.init(),this.loadTracker=new gn,this.loadTracker.onLoad((function(){t.lifeCycleEventsEmitter.emitStartTracking()})),this.startDataCollection()},t}(),js=function(){function t(t){this.configuration=t}return t.prototype.init=function(){var t=new ao,e=new ks,r=new Ns(this.configuration,t,e),i=new Lo,n=new Ps(i,r),o=new Is(n);o.init();var s=new jo,a=new bs(this.configuration),c=new ur,u=new es(c,a,this.configuration),p=new rs(c,a,this.configuration),l=new $o(u,p),h=new Ms(s,l,this.configuration,r);h.init(),t.addListeners(o,h),t.emitInitTracking(),new Gs(e,t,this.configuration,r,i).start()},t}(),Ks=function(){function t(t,e,r){this.configuration=t,this.iframeContext=e,this.parentLogContext=r}return t.prototype.start=function(){var t,e;if(!window.UXAnalytics){var r=new yt(this.iframeContext,this.configuration);r.init();var i=new Tt(this.configuration,r);if(this.iframeContext.isTopWindowTracker()&&i.canTrack()){if((null===(t=window.CSProtectnativeFunctionsLogs)||void 0===t?void 0:t.Warning)&&ht.warn("protectNativeFunctions failed: "+window.CSProtectnativeFunctionsLogs.Warning),null===(e=window.CSProtectnativeFunctionsLogs)||void 0===e?void 0:e.Critical)return void ht.error("protectNativeFunctions failed: "+window.CSProtectnativeFunctionsLogs.Critical);new ws(this.configuration,r,this.parentLogContext).init()}else if(!this.iframeContext.isTopWindowTracker()&&i.canTrackInIframe()){new js(this.configuration).init()}window.UXAnalytics={},!window.CSFrameCommunication&&As.isActivable()&&(window.CSFrameCommunication=As,As.waitForConnection())}},v([dt("main.start")],t.prototype,"start",null),t}();try{performance.mark("cs-start-tag");var Ws=new k(window.CS_CONF);window._uxa=window._uxa||[],Ws.processOptionOverrides(window._uxa);var Ys=new I(window,Ws);Ys.init();var Xs=new $;if(Ys.isTopWindowTracker()){var Js=new H(Ws,Xs);ht.setStrategy(Js)}else{var Qs=new Z(Ws);ht.setStrategy(Qs)}new Ks(Ws,Ys,Xs).start()}catch(t){}}]);